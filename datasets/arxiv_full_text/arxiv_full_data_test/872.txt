{"title": "Loss-function learning for digital tissue deconvolution", "tag": "q-bio", "abstract": " The gene expression profile of a tissue averages the expression profiles of all cells in this tissue. Digital tissue deconvolution (DTD) addresses the following inverse problem: Given the expression profile $y$ of a tissue, what is the cellular composition $c$ of that tissue? If $X$ is a matrix whose columns are reference profiles of individual cell types, the composition $c$ can be computed by minimizing $\\mathcal L(y-Xc)$ for a given loss function $\\mathcal L$. Current methods use predefined all-purpose loss functions. They successfully quantify the dominating cells of a tissue, while often falling short in detecting small cell populations.  Here we learn the loss function $\\mathcal L$ along with the composition $c$. This allows us to adapt to application-specific requirements such as focusing on small cell populations or distinguishing phenotypically similar cell populations. Our method quantifies large cell fractions as accurately as existing methods and significantly improves the detection of small cell populations and the distinction of similar cell types. ", "text": "background gene expression proﬁle tissue averages expression proﬁles cells tissue. digital tissue deconvolution addresses following inverse problem given expression proﬁle tissue cellular composition tissue? matrix whose columns reference proﬁles individual cell types composition application-speciﬁc requirements focusing small cell populations distinguishing phenotypically similar cell populations. method quantiﬁes large cell fractions accurately existing methods signiﬁcantly improves detection small cell populations distinction similar cell types. diﬀerent tissues body diﬀerent cellular compositions. composition tumor tissue diﬀerent normal tissue. also comparing tumor tissues cellular composition diﬀer greatly. relatively small populations tumor-inﬁltrating immune cells particular importance. aﬀect progression disease success treatment immune therapies block communication lines tumor cells inﬁltrating immune cells. whether successful depends presence quantity molecular sub-type inﬁltrating immune cells immune-cell populations typically small molecular phenotype diﬃcult observe microscope. single-cell technologies ﬂuorescence-activated cell sorting cytometry time-of-ﬂight costwork-eﬃcient alternative single-cell assays combination bulk-tissue gene expression proﬁling digital tissue deconvolution addresses following inverse problem given bulk gene expression proﬁle tissue cellular composition tissue? supervised assumes matrix whose columns reference proﬁles individual cell types. composition computed minimizing given loss function competing methods diﬀerent predeﬁned all-purpose loss functions diﬀerent estimation algorithms distil practical objective estimate correctly formal objective common algorithms estimate correctly. tissue expression proﬁles exact mixtures reference proﬁles existing methods work perfectly. causes problems collections references proﬁles incomplete. might cells tissue represented reference proﬁles. case global problem solvable dtd-algorithms compensate contributions cells increasing frequencies cell types. small cell fractions hard quantify. practical point view probably important point improvements needed badly. immunological cell populations tumor small determine reaction tumor immunotherapy. therefore algorithms must faint signals small cell populations eﬀectively. cell types hardly distinguished expression proﬁles. proﬁle epithelial cell diﬀers greatly lymphoid cell. immunological sub-entities cells diﬀerences subtle. similar cell types similar expression proﬁles diﬃcult distinction. rp×q matrix cellular reference proﬁles columns stands indices. reference expression value gene cells type number genes number cell types respectively. introduce matrix rp×n bulk proﬁles cell mixtures columns matrix rq×n cellular compositions mixtures columns. following established linear algorithms approximate mixture linear combination reference proﬁles weights estimate composition k-th mixture minimizing contrast standard algorithms determine prior knowledge separate statistical analysis learn directly data. assume training mixtures speciﬁc application context known cellular compositions c·k. entries gene weights deﬁne loss function. want learn training data minimizing respect yields accurate quantiﬁcations cell ˆcj· estimates given evaluate need calculate ˆcj· requires optimizing respect c·k. note minimum αˆg. constraint ||g|| thus needed ensure unique solutions. diag. inserting term leaves single optimization problem minimize gradient-descent algorithm. mean standard deviation respectively. obtain gradient figure deconvolution performance single reference proﬁle predicted cell frequencies plotted versus real frequencies. results standard model shown loss-function learning training validation need expression proﬁles cellular mixtures known composition. used expression data melanomas whose composition experimentally resolved using single-cell rnaseq proﬁling data included single-cell proﬁles melanomas. cells annotated cells cells macrophages endothelial cells cancer-associated ﬁbroblasts natural killer cells tumor/unclassiﬁed ﬁrst melanomas deﬁned validation cohort remaining training data. first data transformed transcripts million. then cell cluster sampled single-cell proﬁles training data summed normalized common number counts removed training data. yielded reference proﬁles x·j. genes highest variance across reference proﬁles used train models. single-cell proﬁles melanoma gave bulk proﬁles. addition generated large number artiﬁcial bulk proﬁles randomly sampling single-cell proﬁles summing bulk proﬁles normalized number reads x·j. generated artiﬁcial cellular mixtures training cohort. mixtures randomly drew single-cell proﬁles summed counts normalized ﬁxed number total counts. analogously generated artiﬁcial cellular validation mixtures. then restricted three cell types hence endothelial cells cafs cells tumor/unclassiﬁed cells mixtures represented standard observed correlation coeﬃcients true estimated cell population sizes validation mixtures. improved loss-function learning iterations gradient descent algorithm training data. test limits approach excluded macrophages account less cells reference data observed standard broke down loss-function learning yielded model predicted macrophage abundances still correlated well true abundances figure plot shows correlation predicted true cellular frequencies cells depends proportion cells. blue triangles correspond models lossfunction learning diamonds standard model furthermore green stars show model trained mixtures cells extrapolates higher b-cell proportions. plot shows heatmap important genes corresponding generated data time controlling abundance cells simulated mixtures cells cells. surprisingly small fractions cells harder quantify large ones. loss-function learning improved accuracy amounts cells improvements greatest small amounts cells mixture accuracy improved furthermore observed loss-function learning small b-cell proportions yielded model highly predictive b-cell contributions whole spectrum compare top-ranked genes model learned small b-cell population macrophage-focussed simulation observe former still comprises marker genes distinguish cell types latter focusses genes characterize macrophages. cell types annotated tirosh displayed diﬀerent expression proﬁles. interested t-cell subtypes cells t-helper cells regulatory cells reference proﬁles similar challenging. subdivided fraction annotated t-cell proﬁles follows cells positive zero count labelled cells vice versa cells zero positive count labelled cells split tregs foxp count positive cells otherwise cells fulﬁlled neither criteria contributed mixtures assessed dtd. augmented reference matrix consisting figure performance without loss-function learning function size training set. performance assessed calculating average correlations predicted true cellular contributions cell types. blue diamonds black triangles correspond performance loss-function learning validation mixtures training mixtures respectively. performance standard shown line validation mixtures. cells cells macrophages endothelial cells cafs cells cell types replacing original t-cell proﬁle speciﬁc proﬁles tregs. simulated training test mixtures described above. repeated simulation subsection varied size training dataset. observed loss-function learning improved accuracy training datasets small samples. moreover training data added boost performance grew saturated training sets samples desktop workstations solution problem computationally feasible. single computation gradient took hours ram) needs computed several hundred times convergence. therefore developed high-performance-computing implementation code parallelizing equations using pbdmpi library chen interface. furthermore linked intel math kernel library threaded vectorized matrix operations. algorithm nodes qpace machine tasks node hardware threads task thread vector units. hours iterations ﬁnished loss stable within high-performance model includes several genes whose expression characteristic cells distinguished present study. include among others gene encodes integral membrane glycoprotein essential activation cytotoxic t-lymphocytes protection subset cells lysis thus enabling contrast cdnk cells lyse multiple target cells evident figure cells clearly apart cell types studied expression killer cell lectin like receptor genes klrb klrc klrf cells hand clearly characterized expression assembles antigen receptor lymphocytes inﬂuences b-cell selection diﬀerentiation coexpressed functions store-operated calcium channel lymphocyte kinase src-family protein tyrosine kinase plays important role b-cell receptor signaling phosphorylates speciﬁcally tyr- tyr- well tyr- tyr- required surface expression function b-cell antigen receptor complex blnk bridges activation downstream signaling pathways expression foxp also highly cell speciﬁc. foxp distinguishes regulatory cells cells functions master regulator development function finally t-helper cells distinguished indirectly aforementioned lymphocytes lack expression cell type-speciﬁc genes. contrast lymphocytes macrophages cancer-associated ﬁbroblasts endothelial cells line interior surface blood vessels lymphatic vessels characterized much larger number genes. exemplary genes include stab csfr macrophages. monocyte diﬀerentiation antigen instance mediates innate immune response bacterial lipopolysaccharide activating nf-κb pathway cytokine secretion colony stimulating factor receptor acts receptor hematopoietic growth factor controls proliferation function macrophages cafs hand distinguished expression genes encoding extracellular matrix proteins ﬁbulin- ﬁbulin- various collagens versican well known mediator cell-to-cell cell-to-matrix interactions plays critical roles cancer biology well matrix metalloproteinases collagen degrading enzymes allow cancer cells migrate primary tumor form metastases noteworthy also grem antagonist bone morphogenetic protein pathway. expression secretion stromal cells tumor tissues promotes survival proliferation cancer cells genes characteristic endothelial cells include among others member cadherin superfamily essential endothelial adherens junction assembly maintenance endothelial cell-speciﬁc chemotaxis receptor gene encodes cell-surface single-transmembrane domain glycoprotein plays role endothelial cell migration apoptosis proliferation claudin- forms backbone tight junction strands endothelial cells willebrand factor mediates adhesion platelets sites vascular damage binding speciﬁc platelet membrane glycoproteins constituents exposed connective tissue additional genes including many were knowledge used characterize cell types. interesting example cxorf described expressed levels many tissues deletion and/or mutations associated autism spectrum disorders however nothing known function date. therefore observed overexpression endothelial cells provide important clue future study function. loss-function learning shows similar performance cibersort dominating cell populations improves accuracy small populations distinction closely related cell types next compared model trained subsection competing method. this generated test mixtures validation melanomas. chose cibersort comparison consistently among best algorithm broad comparison diﬀerent algorithms several benchmark datasets cibersort test mixtures using distinct approaches ﬁrst uploaded validation data cibersort using reference proﬁles. performance summarized figure cibersorta observed large population cells estimated accurately smaller populations inaccurate next uploaded reference proﬁles used cibersort gene selection found highly abundant cell types predicted high accuracy. however distinction similar cell types helper cells tregs compromised respectively. similarly predictions small populations cafs compromised. might explained fact cibersort take account distinction thus appropriate marker genes might missing. direct comparison cibersort method showed similar better performance. mixtures discussed artiﬁcial single-cell proﬁles chosen randomly. might diﬀer signiﬁcantly mixtures real tissue. therefore generated full bulk melanoma proﬁles summing respective single-cell proﬁles. reﬂect bulk melanomas predictions contrasted true proportions figure predictions tregs compromised predictions loss-function learning figure performance comparison. methods left right standard variable genes cibersorta cibersortb performance calculated correlation predicted true frequencies validation mixtures. endothelial cells cafs estimated cibersorta thus shown. suggest loss-function learning digital tissue deconvolution adapt deconvolution algorithm requirements speciﬁc application domains. concept similar embedded feature-selection approach regression classiﬁcation problems. contexts feature selection directly linked prediction algorithm treated independent preprocessing step. figure deconvolution melanoma tissues. circles indicate melanomas validation data plusses training data. figure correspond cells macrophages endothelial cells cafs cells cells cells tregs respectively. solid black lines show corresponding linear regression dashed lines identity. regression support vector regression however leastsquares loss function allowed state outer optimization problem closed analytical form reducing computational burden. outer loss function evaluates estimated true cellular proportions training samples. chose correlation estimated versus true quantities across samples absolute measure deviation ˆc|| moreover require estimated proportions ˆc·k tissue one. consequently testing method look absolute deviations true versus estimated cell proportions correlation. cannot reliably infer many cells speciﬁc type tissue infer whether constituted cells tissue. however tissues estimated cells type ﬁrst tissue compared second relation also found true cell populations. calibrating method absolute cell numbers percentages within tissue appears diﬃcult. might normalization libraries single cells common size might reﬂect true biology example cell types contain others. post-hoc normalization estimated quantities might option. summary introduced loss-function learning machine-learning approach allows adapt application-speciﬁc requirements digital tissue deconvolution problem. focusing small cell populations delineating similar cell types. simulations application melanoma tissues method quantiﬁed large cell fractions accurately existing methods signiﬁcantly improved detection small cell populations distinction similar cell types.", "year": "2018"}