{"title": "A Kolmogorov-Smirnov test for the molecular clock on Bayesian ensembles  of phylogenies", "tag": "q-bio", "abstract": " Divergence date estimates are central to understand evolutionary processes and depend, in the case of molecular phylogenies, on tests of molecular clocks. Here we propose two non-parametric tests of strict and relaxed molecular clocks built upon a framework that uses the empirical cumulative distribution (ECD) of branch lengths obtained from an ensemble of Bayesian trees and well known non-parametric (one-sample and two-sample) Kolmogorov-Smirnov (KS) goodness-of-fit test. In the strict clock case, the method consists in using the one-sample Kolmogorov-Smirnov (KS) test to directly test if the phylogeny is clock-like, in other words, if it follows a Poisson law. The ECD is computed from the discretized branch lengths and the parameter $\\lambda$ of the expected Poisson distribution is calculated as the average branch length over the ensemble of trees. To compensate for the auto-correlation in the ensemble of trees and pseudo-replication we take advantage of thinning and effective sample size, two features provided by Bayesian inference MCMC samplers. Finally, it is observed that tree topologies with very long or very short branches lead to Poisson mixtures and in this case we propose the use of the two-sample KS test with samples from two continuous branch length distributions, one obtained from an ensemble of clock-constrained trees and the other from an ensemble of unconstrained trees. Moreover, in this second form the test can also be applied to test for relaxed clock models. The use of a statistically equivalent ensemble of phylogenies to obtain the branch lengths ECD, instead of one consensus tree, yields considerable reduction of the effects of small sample size and provides again of power. ", "text": "laboratório genômica evolutiva biocomplexidade escola paulista medicina universidade federal paulo pedro toledo pesquisas unifesp paulo brazil departamento informática saúde escola paulista medicina universidade federal paulo botucatu josé leal prad paulo brazil departamento análises clínicas toxicológicas faculdade ciências farmacêuticas universidade paulo professor lineu prestes paulo brazil e-mail marcelo.brionesunifesp.br ¶these authors contributed equally. keywords molecular clock molecular phylogeny phylogenetic tree evolution non-parametric goodness-of-fit test bayesian inference poisson process. divergence date estimates central understand evolutionary processes depend case molecular phylogenies tests molecular clocks. propose non-parametric tests strict relaxed molecular clocks built upon framework uses empirical cumulative distribution branch lengths obtained ensemble bayesian trees well known non-parametric kolmogorov-smirnov goodness-of-fit test. strict clock case method consists using one-sample kolmogorov-smirnov test directly test phylogeny clock-like words follows poisson law. computed discretized branch lengths parameter expected poisson distribution calculated average branch length ensemble trees. compensate auto-correlation ensemble trees pseudo-replication take advantage thinning effective sample size features provided bayesian inference mcmc samplers. finally observed tree topologies long short branches lead poisson mixtures case propose twosample test samples continuous branch length distributions obtained ensemble clockconstrained trees ensemble unconstrained trees. moreover second form test also applied test relaxed clock models. statistically equivalent ensemble phylogenies obtain branch lengths instead consensus tree yields considerable reduction effects small sample size provides gain power. molecular clock hypothesis postulates given evolutionary rate approximately constant time evolutionary lines descent. implies genetic divergence accumulates stochastic clock-like manner approximately constant number mutations accumulated time interval then time scales could determined evolutionary events calibration using fossil evidence. moreover evolutionary rate variation lineages could shed light mechanisms molecular evolution. substitution rate constant lineages evolutionary distances external nodes phylogenetic tree size starting root. authors suggest substitution process approximately poisson meaning average number substitutions variance different lineages time interval equal. neutral theory molecular evolution proposed observed clock-like behavior molecular evolution advocated strong evidence supporting theory however reliability clock implications mechanism molecular evolution focus immediate controversy entwined neutralist– selectionist controversy. debate surrounding neutral theory generated rich body population genetics theory analytical tools. instance strict neutral model dynamics depends neutral mutation rate alone however expect sites functional protein constrained evolutionary time. observation motivated introduction doubly stochastic poisson process process model substitution process implying positive selection occurs episodic fashion affect sites introduction relaxed molecular clock models advanced inferring dates divergence events. despite great impact molecular clock evolutionary biology comparative molecular data accumulating past decades prediction proven satisfactory; dispersion index generally greater suggesting substitution process over-dispersed. furthermore observed substitution rate usually display variation along lineages fact created great controversy divergence date estimates order address issues several statistical tests developed examine whether rates molecular evolution vary significantly among phylogenetic lineages. fitch proposed simple test statistically examining whether evolutionary rates sequences significantly greater expected chance powerful versions fitch test appeared subsequently leading general framework testing molecular clock hypothesis protein sequences lineages given outgroup species recently procedures testing molecular clock multiple lineages simultaneously phylogenetic tree proposed. tests identify anomalous groups lineages whereas merely test entire tree conformity hypothesis. index dispersion suggested estimator test molecular clock. rationale number substitutions follows poisson index dispersion equal problems type test extensively discussed since approach based estimator dismissed. despite observation strict molecular clock hypothesis fully explain substitution process still remains promising concept powerful analytical tool evolutionary biology. therefore testing molecular clock phylogenetic trees essential task. problem assumes substitution process poisson homogeneity distribution substitutions along lineage even though clock rate constant variance large rate itself. fact precise sense poisson process heterogeneous possible meaning distributes dots random half-infinite line often called observed rates molecular evolution several loci described simple poisson processes therefore clock over-dispersed situations. accordingly statistical models overdispersed molecular clock proposed suggested over-dispersion molecular clock either major molecular reconfiguration series subliminal neutral changes selected substitutions fine-tuning molecule major molecular change work propose directly verify paulingzuckerkandl's assumption substitution process along branches approximately poisson testing hypothesis distribution branch lengths phylogenetic tree measured average number substitutions follows poisson law. accordingly developed procedure testing strict molecular clock phylogenetic trees inference made using non-parametric goodness-of-fit test. method proposed introduces novelties based ensemble trees instead using single consensus tree quite natural bayesian framework point view. indeed bayesian inference procedure generates posterior distribution phylogenetic trees form ensemble well-known nonrepresentative parametric goodness-of-fit test known kolmogorovsmirnov test modified account discrete variables poisson distributions estimated parameter classical test performed given sample size observations variable interest computes empirical cumulative distribution observed data defined positive real number. cumulative distribution expected probability distribution function variable interest test statistic sup|fn measure distance distributions. null hypothesis rejected exceeds critical value fixed significance level classical test null distribution depend expected distribution given explicit tabulated critical values available moreover test statistical power sensitivity tending sample size tends infinity i.e. probability type error goes zero. however universality null distribution comes price test applies continuous distributions expected distribution cannot estimated data fact conditions necessary show distribution independent expected distribution. seems serious obstruction test practical applications. indeed tables associated standard test conditions satisfied results conservative p-values sense probability type error smaller given standard table natural numbers probability conditional mean value greater another variation test two-sample kolmogorov-smirnov test. case given samples independent identically distributed realvalued observations sizes respectively test examines whether samples come continuous distribution not. sample computes respective ecds replaced test statistics defined here null hypothesis alternative hypothesis null hypothesis rejected exceeds critical value fixed significance level standard one-sample test null distribution depend cumulative distributions assumed continuous tabulated critical values available massey before possible compute approximated critical values p-values parametric bootstrap coverage bands given standard procedure statistics term non-parametric least different meanings. first meaning refers techniques rely data belonging particular distribution. particular includes procedures test hypotheses statements population parameters procedures make assumption sampled population also called distribution free procedures second meaning refers techniques assume structure model fixed. instance simple procedures testing molecular clock hypothesis lineages nonparametric second sense given require information model evolutionary change. methods proposed paper non-parametric tests first meaning described above. poisson-kolmogorov-smirnov test strict molecular clock first proposal testing molecular clock apply poisson distributions estimated parameter ensemble phylogenetic trees generated bayesian difficulty prevented dissemination test biology fields. nevertheless possible circumvent limitations modify test case discrete distributions without estimation parameters test statistic remains unchanged null distribution universal anymore; unlike completely specified case depends type expected distribution specifically depends points discontinuity expected distribution parameters estimated data. nowadays advent fast cheap computers p-values critical values modified tests easily calculated. particular case expected distribution poisson modified test procedure following null hypothesis poisson estimated mean value alternative hypothesis poisson poisson parameter estimated arithmetic mean list non-negative integer numbers score) null hypothesis rejected dpks exceeds critical value fixed significance level critical value must obtained distribution statistic dpks depends fact empirical distribution function expected poisson parameter procedure usually referred poisson-kolmogorovsmirnov test. campbell oprian approximated critical values test eliminate need tables performing parametric bootstrap test described however neither tables parametric bootstrap test provide exact critical values p-values. recently frey gives algorithm computation exact p-values exact critical values test. dual coverage band also called confidence bands test constructed follows. given fixed significance level corresponding critical value define functions min{fn max{fn then pair non-parametric coverage band thus every piecewise continuous function jump discontinuities inference method. test molecular clock phylogeny performed follows generate ensemble unconstrained phylogenetic trees. recommended choose outgroup taxon used root tree. outgroup branch must removed performing test. perform burn-in discarding least burnlog-likelihood scores stabilize therefore trees considered statistically equivalent. extract branch lengths tree convert real value non-negative integer average number substitutions multiplying branch length size alignment rounding value producing ensemble discrete integer-valued branch lengths. compute using discrete branch lengths ensemble formula here unadjusted sample size cut-off value determine number trees used test compute discrete mean branch length using branches item average value branch lengths compute expected cumulative distribution formula compute test statistics dpks formula unadjusted sample size compute adjusted sample size nadj compute appropriate critical value p-value using adjusted sample size nadj. simplest obtain critical values p-values tables campbell oprian conclusion dpks p-value smaller threshold null hypothesis rejected phylogeny clock-like precisely clock-like phylogenetic model data well enough dpks p-value bigger threshold null hypothesis rejected phylogeny clock-like precisely clock-like phylogenetic data well non-clock like phylogenetic model since clock-like model fewer parameters preferable. definition sample sizes unadjusted sample size defined number branches trees least number trees satisfies following conditions number taxa; dpks minimal respect best possible given condition satisfied. adjusted sample size defined nadj autocorrelation coefficient defined tess/t total number trees generated mcmc sampler burn-in tess effective sample size associated tree lengths computed mcmc sampler. two-sample kolmogorov-smirnov test molecular clock second proposal testing molecular clock apply test ensembles trees generated bayesian phylogeny inference. test performed follows generate ensemble unconstrained phylogenetic trees. recommended choose outgroup taxon used root tree. generate clock-constrained phylogenetic trees. clock tested strict clock trees rooted default hence outgroup taxon included. perform burn-in discarding least burnin log-likelihood scores stabilize therefore trees ensemble considered statistically equivalent. extract branch lengths real numbers tree ensembles. compute using branch lengths ensemble unconstrained phylogenetic trees formula sample size total number branches used compute compute using branch lengths ensemble clock-constrained phylogenetic trees formula replaced sample size total number branches used compute compute test statistics using formula compute adjusted sample sizes nadj madj compute appropriate critical value p-value using adjusted sample sizes nadj madj test critical values pvalues usual ones conclusion p-value smaller threshold null hypothesis rejected phylogeny clock-like precisely clock-like phylogenetic model data well enough p-value bigger threshold null hypothesis rejected phylogeny clocklike precisely clock-like phylogenetic data well non-clock like phylogenetic model. definition sample sizes unadjusted sample sizes defined number branches trees least number trees satisfies following conditions number taxa; dpks minimal respect best possible given condition satisfied. adjusted sample sizes defined nadj madj auto-correlation coefficient obtained clock-constrained ensemble auto-correlation coefficient obtained unconstrained ensemble associated tree lengths computed mcmc sampler before. nine-taxon tree used evolve simulated nucleotide sequences. dataset simulated sequences containing sequences nucleotides each using kimura -parameter nucleotide substitution model evolve sequences. ranch length distribution full tree weighted mixture independent poisson distributions parameters respectively. hypothesis poisson mixtures strengthened comparing obtained branch lengths full tree ensemble poisson cumulative distribution parameter cumulative distribution poisson mixture parameters weights performed test full tree purpose illustrating situation observed data poisson mixture. expected test concludes phylogeny clock-like p-value hand removed outgroup branch performed test ingroup test concluded phylogeny clock-like p-value also performed test outgroup test concluded tree clock-like p-value ecds branch lengths obtained ingroup outgroup ensembles respective expected cumulative poisson distributions shown c-d. poisson mixtures tree topology highly unbalanced branches much longer others expected long branches accumulate changes short branches. example tree perfectly clock-like branches equal length branch longer both. interior branch unlikely exactly length three exterior branches. cases tree clock-like would expect branch length distribution mixture several poisson distributions. cases test expected reject null hypothesis. mean tree clock-like even though branch length distribution multi-modal. would appropriate consider test inconclusive approaches directly test null hypothesis poisson mixture using branch lengths consensus several poisson parameters; apply test appropriate sub-trees; apply test. performing tests performed test proposed several ensembles trees obtained three types sequence data simulated sequences sequences generated vitro evolution three small datasets real sequences large data-set real sequences fungal rrna gene simulated data generated dataset simulated sequence containing sequences nucleotides each using kimura -parameter nucleotide substitution model evolve sequences. since counting process associated substitution model poisson process expected branch lengths follow poisson law. tree used evolve nucleotide sequences nine-taxon tree tree long branch corresponding outgroup sub-tree ingroup {s...s} consisting taxa. generated ensemble trees topology fixed nine-taxon tree taxon outgroup model used estimate substitution rates. first observe mean branch length ingroup mean branch length outgroup λ=.; outgroup branch approximately times longer branches ingroup. taking account tree unrooted consistent fact long branches accumulate average five times substitutions branches ingroup. mean branch approximately equal weighted average branch empirical cumulative distributions expected cumulative distributions simulated sequences ensemble. vertical dotted line indicates mean value. panels display full tree expected cumulative poisson distribution mean branch length expected cumulative poisson mixture respectively. panel displays ingroup expected cumulative poisson distribution mean branch length λ=.. panel displays outgroup expected cumulative poisson distribution mean branch length λ=.. results test real tree ensemble trees likely adjusted samples size obtained ensemble trees even though small relation ensemble capable providing enough information power test. another possibility tree topology well balanced hence test poisson mixture could provide another conclusion. small data-sets real sequences order illustrate method highly unbalanced tree topologies performed tests three dataenv viral gene sets real sequences immunodeficiency lentiviruses gene primates rrna gene ascomycete yeasts data-set generated ensembles trees non-clock strict clock relaxed clock model. vitro evolution data sequences nucleotides generated four-step serial bifurcate method ancestor sequence rrna gene evolved vitro nested cycles real phylogeny obtained experiment number substitutions branch shown generated ensemble trees additional outgroup taxon removed extraction branch lengths used general time reversible model estimate substitution rates even time-reversible). performed test ensemble trees real tree. test concluded phylogeny clock-like p-value hand performed consensus tree test concluded phylogeny clock-like p-value ecds branch lengths respective expected cumulative poisson distributions shown a-b. incongruence found mean branch length dpks nadj critical value p-value power estimate performed tests data-set consisting alignment sequences fungal rdna representative groups fungi representatives animal plants outgroup complete list taxa accession numbers phylogeny. generated ensembles trees non-clock strict clock relaxed clock model. performed test concluded phylogeny clock-like since tree extremely unbalanced expected branch length distributions multi-modal cases. however unbalanced topology tree clocklike. performed test unconstrained ensemble strict clock-constrained ensemble uncorrelated rates log-normal relaxed clock model test concluded phylogeny strict clock-like. moreover test concluded phylogeny clock-like relaxed clock model well ecds seems strict clock relaxed clock look similar. performed test strict clock-constrained ensemble relaxed clock-constrained ensemble expected test concluded clear ecds branch length distribution unconstrained ensemble highly over-dispersed relation relaxed clockconstrained ensembles. fact confidence band unconstrained ensemble excludes large portion ecds clock constrained ensembles case conclusion indicates relaxed clock models considered. performed test three ensembles. test concluded phylogenies clocklike three cases since trees highly unbalanced length distributions multi-modal cases. however test could concluded unbalanced topology tree clock-like. performed test unconstrained ensemble strict clock-constrained ensemble uncorrelated rates log-normal relaxed clock model test concluded phylogenies strict clock-like three cases three cases clear ecds branch length distribution unconstrained ensemble over-dispersed relation strict clock-constrained ensemble. hand test concluded phylogenies clock-like relaxed clock model nevertheless apparent ecds lentiviruses test overwhelmingly conclusive cases. difference cases seen constructing coverage bands three cases fact confidence band wide compared cases situation could resolved trying relaxed clock models and/or performing powerful twosample tests. empirical cumulative distributions sanson sequences ensemble. vertical dotted line indicates mean value. panels display empirical cumulative distribution observed data ensemble trees expected cumulative poisson distribution mean branch length empirical cumulative distribution observed data real tree expected cumulative poisson distribution mean branch length respectively. effective samples size achieved test capable providing enough information power test. noted test examine whether rate constant time. fact tested weather hypothesis tips tree equidistant root distances measured number substitutions. therefore evolutionary rate equally accelerating time lineages absence calibration tree ultra-metric although rate constant. second test cannot distinguish constant rate average variable rate within lineage although latter sensible explanation former clock rejected rate variable across lineages. present paper introduce non-parametric goodness-of-fit tests based empirical cumulative distribution context testing molecular clock phylogeny using branch lengths extracted ensemble statistically equivalent trees. ensemble statistically equivalent trees compute observed data instead consensus tree relieves applied directly consensus tree ensemble trees generated standard mcmc sampler test tests require extensive additional computations beyond standard mcmc sampler since test first type performed simple comparison test test order illustrate application. recall main points likelihood ratio test strict clock hypothesis parameters corresponding ages internal nodes rooted tree species. general non-clock hypothesis allows every branch rate. time rate confounded free parameters corresponding branch lengths unrooted tree. clock model equivalent non-clock model applying equality constraints. log-likelihood values clock nonclock models respectively compared critical value distribution degrees freedom decide whether clock hypothesis rejected order perform test trees generated bayesian inference must compute consensus trees performed test simulated data vitro evolution data order compare test perform test also needed compute clock-constrained consensus tree. cases null hypothesis phylogeny strictly clocklike rejected. incongruent result test performed ensemble trees obtained vitro evolution data likely phylogeny primates. taxa accession numbers troglodytes homo sapiens paniscus pongo abelii nomascus leucogenys macaca fascicularis musculus scale indicates substitutions position. issue non-independence trees fact bayesian phylogeny inference employs markov chain monte carlo sampler compute trees. addition well known critical values statistics sensitive sample auto-correlation actual false positive rate tends higher exists positive sample auto-correlation. result direct test might give misleading results used auto-correlated sample even though possible modify test account sample auto-correlations nevertheless sample auto-correlation process short range memory simple adjustments allows application test samples case autocorrelated samples fortunately adjustments already implemented mcmc samplers bayesian phylogeny inference. first adjustment called thinning sample consists discarding fixed number consecutive sampled trees tree included ensemble remaining trees almost independent other. second procedure called effective sample size sample autocorrelations information contained data less information contained sample size. words number equivalent independent observations fewer actual sample size. effective sample size size putative sample carries amount information correlated sample. effects small sample size issues related lack power lack information. directly verify whether phylogeny clock-like following poisson law. test simple apply could even performed simultaneously generation ensemble trees limited since restricted null hypothesis. test extended case poisson mixtures order allow flexible null hypothesis. test flexible allowing investigation whether phylogeny follows relaxed clock model intricate usage since requires generation comparison ensembles trees. test distinguish strict clock model relaxed clock model seems powerful enough distinguish relaxed clock model another. generally speaking methods possible replace tests another based goodness-of-fit test cramér-von mises test anderson-darling test another possible extension methods employ bayesian non-parametric goodness-of-fit tests. theoretical framework section provide theoretical basis tests described section start computation using branch lengths obtained ensemble trees. points must clarified fact trees used computation independent important issue since assumptions tests data used compute failure assumption cause pseudo-replication effect; appropriate sample size test many regarding definition appropriate sample size test reason issue ensemble trees used sample tests generated mcmc sampler original data sample size principle arbitrarily large. would artifact since input computation ensemble finite finite sequences cannot extract arbitrary amount information form computing arbitrarily large number sample trees. moreover known critical value test function sample size goes zero fast goes infinity hand since dpks zero goes infinity possible increase number trees used compute dpks null hypothesis always rejected thus rendering test completely useless. order circumvent difficulty proposed definition sample size terms least number trees dpks minimal respect given number taxa then null hypothesis rejected conditions increasing sample size change result although would artificially inflate power test. case adjusted sample size nadj ensures power inflated. hand null hypothesis rejected increasing sample size would artificially revert result. hence case nadj ensures reversion occur. failure reject null hypothesis different meanings depending magnitude nadj nadj sufficiently large rejected possible null hypothesis actually true; nadj small rejected test inconclusive lack information data ensemble trees generated. convenient able estimate power test order evaluate test correctly rejects null hypothesis true equivalently probability accepting alternative hypothesis true. however difficult compute asymptotic distribution statistics alternative hypothesis thus difficult compute power test. possible nevertheless find lower bound power evaluate rdna phylogeny ascomycetes. taxa accession numbers schizosaccharomyces pombe lachancea waltii eremothecium wickerhamomyces canadensis gossypii kluyveromyces polyspora nakaseomyces bacillisporus nakaseomyces delphensis candida glabrata naumovozyma castellii candida castellii saccharomyces bayanus saccharomyces saccharomyces cerevisiae paradoxus lachancea thermotolerants scale indicates substitutions position. authors discuss notion effective number independent observations auto-correlated time series specifically respect estimating mean variance distribution. furthermore demonstrated several hypothesis tests modified auto-correlated data using adjustment. example proposed modified mann-kendall trend detection test adjustment. similar test original mann-kendall test non-parametric test based sample assumption satisfied time series data. modification proposed simply replace actual sample size effective sample size computation p-value critical value. adjustment modified mannkendall provides correct rejection rate. propose type adjustment test replacing actual sample size effective sample size computed mcmc sampler tree length estimation. remarked strict clockconstrained tree branch lengths independent well. fact branch lengths constrained distance root tips tips. case adjustment takes account lack independence branch lengths employing coefficient associated tree length estimation. alignments made clustal phylogenies computed mrbayes model selection computed jmodeltest statistical software used prepare figures ecds confidence bands compute critical values p-values. phylogenetic tree manipulation branch length extraction made package simulation nucleotide sequence made seq-gen alternatively created simple program perform one-sample test. program imports output files generated mrbayes extract branch lengths ensemble trees. critical values computed using tables campbell oprian user choose three possible significance levels program outputs following information mean value variance log-likelihood scores ensemble trees; mean variance branch lengths measured number substitutions; statistics dpks critical value chosen significance level. finally possible plot branch expected poisson cumulative distribution. implementation test done python libraries numpy pylab matplotlib tkinter. historically tests used goodnessof-fit tests continuous distributions chi-square test commonly employed discrete data. author gives comprehensive review competitors. chi-square test statistics also written measure discrepancy expected cumulative distribution however take account natural ordering among observations fact exploited analysis attribute data. specifically chi-square test statistics invariant permutations. contrast test statistics sensitive over-weighting under-weighting tail segment empirical distribution relative hypothesized distribution. reason tests derive greater advantages main motivation behind several efforts adapt tests discrete data. finally interesting observe idea behind likelihood ratio test examining tips tree equidistant analogue non-parametric setting proposed here. tree ensemble tree branch randomly picked distance root computed. then distances tips root computed tested distribution follows poisson hint procedure might work provided analysis involving outgroup simulated example distance root close poisson distribution. potential importance variation test beyond empirical cumulative distributions confidence bands three data-sets real sequences. confidence band constructed around unconstrained ensemble. rdna blue curve underneath curve. alignments mrbayes command blocks used analyses described available supporting information compressed/zip file archive. https//www.dropbox.com/s/nhkslowzug/pksalignments.zip?dl= authors thank joseph felsenstein critical review manuscript valuable suggestions regarding sets branch lengths variables effects covariation long branches. work supported grants brazilian government agencies fapesp cnpq mrsb. empirical cumulative distributions unconstrained strict clock relaxed clock confidence band large data-set real sequences. confidence band constructed around unconstrained ensemble.", "year": "2015"}