{"title": "Using genotype abundance to improve phylogenetic inference", "tag": "q-bio", "abstract": " Modern biological techniques enable very dense genetic sampling of unfolding evolutionary histories, and thus frequently sample some genotypes multiple times. This motivates strategies to incorporate genotype abundance information in phylogenetic inference. In this paper, we synthesize a stochastic process model with standard sequence-based phylogenetic optimality, and show that tree estimation is substantially improved by doing so. Our method is validated with extensive simulations and an experimental single-cell lineage tracing study of germinal center B cell receptor affinity maturation. ", "text": "modern biological techniques enable dense genetic sampling unfolding evolutionary histories thus frequently sample genotypes multiple times. motivates strategies incorporate genotype abundance information phylogenetic inference. paper synthesize stochastic process model standard sequence-based phylogenetic optimality show tree estimation substantially improved method validated extensive simulations experimental single-cell lineage tracing study germinal center cell receptor aﬃnity maturation. although phylogenetic inference methods originally designed elucidate relationships groups organisms separated eons diversiﬁcation last several decades seen phylogenetic methods populations evolving timescale experimental sampling development spurred experimental techniques enable deep sequencing single-cell resolution enable quantiﬁcation original abundance. bulk sequencing random barcodes used quantify template abundance recently cell isolation combinatorial techniques provided sequence data single-cell resolution. data given unique genotype— among many data—is represented measured number cells. abundance genotype read number cells bearing genotype. demonstrate incorporating genotype abundance improves phylogenetic inference densely sampled evolutionary processes common sample genotypes once. motivated setting cell development germinal centers. cells cells make antibodies generally immunoglobulins. immunoglobulins encoded genes undergo stage rapid darwinian mutation selection called aﬃnity maturation aﬃnity maturation immunoglobulin membrane-bound form known cell receptor biological function process develop bcrs high-aﬃnity pathogen-associated antigen molecule later excrete large quantities associated antibody. aﬃnity maturation process occurs specialized sites called germinal centers lymph nodes speciﬁc cellular organization enable cells compete among bind speciﬁc antigen mutating bcrs mechanism called somatic hypermutation using micro-dissection researchers extract germinal centers model animals sequence genes encoding directly lymph node samples also available autopsy needle aspirates living subjects samples provide remarkable perspective ongoing evolutionary process. cells bcrs diﬀerentiated various times various cellular abundances. natural selection process germinal centers appears permissive variety bcrantigen aﬃnities earlier-appearing bcrs present time later-appearing bcrs. collection descendants single founder cell process naturally form phylogenetic tree. however tree genotype associated given abundance older ancestral genotypes present along recent appearances. reconstruction phylogenetic trees data beneﬁt methods designed account distinctive features. standard sequence-based methods inferring phylogenies fall several classes according optimality criteria. maximum likelihood methods posit probabilistic substitution model phylogeny tree maximizes probability observed data model bayesian methods augment likelihood prior distribution trees branch lengths substitution model parameters approximate posterior distribution variables markov chain monte carlo maximum parsimony methods combinatorial optimization tree minimizes number evolutionary events parsimony methods often result degenerate inference multiple trees achieve minimal number events additional approaches include distance matrix methods summarize data distances sequence pairs phylogenetic invariants select topologies based value polynomials calculated character state pattern frequencies. none methods incorporate genotype abundance information standard data duplicated genotypes reduced list deduplicated unique genotypes phylogeny inferred. paper show genotype abundance rich source information productively integrated phylogenetic inference provide open-source implementation incorporate abundance stochastic branching process inﬁnitely many types likelihoods tractable show used resolve degeneracy parsimony-based optimality. ﬁrst validate procedure simulations germinal center diversiﬁcation. also empirically validate method using experimental lineage tracing approach combining multiphoton microscopy single cell sequencing allowing study individual germinal center cell lineages brainbow mice. beyond setting development foresee direct application tumor phylogenetics single-cell studies cancer evolution single-cell implementations lineage tracing based genome editing technology given sequence data obtained diversifying cellular lineage tree goal infer genotype-collapsed tree deﬁning lineage distinct genotypes observed abundances gctree constructed lineage tree collapsing subtrees composed cells identical genotype single node annotated ﬁnal cellular abundance. data consists genotypes sampled least gctree along associated abundances. inﬁnite types assumption every mutant daughter generates novel genotype genotype identiﬁed subtree original lineage tree. claiming originality gctree deﬁnition useful word object. note that unlike standard phylogenetic trees leaf nodes represent observed genotypes gctree internal nodes represent observed genotypes annotated non-zero abundance. although leaves gctree nonzero abundance represents clonal sublineage resulted nonzero number leaves genotype lineage tree. node gctree along descending edges summarizes lineage outcome given genotype mutant oﬀspring clades number clonal leaves. summary completely specify genotype’s clonal lineage structure several branching structures consistent given node information figure genotype-collapsed trees. lineage illustrated distinct genotypes colored. ﬁnal observed cells consist genotypes various abundances; note yellow genotype observed. corresponding genotype-collapsed tree describes descent distinct genotypes inferential goal. genotype abundance informs topology inference. hypothetical gctrees equally optimal respect sequence data propose possible parents green genotype—the gray yellow genotypes intuitively abundance information indicates tree left preferable abundant parent likely generated mutant descendants. sequence data germinal center sample following characteristics perspective phylogenetics genotypes abundances limited amount mutation genotypes ancestral genotypes present along later ones. latter features suggest maximum parsimony useful tool limited amount mutation because ancestral genotypes assigned internal nodes tree reasons parsimony used extensively cell sequence analysis because many duplicate sequences inhibits efﬁcient tree space traversal studies inferred trees using unique genotypes ignores varying cellular abundances observed genotypes. wish branching process model rank trees equally optimal according sequence-level optimality criteria. indeed maximum parsimony often results degenerate inference many trees maximally optimal refer trees parsimony forest. later sections show using silico empirical data parsimony degeneracy common often severe sequencing data parsimony forests exhibit substantial variation phylogenetic accuracy. common practice arbitrarily select tree parsimony forest random without regard variability inference accuracy. instead rank trees parsimony forest auxiliary likelihood incorporates abundance information thereby resolving degeneracy. genotype abundance additional source information phylogenetics using simple intuition abundant genotypes likely mutant descendant genotypes. intuition makes sense relative sample abundance reasonable estimator relative total historical abundance total historical abundance related number mutant oﬀspring—i.e. genotypes larger abundance likely mutant descendant genotypes simply individuals available mutate. number mutant oﬀspring genotypes turn related number surviving mutant oﬀspring sampled. thus given equally parsimonious trees intuition would prefer tree mutant descendants frequently observed node formalize intuition using stochastic process model phylogenetic development germinal centers integrate model sequence-based tree optimality empirical bayes. follows well deﬁned given embedding tree plane. index refers root node refer children root node. level-order continues order tree nodes level nodes next level. adopting levelordering convention gctree containing nodes speciﬁed integer-valued random vectors giving topology abundances also observed genotype sequences associated node complete diversiﬁcation model would give joint distribution approximation model facilitating existing sequence-based optimality methods propose generative model containing conditional independences follows first model abundances tree topology drawn branching process likelihood conditioned parameters capture intuition abundant genotypes likely mutant descendant genotypes. next assume genotype sequences generated mutation model conditioned ﬁxed tree independent sequence-based optimality captured distribution dependent figure modeling sequences equipped abundances. genotype sequence data genotype abundance data inform tree topology illustrated probabilistic graphical model assume independence conditioned rather fully joint model facilitates using standard sequence-based phylogenetic optimality augmented branching process binary inﬁnite-type galton-watson process four possible branching events characterize oﬀspring distribution common nodes. node bifurcate terminate upon bifurcating descendants mutant gctree node speciﬁes genotype’s clonal leaf count number descendant genotypes lineage details. likelihood gctree node marginalizes consistent lineage branching outcomes. gctree likelihood factorizes product likelihoods genotype. empirical bayes treatment maximum likelihood estimate branching process parameters obtained marginalizing turn used approximate posterior conditioned data using parsimony sequence-based optimality rank trees parsimony forest model lineage tree subcritical inﬁnite-type binary galton-watson process extinct leaf nodes correspond observed cells. mutations inﬁnite-type process result novel genotype embodying assumption genotype identiﬁed subtree. subcriticality ensures branching process terminates ﬁnite time explicit sampling time needed. process initiated single cell runs eventual extinction. model highly idealized unable capture many biological realisms cell aﬃnity maturation sampling process. however show validations useful minimal model leveraging genotype abundance information tractable likelihood. oﬀspring distribution process governing reproduction mutation lineage tree nodes time steps speciﬁed parameters binary branching probability mutation probability oﬀspring distribution independent type subcriticality simply requires expected number oﬀspring node less case equivalent case mutation event causes evolving lineage change novel genotype thus corresponding oﬀspring distribution supports four distinct branching events letting denote number clonal mutant oﬀspring given node lineage tree respectively oﬀspring distribution compute likelihood hypothetical binary lineage tree simply evaluating node tree multiplying results. likelihood gctree given summing possible binary lineage trees consistent gctree thus marginalizing details intra-genotype branching events give rise abundance. show calculate gctree likelihood directly simple oﬀspring distribution work described calculate statistics inﬁnite-type branching process general subcritical oﬀspring distribution. first consider likelihood individual node gctree root node context branching process described above. gctree node speciﬁed abundance number edges descending general multiple distinct branching process realizations genotype result clonal leaves mutations genotype lineage subtree determining likelihood node gctree process denote marginalizing genotype lineage subtrees. materials methods derive recurrence marginalizing outcome branching event root lineage subtree genotype show gctree node likelihood computed dynamic programming. complete gctree containing nodes speciﬁed level-ordering nodes described oﬀspring distribution generates lineage branching genotype subtree recurrence applied gctree nodes. speciﬁcally show materials methods joint distribution nodes gctree factorizes genotype ranking parsimony trees gctree requires polynomial increase runtime compared ﬁnding parsimony forest np-hard figure depicts runtime simulations various size shows that practice increased runtime negligible. computational implementation inference method available http//github.com/ matsengrp/gctree. gctree inference subprogram accepts sequence data fasta phylip format determines parsimony forest unique sequences using dnapars program phylip package determines genotypecollapsed form trees outputs tree visualizations using package ranks according gctree likelihood using sequence abundances. bootstrap analysis also implemented providing conﬁdence values split maximum likelihood gctree. gctree maximizing branching process likelihood inference result. next show resolving parsimony degeneracy using gctree substantially increases accuracy precision phylogenetic inference. explore accuracy robustness gctree inference developed simulation subprogram generate random lineages starting naive sequence. simulated lineages true trees compared inferred gctree inference subprogram. stochastic process model used gctree inference intended minimal model captures intuition genotype abundance relevant phylogenetic reconstruction. experimental data need obey simplifying assumptions thus test gctree’s robustness deviations data generating process inferential model. simulation process implemented includes biological realisms cells undergoing realisms simulation—detailed materials methods—include branching process multifurcations sequence context sensitive mutations explicit sampling time incomplete sampling visualizations lineage tree gctree equivalent containing true gctree structure. gctree inference subprogram fasta data resulting inferred gctree compared true gctree calibrate simulation parameters deﬁned summary statistics sequence data abundance inforfigure demonstrating simulation– inference–validation workﬂow small simulation resulted equally maximally parsimonious trees inferred using gctree correct. initial sequence naive gene experimental data described materials methods. branch lengths cell lineage tree correspond simulation time steps collapsed trees correspond sequence edit distance. simulations performed parameters calibrated using sequencing data summary statistics described materials methods. simulations resulted parsimony degeneracy average degeneracy maximum degeneracy show distribution robinson–foulds distance trees parsimony forest true tree. denotes modiﬁed robinson-foulds distance since nonzero abundance internal nodes gctrees represent observed taxa distance computed nodes additional descendant leaf representing taxon. gctree mles tend better reconstructions true tree parsimony trees four simulations resulted gctree tied trees cases displayed red. aggregated data across simulations depicted right clearly indicating superior reconstructions gctree. validation shows using abundance information branching process likelihood substantially improve inference results simulation ranked otherwise degenerately optimal parsimony trees using gctree. parsimony forest compared gctrees forest true gctree simulation using robinson–foulds distance measure tree reconstruction accuracy. maximum likelihood gctree tends closer true tree equally parsimonious trees vary widely accuracy showing gctree able leverage abundance data resolve parsimony degeneracy improve accuracy tree reconstruction simulation regime. next performed biological validation investigating gctree improves inference according biological criteria using real germinal center sequence data. heterodimer encoded immunoglobulin heavy chain immunoglobulin light chain loci. loci undergo recombination evolve tandem aﬃnity maturation. obtaining matched sequences loci using singlecell isolation independent data sets inform phylogeny distinct cells performing separate independent tree inference validate gctree comparing inferred tree inferred tree. gctree likelihood meaningfully ranks equally parsimonious trees trees would expected correct reconstructions parsimony trees. thus expect trees similar pairs parsimony trees conversely gctree likelihood meaningfully ranking trees expect trees significantly closer pairs used data previously reported experiment multiphoton microscopy sequencing combined resolve individual germinal center cell lineages mouse lymph nodes days subcutaneous immunization alum-adsorbed chicken gamma globulin brainbow mice used multicolor cell fate mapping enabling cells progeny permanently tagged diﬀerent ﬂuorescent proteins. in-situ photoactivation followed ﬂuorescence-activated cell sorting yielded cells color-dominant germinal center sequences obtained cells lineage single cell mrna sequencing loci resulting distinct distinct genotypes mutations acquired aﬃnity maturation. unmutated naive rearranged sequences inferred partis using sequences clonal family using germline genetic information naive sequences used outgroups rooting parsimony trees. gctree results depicted figure parsimony analysis resulted degeneracy loci equally parsimonious trees igl. empirical bayes point estimation according yielded gctree likelihoods computed rank equally parsimonious trees trees shown support values among bootstrap samples binary galton-watson process assigns probability zero gctree node frequency zero mutant descendant unobserved naive root node given unit pseudocount. compared concordance pairs heavy light trees. since loci recorded cells units cell abundance gctree units cell abundance gctree consider consistency given tree given tree terms lineage cell identities. possible figure empirical validation using lineage tracing single cell germinal center sequencing. multiphoton image germinal center reveals dominant blue lineage lineage sorted cells sequenced determine genotypes each. sequences analyzed partis infer naive ancestor sequences using germline genetic information trees inferred gctree. gctree inference performed separately loci resulting parsimony degeneracies respectively. maximum likelihood gctrees locus indicated gctrees annotated abundance shown. roots labeled gene annotations naive state inferred using partis. small unnumbered nodes indicate inferred unobserved ancestral genotypes. numbered edges indicate support bootstrap samples. possible pairings parsimony trees compared terms robinson-foulds distance trees labeled cell identity. parsimony trees ordered gctree likelihood rank columns rows respectively. grid values show distance igh/igl pair. trees result consistent cell lineage reconstructions locus distributions bootstrap support values shown tree inferred gctree majority rule consensus tree trees parsimony forest. latter contain partitions support. using additional data second germinal center lymph node naive sequence gctree correctly resolves germinal centers distinct clades pairing parsimony tree parsimony tree computed distance between trees using cell identities deﬁne splits. observed gctree based sequences gctree based sequences form concordant pair among pairs parsimony trees moreover pairs parsimony trees contained least gctree tree ranked consistently higher terms similarity. assessed conﬁdence gctree partitions comparing bootstrap support values gctree trees majority-rule consensus parsimony trees made using consense program phylip package observed latter contained excess conﬁdence partitions results demonstrate parsimony reconstructions real data sets suﬀer degeneracy gctree likelihood correctly resolve degeneracy incorporating abundance information ignored previously published methods. finally using data collected second germinal center lymph node tested gctree’s ability correctly group cells germinal center separate clades combined data germinal centers. germinal center sequence data sets appeared naive sequence indicating seeded cell lineage. concatenating sequences cell germinal center used gctree infer single tree cells germinal centers gctree correctly resolved germinal centers distinct clades demonstrates phylogenetic resolvability germinal centers naive diversifying selection antigen speciﬁcity. shown genotype abundance information productively incorporated phylogenetic inference. augmenting standard sequencebased phylogenetic optimality stochastic process likelihood able implement abundance-aware inference processing step downstream results existing widely used parsimony tree inference tool. shown method—implemented publicly available gctree package—is useful inferring cell receptor aﬃnity maturation lineages. although branching processes used previously infer parameters evolution construct lineage trees error-prone bulk sequencing reads knowledge ﬁrst branching processes sharpen phylogenetic inference bcrs sequenced single-cell resolution germinal centers. believe gctree settings sequence data dense quantitative sampling diversifying loci available. studies cancer evolution increasingly performed single-cell resolved sequencing however tumor phylogenetics approaches standard phylogenetic methods model genotype abundance. exceptions include onconem scite leverage single-cell data tumor phylogenetic inference robust genotyping errors missing data capture intuition genotype abundance number direct mutant descendants related. singlecell implementations lineage tracing based genome editing technology also beneﬁt reconstruction methods model abundance observed editing target states since cell types vary widely rates proliferation. using parsimony sequence-based optimality resulted particularly simple results tree space necessary explore exactly degenerate parsimony forest. however empirical bayes formulation agnostic particular choice sequence-based optimality future envision augmenting likelihood-based sequence optimality. require computationally expensive tree space search sampling schemes. contrast gctree fully bayesian approach incorporate genotype abundance could full sequences bayesian phylogenetics package—such beast —with birth-death process prior. would enforce inﬁnite-type assumption identical sequences could placed disjoint subtrees. however approach scale well many identical sequences trees diﬀer exchange identical sequences create islands constant posterior tree space. methods currently exist tree space traversal avoids moves within islands. even methods existed would need combined algorithms infer trees sampled ancestors well multifurcations even combination currently available. although methods applied sequence-based optimality functions besides parsimony important recognize gctree contains inherent weak parsimony assumption unique genotype arose mutation lineage therefore corresponds single subtree lineage tree thus single node gctree. thus important continue assess impact weak parsimony assumption simulation make assumption done here. gctree framework also extended non-neutral models. example could consider model genotype obtains random ﬁtness encoded branching process parameters ﬁxed within given genotype randomly drawn genotype founder cell upon mutation parent. likely necessitate modeling genotype birth time explicitly rather restricting extinct subcritical processes since genotype small abundance result ﬁtness young age. might also consider extending oﬀspring distribution separately model synonymous nonsynonymous mutations. synonymous mutations change ﬁtness nonsynonymous mutations change ﬁtness described above. another direction extension incorporate mutation models specialized case evolution model used simulation study. arman bilge originally suggested using branching processes investigate process. work greatly improved discussions amaury lambert kristian davidsen. research supported part national human genome research institute genome training grant acknowledge research support grant acknowledge research support grant grants cise- cise-. research supported part faculty scholar grant howard hughes medical institute simons foundation well grant conceived developed statistical methods analyzed data wrote manuscript. wrote software consultation fam. developed performed brainbow mouse experiments developed intuition formalized gctree algorithm consulted data analysis.", "year": "2017"}