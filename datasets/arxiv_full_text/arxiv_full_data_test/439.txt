{"title": "Minimap2: pairwise alignment for nucleotide sequences", "tag": "q-bio", "abstract": " Motivation: Recent advances in sequencing technologies promise ultra-long reads of $\\sim$100 kilo bases (kb) in average, full-length mRNA or cDNA reads in high throughput and genomic contigs over 100 mega bases (Mb) in length. Existing alignment programs are unable or inefficient to process such data at scale, which presses for the development of new alignment algorithms.  Results: Minimap2 is a general-purpose alignment program to map DNA or long mRNA sequences against a large reference database. It works with accurate short reads of $\\ge$100bp in length, $\\ge$1kb genomic reads at error rate $\\sim$15%, full-length noisy Direct RNA or cDNA reads, and assembly contigs or closely related full chromosomes of hundreds of megabases in length. Minimap2 does split-read alignment, employs concave gap cost for long insertions and deletions (INDELs) and introduces new heuristics to reduce spurious alignments. It is 3-4 times faster than mainstream short-read mappers at comparable accuracy and $\\ge$30 times faster at higher accuracy for both genomic and mRNA reads, surpassing most aligners specialized in one type of alignment.  Availability and implementation: https://github.com/lh3/minimap2  Contact: hengli@broadinstitute.org ", "text": "article describe minimap algorithm applications different types input sequences. evaluate performance accuracy minimap several simulated real data sets demonstrate versatility minimap. methods minimap follows typical seed-chain-align procedure used full-genome aligners. collects minimizers reference sequences indexes hash table hash minimizer value list locations minimizer copies. query sequence minimap takes query minimizers seeds ﬁnds exact matches reference identiﬁes sets colinear anchors chains. base-level alignment requested minimap applies dynamic programming extend ends chains close regions adjacent anchors chains. minimap uses indexing seeding algorithms similar minimap furthers predecessor accurate chaining ability produce base-level alignment support spliced alignment. chaining chaining anchor -tuple indicating interval reference matching interval query. given list anchors sorted ending reference position maximal chaining score i-th anchor list. calculated dynamic programming average seed length. anchors directly computing takes time. although theoretically faster chaining algorithms exist inapplicable generic cost complex implement usually associated large constant. introduced simple heuristic accelerate chaining. note anchor chained chaining predecessor likely yield lower score. evaluating start anchor stop process cannot better score iterations. approach reduces average time practice almost always optimal chain even heuristic fails optimal chain often close. backtracking index best predecessor anchor equals argmaxj{f otherwise. anchor descending order apply repeatedly predecessor mark visited ‘used’ reach abstract motivation recent advances sequencing technologies promise ultra-long reads kilo bases average full-length mrna cdna reads high throughput genomic contigs mega bases length. existing alignment programs unable inefﬁcient process data scale presses development alignment algorithms. results minimap general-purpose alignment program long mrna sequences large reference database. works accurate short reads length genomic reads error rate full-length noisy direct cdna reads assembly contigs closely related full chromosomes hundreds megabases length. minimap split-read alignment employs concave cost long insertions deletions introduces heuristics reduce spurious alignments. times fast mainstream short-read mappers comparable accuracy times faster longread genomic cdna mappers higher accuracy surpassing aligners specialized type alignment. availability implementation https//github.com/lh/minimap contact henglibroadinstitute.org introduction single molecule real-time sequencing technology oxford nanopore technologies produce reads length error rate several aligners developed data times slow mainstream short-read aligners terms number bases mapped second. speculated could substantial room speedup thought long sequences easier reads effectively skip repetitive regions often bottleneck short-read alignment. conﬁrmed speculation achieving approximate mapping times faster bwa-mem suzuki kasahara extended work fast novel algorithm generating base-level alignment turn inspired develop minimap added functionality. smrt applied sequencing spliced mrnas traditional mrna aligners work optimized long noisy sequence reads tens times slower dedicated long-read aligners. developing minimap initially aligning genomic only realized minor modiﬁcations could enable base algorithm mrnas well. minimap becomes ﬁrst rna-seq aligner speciﬁcally designed long noisy reads. also extended original algorithm short reads speed faster several mainstream short-read mappers. without losing generality always assume ˜q+˜e. condition applies cost gaps shorter applies longer gaps. scheme helps recover longer insertions deletions suzuki-kasahara formulation allow gaps longer several hundred base pairs nucleotide-level alignment much slower chaining. acceleration critical performance minimap. traditional implementations based achieve -way parallelization short sequences -way parallelization peak alignment score reaches long sequence alignment exceed threshold. inspired following work suzuki kasahara proposed difference-based formulation lifted limitation. case -piece absence copy number changes query segment mapped places reference. however chains found previous step signiﬁcant complete overlaps repeats reference minimap used following procedure identify primary chains greatly overlap query. empty initially. chain best worst according chaining scores query chain overlaps chain higher percentage shorter chain mark chain secondary chain otherwise chain contains primary chains. choose sophisticated data structure step performance bottleneck. denotes natural logarithm number anchors primary chain chaining score score best chain secondary primary chain. intuitively chain assigned higher mapping quality long best secondary chain weak. estimating per-base sequence divergence suppose query sequence harbors seeds length present chain. want estimate sequence divergence query reference sequences chain. useful baselevel alignment expensive perform. model substitutions homogeneous poisson process along query sequence probablity seeing consecutive bases without substitutions e−k\u0001. assumption k-mers independent other likelihood function reality sequencing errors sometimes clustered k-mers independent other especially take minimizers seeds. violate assumptions derivation above. result approximate biased. also ignores long deletions reference sequence. practice fortunately often close strongly correlated sequence divergence estimated base-level alignments. several datasets used section spearman correlation coefﬁcient around string string denoted constructed contracting homopolymers single base. k-mer k-long substring hpc. example suppose ggattttcca gatca ﬁrst -mer gatc. demonstrate effectiveness k-mers performed read overlapping example coli smrt reads pbcr using different types k-mers. normal minimizers window minimap ﬁnds overlaps inferred read-to-reference alignment. -mers window minimap ﬁnds overlaps. achieves higher sensitivity indexing fewer minimizers helps performance. hpc-based indexing reduces sensitivity current reads though. formulation cells diagonal index independent other. allows fully vectorize computation cells anti-diagonal inner loop. also simpliﬁes banded alignment would difﬁcult striped vectorization performing global alignment need compute cell. -way vectorization throughout alignment process. extending alignments ends chains need cell reaches maximum. resort -way vectorization compute hr−t urt. computation simple still dominant performance bottleneck. practice -way vectorized implementation global alignment three times fast parasail’s -way vectorization without banding implementation slower edlib band considerably faster. performing global alignment anchors expect alignment stay close diagonal matrix. banding applicable time. z-drop heuristic global alignment minimap force align unrelated sequences adjacent anchors. avoid artifact compute accumulative alignment score along alignment path break alignment score drops fast diagonal direction. precisely alignment score along alignment path ending cell matrix. break alignment exist extension cost arbitrary threshold. strategy ﬁrst used bwa-mem. similar x-drop employed blast unlike x-drop would break alignment presence single long gap. performs local alignment subsequences involved global alignment time subsequence reverse complemented. additional alignment step identify short inversions missed chaining. filtering misplaced anchors sequencing errors local homology anchors chain wrong. blindly align regions misplaced anchors produce suboptimal alignment. reduce artifact ﬁlter anchors lead insertion deletion time ﬁlter terminal anchors lead long towards ends chain. heuristics greatly alleviate issues misplaced anchors unable errors. local misalignment limitation minimap hope address future. aligning spliced sequences algorithm described adapted spliced alignment. mode chaining cost distinguishes insertions deletions reference takes form models acceptor signal. close equation zhang gish except allow insertions immediately followed deletions vice versa; addition suzuki-kasahara diagonal formulation actual implementation. rna-seq reads sequenced stranded libraries read strand relative underlying transcript unknown. default minimap aligns chain twice ﬁrst assuming gt–ag splicing signal assuming ct–ac reverse complement gt–ag splicing signal. alignment higher score taken ﬁnal alignment. procedure also infers relative strand reads span canonical splicing sites. spliced alignment mode minimap increases density minimizers disables banded alignment. together two-round dp-based alignment spliced alignment several times slower genomic alignment. aligning short paired-end reads chaining minimap takes pair reads fragment unknown length middle. applies normal cost seeds read permissive cost seeds different reads. precisely cost chaining fig. evaluation aligning simulated reads. simulated reads mapped primary assembly human genome grch. read considered correctly mapped longest alignment overlaps true interval overlap length true interval length. read alignments sorted mapping quality descending order. mapping quality threshold fraction alignments mapping quality threshold error rate plotted along curve. long-read alignment evaluation. reads simulated using pbsim error proﬁle sampled *..*’ downloaded http//bit.ly/chmpc. read length aligners default setting smrt reads. kart outputted alignments mapping quality shown ﬁgure. mapped nearly reads alignments wrong less accurate others. short-read alignment evaluation. million pairs reads simulated using mason option ‘–illumina-prob-mismatch-scale short-read aligners default setting except changing maximum fragment length identifying primary chains split fragment chain read chains perform alignment read section finally pair hits read consistent paired-end alignments. results minimap implemented programming language comes apis python. distributed license free commercial academic uses. minimap uses base algorithm applications apply different sets parameters depending input data types. similar bwa-mem minimap introduces ‘presets’ modify multiple parameters simple invocation. detailed settings command-line options found minimap manpage. addition applications evaluated following sections minimap also retains minimap’s functionality overlaps long reads search large multispecies databases ncbi. aligning long genomic reads sanity check evaluated minimap simulated human reads along blasr bwa-mem graphmap kart minialign ngmlr excluded rhat lamsa either crashed produced malformatted output. evaluation minimap higher power distinguish mouse cdna reads mapped primary assembly mouse genome grcm following tools command options minimap gmap spaln starlong alignments compared ensembl gene annotation release predicted intron novel overlaps annotated introns. intron exact identical annotated intron. intron approximate ’’-end within around ends annotated intron. chimeric alignments deﬁned spec unique repetitive hits achieves overall higher mapping accuracy minimap ngmlr provide better mapping quality estimate rarely give repetitive hits high mapping quality. apparently aligners occasionally miss close suboptimal hits overconﬁdent wrong mappings. time minimap took seconds comparable minialign kart times faster rest. minimap consumed memory peak bwa-mem similar ngmlr less others. real human smrt reads relative performance fraction mapped reads reported aligners broadly similar metrics simulated data. unable provide good estimate mapping error rate lack truth. human reads bwa-mem failed. kart minialign minimap times faster others. also examined tens indels conﬁrm observation sedlazeck bwa-mem often breaks shorter gaps. issue much alleviated minimap thanks -piece afﬁne cost. aligning long spliced reads evaluated minimap sirv control data truth known. minimap predicted introns reads. splice juctions precise. examined wrongly predicted junctions found majority caused clustered splicing signals indel sequencing errors frequent difﬁcult precise splicing sites case. allow distance true splicing sites aligned introns approximately correct. worth noting sirv asked minimap model gt..ag splicing signal without extra bases. sirv honor evolutionarily prevalent signal gt..ag next aligned real mouse reads gmap minimap spaln star general minimap consistent existing annotations ﬁnds junctions higher percentage exactly approximately correct. minimap times faster gmap spaln. star close minimap speed work well noisy reads. also evaluated spliced aligners human nanopore direct rna-seq dataset minimap aligned million reads wall-clock hour using cores. aligned splice junctions consistent gene annotations. comparison gmap option –min-intronlength –cross-species’ times slower; gmap junctions found known gene annotations. percentage increases aligned junction within annotated junction considered correct. public iso-seq dataset minimap also faster higher junction accuracy comparison aligners table aligning short genomic reads evaluated minimap along bowtie bwa-mem snap minimap times fast bowtie bwa-mem times slower snap. minimap accurate simulated data bowtie snap less accurate bwa-mem closer investigation reveals bwamem achieves higher accuracy partly tries locally align read small region close mate. disable feature bwa-mem becomes slightly less accurate minimap. might implement similar heuristic minimap future. evaluate accuracy minimap real data aligned human reads bwa-mem minimap called snps small indels gatk haplotypecaller sequenced experimentally mixed cell lines. homozygous across whole genome novo assembled smrt reads high quality. allowed construct independent truth variant dataset err. evaluation minimap higher false negative rate fewer false positive snps million bases similar indel similar indel fppm minimap broadly comparable bwa-mem context small variant calling. aligning long-read assemblies minimap align smrt assembly grch minutes using cores times faster nucmer mummer paftools.js script minimap package called million single-base substitutions .gbp genomic regions. transition-to-transversion ratio comparison using mummer’s dnadiff pipeline called million substitutions .gbp ts/tv=.. given ts/tv averaged across human genome ts/tv averaged random errors minimap callset arguably higher precision lower sensitivity. sample assembled female. minimap still called substitutions chromosome. substitutions come contig aligned sequence identity. contig could segmental duplication absent grch. constrast dnadiff called substitutions chromosome across smrt contigs. implies minimap-based pipeline higher precision. discussions minimap versatile mapper pairwise aligner nucleotide sequences. works short reads assembly contigs long noisy genomic rna-seq reads used read mapper long-read overlapper full-genome aligner. minimap also accurate efﬁcient often outperforming domainspeciﬁc alignment tools terms speed accuracy. capability minimap comes fast base-level alignment algorithm accurate chaining algorithm. aligning long query sequences base-level alignment often performance bottleneck. suzuki-kasahara algorithm greatly alleviates bottleneck enables dp-based splice alignment involving introns impractically slow years ago. minimap chaining algorithm fast highly accurate itself. fact chaining alone accurate long-read mappers fig. accuracy helps reduce downstream base-level alignment candidate chains still several times slower chaining even suzuki-kasahara improvement. addition taking general form minimap chaining adapted non-typical data types spliced reads multiple reads fragment. gives opportunity extend base algorithm variety cases. modern mainstream aligners often full-text index sufﬁx array fm-index index reference sequences. advantage approach exact seeds arbitrary lengths helps increase seed uniqueness reduce unsuccessful extensions. minimap indexes reference kmers hash table instead. ﬁxed-length seeds inferior variable-length seeds theory computed much efﬁciently practice. query sequence multiple seed hits afford skip highly repetitive seeds without affecting ﬁnal accuracy. alleviates concern seeding uniqueness. time sequence identity rare long seeds anyway. hash table ideal data structure mapping long noisy sequences. acknowledgements debt gratitude suzuki kasahara releasing masterpiece insightful notes formal publication. thank schatz rescheneder sedlazeck pointing limitation bwa-mem. also grateful minimap users greatly helped suggest features various issues. byrne nanopore long-read rnaseq reveals widespread transcriptional variation among surface receptors individual cells. commun chaisson tesler mapping single molecule sequencing reads using basic local alignment successive reﬁnement application theory. bioinformatics holtgrewe mason read simulator second generation sequencing data. technical report tr-b-- institut f¨ur mathematik informatik freie universit¨at berlin. iwata gotoh benchmarking spliced alignment programs including spaln extended version spaln incorporates additional species-speciﬁc features. nucleic acids", "year": "2017"}