{"title": "WAND: A 128-channel, closed-loop, wireless artifact-free neuromodulation  device", "tag": "q-bio", "abstract": " Closed-loop neuromodulation systems aim to treat a variety of neurological conditions by dynamically delivering and adjusting therapeutic electrical stimulation in response to a patient's neural state, recorded in real-time. Existing systems are limited by low channel counts, lack of algorithmic flexibility, and distortion of recorded signals from large, persistent stimulation artifacts. Here, we describe a device that enables new research applications requiring high-throughput data streaming, low-latency biosignal processing, and truly simultaneous sensing and stimulation. The Wireless Artifact-free Neuromodulation Device (WAND) is a miniaturized, wireless neural interface capable of recording and stimulating on 128 channels with on-board processing to fully cancel stimulation artifacts, detect neural biomarkers, and automatically adjust stimulation parameters in a closed-loop fashion. It combines custom application specific integrated circuits (ASICs), an on-board FPGA, and a low-power bidirectional radio. We validate wireless, long-term recordings of local field potentials (LFP) and real-time cancellation of stimulation artifacts in a behaving nonhuman primate (NHP). We use WAND to demonstrate a closed-loop stimulation paradigm to disrupt movement preparatory activity during a delayed-reach task in a NHP in vivo. This wireless device, leveraging custom ASICs for both neural recording and electrical stimulation modalities, makes possible a neural interface platform technology to significantly advance both neuroscientific discovery and preclinical investigations of stimulation-based therapeutic interventions. ", "text": "wand -channel closed-loop wireless artifact-free neuromodulation device andy zhou* samantha santacruz* benjamin johnson* george alexandrov moin fred burghardt rabaeyŧ jose carmenaŧ rikky mullerŧ department electrical engineering computer sciences university california berkeley berkeley helen wills neuroscience institute university california berkeley berkeley cortera neurotechnologies inc. berkeley correspondence addressed r.m. closed-loop neuromodulation systems treat variety neurological conditions dynamically delivering adjusting therapeutic electrical stimulation response patient’s neural state recorded real-time. existing systems limited channel counts lack algorithmic flexibility distortion recorded signals large persistent stimulation artifacts. here describe device enables research applications requiring high-throughput data streaming low-latency biosignal processing truly simultaneous sensing stimulation. wireless artifact-free neuromodulation device miniaturized wireless neural interface capable recording stimulating channels on-board processing fully cancel stimulation artifacts detect neural biomarkers automatically adjust stimulation parameters closed-loop fashion. combines custom application specific integrated circuits on-board fpga low-power bidirectional radio. validate wireless long-term recordings local field potentials real-time cancellation stimulation artifacts behaving nonhuman primate wand demonstrate closedloop stimulation paradigm disrupt movement preparatory activity delayed-reach task vivo. wireless device leveraging custom asics neural recording electrical stimulation modalities makes possible neural interface platform technology significantly advance neuroscientific discovery preclinical therapeutic interventions. closed-loop neuromodulation improves open-loop therapeutic electrical stimulation providing adaptive on-demand therapy reducing side effects extending battery life wireless devices. closing loop requires low-latency extraction accurate estimation neural biomarkers– recorded signals automatically adjust administer stimulation feedback brain. recent studies shown responsive stimulation viable option treating epilepsy evidence closed-loop strategies could improve deep brain stimulation treating parkinson’s disease motor disorders. however presently commercial device allowing closed-loop stimulation patients movement disorders strategies implementing stimulation still investigation. fact attempts close loop treatments done short duration using non-fully implantable systems–. enable advanced research closed-loop neuromodulation need flexible research platform testing implementing various closed-loop paradigms also wireless compact robust safe. designing device requires unification multi-channel recording biomarker detection microstimulation technologies single unit careful consideration interactions. wireless multi-channel recording-only devices capture activity wide neuronal populations built-in ability immediately information deliver stimulation. several complete closed-loop devices proposed demonstrated limited channelcounts– wireless streaming bandwidth–. recently number fully-integrated optimized closed-loop neuromodulation socs presented full system functionality adequately demonstrated vivo–. future versions paired miniaturized external battery packs controllers current systems built around socs require large stationary devices deliver power inductively close range. limits studies using small caged animals. furthermore device concurrent sensing stimulation must able mitigate remove stimulation artifacts large voltage transients resulting stimulation distort recorded signals obscure neural biomarkers. signals recorded concurrently stimulation contain relevant information closed-loop algorithms offline analysis existing devices disregard affected windows data fail reduce artifacts acceptable level recovery many potentially useful biomarker features. effectively efficiently cancelling artifacts requires careful co-design stimulators signal acquisition chains. additionally computational reprogrammability needed application-dependent algorithm design artifact cancellation closed-loop control. wireless artifact-free neuromodulation device introduced first knowledge incorporate features needed continuously monitor neural biomarkers presence stimulation artifacts deliver closed-loop stimulation. wand combines custom -channel neural interface application specific integrated circuits supporting simultaneous low-noise recording high-current stimulation specifically designed minimize stimulation artifact; flexible reprogrammable back-end processing system-on-a-chip field-programmable gate array cancelling residual artifacts computing neural biomarkers running closed-loop algorithms controlling stimulation; robust bidirectional wireless link graphical user interface device configuration control well data logging. features tightly integrated small form factor low-power device enabling many proposed closed-loop responsive neuromodulation applications well offering platform developing ones. demonstrate various functions wand perform series vivo experiments validate long-term high-fidelity wireless multi-channel recording; real-time complete removal stimulation artifacts accurate recovery neural signals; on-board biomarker detection closed-loop control. wand designed general-purpose tool immediate applicability various research environments. inclusion wide feature-set balanced limitations device size power. integrated circuits required minimize area power large number recording stimulation channels. designed custom neuromodulation integrated circuit deliver stimulation pulses ranging subthreshold currents required record local field potentials bandwidth chose signal interest usefulness medical applications indicator disease–. also evidence used motor decoding brain-machine interfaces– comparable accuracy better longevity spike decoders. signal also extremely useful understanding neural processing incredibly relevant variety basic neuroscience studies investigating neural oscillations coordinate movement– cued transitions dynamic states cortico-basal ganglia circuits working memory. finally lower sampling rate required recording utilizes lower wireless bandwidth real-time streaming allowing low-power off-the-shelf radios. numerous high channel count recording circuits designed state-of-the-art circuits cannot tolerate often exacerbate effects stimulation artifacts. electrical stimulation generates large voltage transient concomitant stimulation current charge delivery neural tissue nearby electrodes. direct artifact many orders magnitude larger underlying neural signal followed long post-stimulus voltage decay determined mismatch stimulation phases electrode properties. conventional low-noise low-power neural amplifiers sensitive direct indirect artifact saturating both. recover slowly saturation long time constants analog feedback causing data loss many milliseconds stimulation pulse. state-of-theart methods mitigating indirect artifact prevent saturation front-ends. saturation prevented increasing amplifier linear input range tolerance offset subtracting large amplitude components artifact. artifact duration reduced rapidly clearing charge built circuit elements stimulation. designed nmics improved stimulation recording architectures prevent large indirect artifacts minimize effects front-end circuits. date even best results front-end artifact mitigation demonstrate complete artifact removal necessitating back-end digital cancellation residual artifacts. computationally efficient back-end methods include subtractive methods artifact templates subtracted waveform reveal underlying signal reconstructive methods segments corrupted data replaced interpolated values–. different techniques achieve better results others depending level mitigation achieved front-end amplifiers. overall system resiliency stimulation artifact depends heavily co-design stimulator recording front-end signal processing blocks. work demonstrate specific artifact prevention mitigation techniques utilized nmics motivate implementation back-end linear interpolation on-board fpga completely remove stimulation artifacts real time. particular reduced artifact duration allows computationally inexpensive effective back-end cancellation solution cost losing samples. innovations allow online real-time biomarker computation closed-loop stimulation. results wand architecture wand components architecture shown fig. work form factor designed polyetherimide housing custom chronically implanted microelectrode array device board area weight together rechargeable li-ion battery pack allowing hours continuous wireless operation main components wand pair custom nmics fpga radio support circuitry power regulation programming nmic consists recording channels stimulators address channels meaning stimulation occur simultaneously channels leveraging stimulators across on-board nmics. multi-site stimulation desirable implementing specific spatiotemporal patterns stimulation many recent studies performing stimulation channels simultaneously–. using wand stimulation channels dynamically assigned thus allowing device utilized multi-site stimulation channels concurrently highly flexible manner. ultimately stimulation delivered using open-loop paradigm closed-loop approach relies continuous sensing onboard computed biomarkers. stimulation parameters rapidly reprogrammable writing registers nmic commands transmitted automatically based calculations performed on-board. stimulation settings listed supplementary fig. well selection stimulation sites triggering pulses interface. setting preloaded stimulating previous setting potentially reducing latency biomarker state detection resulting stimulation update. unlike conventional neural interface nmics enable simultaneous low-noise low-power neural recording high-compliance electrical stimulation nmic prevents large amplitude indirect artifacts employing stimulators highly accurate charge balancing. accurate charge balancing achieved reusing current source phases biphasic pulse return-to-ground stimulator architecture address direct indirect artifact nmic recording front-ends designed simultaneously noise recording large linear input range input range times larger conventional designs avoids saturation presence large stimulation artifacts still able resolve level neural signals. large range resolvable signals achieved mixed-signal architecture integrates feedback loop thereby reducing required gain signal swings. architecture also resets every sample enabling memoryless sampling rapid recovery stimulation artifacts therefore stimulation artifacts persist beyond samples stimulation occurring minimal amount data lost using reconstructive back-end cancellation methods interpolation. channels neural data nmics sampled digitized serialized chip transmitted on-board fpga microcontroller custom bidirectional interface implemented fpga fabric. interface used downlink commands control nmic circuitry update stimulation parameters software running included cortex microprocessor aggregates neural sensor data cancels stimulation artifact selects subset data streamed back base station runs closed-loop neuromodulation algorithms fpga fabric cortex software reprogrammable serial wire debug interface allowing customization different applications. bluetooth energy radio allows robust bidirectional wireless communication subject. offers power telemetry customization protocol enables data streaming rates close mbps modulation rate. wand stream uncompressed recording channels real time running custom system configuration data visualization. figure wand system architecture. model wand primate headstage battery pack shown without polyetherimide case. topbottom-view photographs wand circuit board relevant subsystems annotated. micrograph custom neural interface annotated subcircuits. functional diagram wand system showing data power connections main device board connections microdrive electrode array battery wireless base station. evaluate quality recordings made using wand recorded channels activity using chronically implanted microdrive electrode array access cortical subcortical nuclei compared wand recordings sequentially recorded neural data wired state-of-the-art commercial neurophysiology system respective recordings system qualitatively similar signal properties assessed computing power spectral densities recorded data wand recordings exhibit lower interference lack long interface cables better isolated recording references. figure wireless multi-channel recording. representative -second segments simultaneous recordings channels taken freely moving behavior. comparison power spectral density channel channel recordings taken wand subsequent recordings taken commercial wired neurophysiology system error bars demonstrate robust detection biomarkers wand recordings establish baseline neuromodulation experiments recorded activity standard self-paced center-out joystick task behavior ongoing beta high-gamma rhythms inversely modulated task-related periods movement beta band oscillations found emerge specific motor actions notably prior instructed reaches movements. pre-motor motor areas rhythm linked neural activity related motor preparation–. subject average reaction time across trials. signals recorded pre-motor motor areas found significantly correlated average power beta band activity around figure recordings joystick task. diagram center-out joystick task timeline task periods movement reward. representative recordings three channels center-out task. trial-averaged beta high-gamma power aligned center-out task. error bars sem. beta power aligned cue. represents activity single trial. trials organized time target hold following cue. validate long-term wireless system functionality performed unconstrained overnight recordings five nights subject’s home cage recharging battery session recorded average consecutive hours night mean packet error rate median transmitted wireless packet contained neural data streamed channels. offline analysis data revealed useful sleep-related biomarkers. delta theta frequency bands known elevated power sleep states relative wake states. k-complexes sleep-specific phasic waveforms occur spontaneously observed obtained neural recordings epochs increased delta power consistent classification sleep state intervals. figure overnight untethered recording sleep. cartoon description in-cage wireless recordings. delta theta power two-hour segment overnight recording beginning powers significantly correlated k-means used classify activity states increased decreased delta theta activity indicated absence presence light blue background plots. example k-complexes caudate anterior cingulate cortex spectrogram activity channel time window waveform shown increased delta power occurs coincidently k-complex. true simultaneous recording stimulation enabled co-design nmic artifact prevention mitigation methods back-end cancellation algorithms running on-board microcontroller. demonstrate wand’s ability recover neural signals stimulation artifacts real-time performed experiments delivering open-loop stimulation recording lfp. stimulation parameters recorded three consecutive segments without stimulation stimulation turned without back-end artifact cancellation artifact cancellation turned train identical bipolar biphasic stimulation pulses segment uncancelled artifact demonstrated varying artifact morphology non-integer ratio sampling rate stimulation frequency stimulation pulses occurring completely within single sample integration window caused single sample direct artifact pulses occurring boundary integration windows caused direct artifact last samples. calculated averaged templates singledouble-sample artifacts varying stimulation amplitudes pulse widths confirmed linear relationship parameters artifact amplitude stimulation parameters within protocol recorded direct artifacts non-stimulating electrodes remained well within linear input range front-end amplifiers despite high voltages induced stimulating electrodes thus demonstrating saturation-free recording presence stimulation. following singledouble-sample direct artifacts indirect artifacts small brief visible averaged templates following single-sample direct artifact indirect artifact already suppressed within peak amplitude following sample within electronic noise floor µvrms second sample. indirect artifacts following double-sample direct artifacts fully suppressed noise floor. results demonstrate recording front-ends rapidly recovered stimulation pulses minimizing data distortion. residual stimulation artifacts still caused broadband contamination recorded spectrum quantified ratio signal power integrated form stimulation baseline since recorded artifacts short duration chose implement method linear interpolation artifact cancellation back-end. samples coinciding stimulation pulses flagged nmic ensuring accurate detection artifacts. samples buffered microcontroller artifacts removed linearly interpolating pre-artifact sample sample following maximum possible direct artifact duration sophisticated techniques employed found simple linear interpolation sufficient suppress artifact power neural signal spectrum. interpolation samples baseline data without stimulation caused significant degradation spectrum furthermore method depend actual values artifacts affected varying artifact morphology would complicated increased convergence times template subtraction adaptive filtering techniques. on-board artifact cancellation enabled able recover baseline spectrum signals recorded simulation pulse train figure residual artifact analysis cancellation. -second segments signals recorded different epochs open-loop stim experiment baseline stim stim artifact cancellation stim artifact cancellation example biphasic pulses delivered amplitude pulse width phase. different cases relative phase stim pulse sampling periods example resulting samples artifact flags cancelled samples using linear interpolation averaged templates single double-sample flagged artifacts. inset zoomed portion showing decay artifact within artifact peak error bars average amplitude artifact stim amplitudes pulse widths error bars spectrogram full -second recording different stim epochs example fig. welch power spectral density estimate -second epoch example fig. vivo biomarker extraction closed-loop experiment demonstrate wand’s ability mitigate stimulation artifacts real-time perform responsive stimulation using on-board computations designed closed-loop stimulation experiment disrupt movement preparatory activity delayed-reach task previous work macaque monkeys shown microstimulation delivered dorsal premotor primary motor cortical sites delay hold period delayed-reach task disrupts preparatory activity causes increase study stimulation timed synchronous task triggered recorded neural activity. reproduced result detecting periods preparation prior movement using recorded neural activity delivering stimulation electrodes response. stimulation automatically controlled wand running closed-loop manner relying solely neural activity completely separate task. beta band activity known reflect movement states lower beta band power associated periods movement higher beta band power associated absence movement. thus chose beta band power wand control signal closed-loop classification hold periods prior movement. closed-loop operation wand completely agnostic behavior task states stimulation delivery relied solely control signal. heuristically selected policy delivering preconfigured stimulation pulse train beta power derivative exceeded programmed thresholds delayed-reach task pulse train parameters selected closely match values used previous work within wand specifications. avoid stimulation multiple times within delay hold period policy also incorporated dead time three calculation periods neural activity recorded throughout task stimulation turn-off based neural signature chose adhere durations used previous work demonstrate reproducibility established result. post-hoc analysis showed increased significantly behavioral trials stimulation delivered hold period prior relative trials increase average consistent previously reported results microstimulation delivered change distribution indicate neural preparatory activity successfully disrupted using closed-loop neuromodulation approach. functional change behavior serves representative demonstration wand used compute biomarkers real-time part closed-loop stimulation paradigm perform online stimulation artifact mitigation. figure vivo closed-loop experiment. description closed-loop paradigm recorded activity used control stimulation pmd. diagram delayed-reach task closed-loop algorithm implemented task. stimulation delivered beta power derivative exceed thresholds. trial-averaged trials stimulation delivered successfully hold period compared not. error bars sem. significance determined using two-sided mann-whitney u-test normalized histograms log-normal approximate respective probability density functions. discussion demonstrated wand small form factor wireless neuromodulation device enabling simultaneous recording stimulation variety research purposes. integration custom asic on-board fgpa radio enables high-quality long-term multi-channel recording stimulation free behavior full cancellation stimulation artifacts flexible programmability low-latency processing delivery closed-loop microstimulation based detected biomarkers. table summarizes wand system specifications compares recently published closed-loop neural interfaces fully packaged validated vivo. view wand deployable research tool ready large animals potentially humans therefore limit comparisons similar devices operate fully wirelessly autonomously make immediate impact scientific clinical discovery. criteria include fully on-board recording computation stimulation ability; wireless data streaming on-board memory data storage; implantable wearable power source. neurochip- pennbmbi neuropace activa devices allow flexible biomarker detection triggered stimulation number channels. device developed university toronto enables recording stimulation channels devices still stream data rate preventing large-scale multi-site analysis. wand improves upon limitations device knowledge incorporates large number recording stimulation channels wireless data rate support large number streaming channels also provide closed-loop neuromodulation capabilities. also knowledge neural interface system actively cancels stimulation artifacts hardware software techniques completely artifact-free recording stimulation. although neurochip- activa pc+s devices utilize hardware experimental setup techniques large residual artifacts still appear effect performance stimulation. experiments shown intended outline demonstrate capabilities enabled wand paving path toward technology tool clinical neuroscientific research. work device form factor size channel count sensor integration designed specifically interface microelectrode array implanted primate subject. future research incorporate features wand inertial sensor multi-site stimulation. architecture wand makes amenable function general-purpose research device requiring minor modifications re-optimized applications. algorithmic development fpga microcontroller allows extracting neural biomarkers band powers linelengths used detect seizure onset epileptic patients closed-loop classification control algorithms conceived integrating neural activity larger number recording channels. research electrode configuration improved back-end artifact cancellation algorithms allow recovery full underlying neural signal lost samples limitation wand still faces. currently closed-loop control artifact cancellation algorithms implemented microcontroller little fpga fabric resources utilized. preliminary results porting algorithms fabric indicate still ample room increasing complexity achieve better efficacy. clinical context device hermetically packaged used provide on-demand therapy deep-brain stimulation continuously monitoring neurological response treatment. example parkinson’s disease patients treated swann discovered spectral peak biomarker linked dyskinesia adverse effect therapy. closed-loop paradigm demonstrate work easily modified application current biomarker detection algorithm already used sense spectral peak. modifying control policy reduce methods wand board components wand board consists fpga cortex-m processor acting master module. fpga forms custom mbps digital signal clock interface pair nmics aggregating data commands hardware fifos. cortex-m processor selects channels streamed used closed-loop runs artifact cancellation closed-loop algorithms. connects mbps low-energy radio running form bidirectional halfduplex link base station gui. developed custom radio protocol using time division duplex scheme allowing low-bitrate commands sent base-station board high-bitrate neural recordings continuously streamed logging. exact division uplink downlink adjusted suit application streaming state maximum effective bitrate mbps. streaming modes available. open-loop mode channels data streamed base station. closed-loop mode control channel stimulation channels streamed along calculated power spectral density. crystal oscillator provides clock source fpga processor generates clock nmics on-board buck converters generate supplies needed rest system pair li-ion batteries battery charger -way connector allows battery safely charged without disconnecting system. -axis accelerometer gyroscope low-power sdram also connected processor respectively although unused work. device fabrication steps consisted fabricating -layer populating board components wire bonding nmics soldering neuro nano-strip connectors interfacing microdrive electrode array. fpga hardware written verilog cortex-m radio programmed combined jtag connector allows users reprogram debug smartfusion radio. wireless base station consisting radio spi-to-usb bridge used communicate wand custom python developed control monitor data streamed wand users setup system multiple cases visualize real-time neural recordings configure nmic settings configure closed-loop classification algorithm. recorded data saved data format along relevant case settings nmic configurations notes recording. voltage range allowing simultaneous amplification digitization electrode offset neural signal stimulation artifact within linear range. four on-chip stimulators multiplexed electrodes allow variety programmable stimulation parameters including current amplitudes pulse timing frequencies stimulation pulses delivered phases setup phase configurable setup time pulse phase configurable mono-phasic biphasic configurable pulse widths interphase shorting phase configurable shorting time electrodes shorted reference. nmic assists artifact cancellation flagging samples coinciding stimulators active; however samples coinciding shorting phase flagged care must taken also remove artifact samples artifact flag implemented single appended significant -bit value creating -bit value sample channel. enable low-latency highly-programmable stimulation nmic uses double content shadow registers meaning stimulation parameters changed previous stimulation pulse waveform executed. lowoverhead command initiates programmed stimulation pattern. on-chip programmable dc-dc converters provide supply recording digital circuits well selectable ///v supply stimulator adjusting compliance different stimulation regimes improved power efficiency power management therefore integrated chip enabling power single supply without need large off-chip power conversion circuits. frames concurrent -bit samples enabled nmic recording channels arrive fpga every unflagged samples still affected shorting phase artifact cancellation always interpolates maximum number consecutive flagged samples possible detection first artifact sample calculated finding length milliseconds entire pulse rounding nearest integer adding biphasic pulses interphase shorting phase length pulse requires samples cancelled artifact. artifact cancellation implemented cortex-m processor packetization data wireless transmission closed-loop algorithm. eight frames samples buffered allowing cancellation artifacts lasting seven frames. artifacts detected upon finding first frame artifact flag cancelled first clean frame received. -frame buffering delay frames received fpga frames transmitted base-station used closed-loop. closed-loop control algorithm implemented cortex-m processor triggers stimulation based real-time spectral analysis recording channels compute power spectrum buffered windows data using fixed-point magnitude squared functions cmsis library. window demeaned scaled computation. window length configured power successive windows overlap samples. power spectrums derive control signals. control signal either integrated power across specified frequency band derivative power estimated subtracting newly calculated power value previous one. control signal specify threshold either power derivative. calculation decision stim either logical logical threshold crossings control signal. programmable dead time applied prevent stimulation triggered consecutive power measurements. additional random control mode triggers stimulation pulse trains pseudorandom intervals configurable minimum maximum time intervals. customized semichronic microelectrode array implanted unilaterally male rhesus macaque subject implanted unilaterally custom-machined chamber enabling access pre-motor motor cortical regions. chamber position calculated based images obtained magnetic resonance imaging scans subject’s brain. semichronic array features titanium chamber form-fitted cranium subject microdrive housing single microelectrodes independently moveable depth axis. microdrive sits within implanted chamber sterile seal system maintained. microelectrodes gradually lowered neural tissue time positions adjusted throughout experiment better isolate neural activity nuclei interest. electrode positions controlled miniature screw driven actuators traveling along threaded rods. electrical contact electrodes achieved printed circuit board omnetics headers used connect neural recording systems wand standard tethered electrophysiology equipment. types microelectrodes used semichronic array. first tungsten electrodes epoxylite insulation standard electrode type acute neural recording experiments. second type platinum-iridium electrodes parylene-c insulation standard neuromodulation experiments electrical stimulation study exclusively performed using ptir microelectrodes. experiments performed compliance guide care laboratory animals approved university california berkeley institutional animal care committee overnight recordings carried subject moving freely throughout home environment typically taken approximately subject pair-housed cagemate social contact cagemate throughout recording session. worth noting dimensions homecage environment could accommodate four nhps thus feasible utilize wand recording small population socially housed animals without compromising streaming wireless signal integrity. base station receiver mounted ceiling approximately cage connected computer running custom application acquiring neural recordings. subject also trained standard center-out joystick task delayed-reach joystick task in-chair behavioral recordings closed-loop experiment tasks selfpaced. briefly subject trained joystick control cursor computer screen move circular targets presented screen. joystick affixed front primate chair subject free either hand point task control joystick. center-out task trial begins subject holding cursor center circular target following hold period peripheral target appears eight target locations equally distributed around center target distance center target removed screen acting cue. subject moves cursor peripheral target holds target another successful subject administered small juice reward lasting trial considered successful subject completed hold periods within period. sequence events delayed-reach joystick task similar center-out task exception peripheral target appears prior signaled disappearance center target. hold period center target lasts peripheral target shown. initiates delay period duration varied randomly trialby-trial range delay period center target disappears screen signaling subject cued reach peripheral target. range delay durations chosen allow movement preparation ensure microstimulation occurred near nontrivial number trials. open-loop artifact cancellation experiments consisted continuous recordings made seconds stimulation seconds stimulation artifact cancellation seconds stimulation artifact cancellation stimulation parameters. biphasic stimulation amplitudes swept steps delivered pulse widths stimulation frequencies. stimulation electrodes chosen ones closed-loop experiment. open-loop stimulation experiments monkey in-chair perform tasks. artifacts recorded back-end cancellation disabled sorted offline -sample windows aligned sample clean sample artifact starts sample first flagged sample artifact segments used analyze size consistency recorded artifacts. offsets subtracted window sample artifact amplitude calculated average magnitudes samples artifact duration calculated average number samples magnitude greater maximum calculated artifact amplitude. determine effectiveness cancellation power spectrum epoch stimulation artifact cancellation estimated using welch’s averaged modified periodogram method hanning windowed samples overlaps samples. closed-loop experiment used window length calculate beta power derivative beta power control signals. stimulation enabled beta power exceeded µv-rms delta beta power exceeded µv-rms. dead time power calculation windows biphasic bipolar stimulation delivered ptir electrodes pmd. stimulation pulses amplitude pulse widths shorting phase. pulse trains pulses long delivered reaction time defined length time following cursor speed first achieve threshold cm/s. discarded likely subject initiating movement prior also considered indicate level engagement task. eisenstein electrotherapy shock value. nature morrell closed-loop neurostimulation clinical experience. neurotherapeutics morrell wharen responsive cortical stimulation treatment epilepsy. neurotherapeutics rosin closed-loop deep brain stimulation superior ameliorating parkinsonism. neuron little adaptive deep brain stimulation advanced parkinson disease. ann. neurol. epilepsy. neurology beuter lefaucheur j.-p. modolo closed-loop cortical neuromodulation parkinson’s disease alternative deep brain stimulation? clin. neurophysiol. swann gamma oscillations hyperkinetic state detected chronic human brain recordings parkinson’s disease. neurosci. little bilateral adaptive deep brain stimulation effective parkinson’s disease. neurol. neurosurg. psychiatry ieee solid-state circuits stanslaski design validation fully implantable chronic closed-loop neuromodulation device concurrent sensing stimulation. ieee trans. neural syst. rehabil. eng. neuropace system user manual. bagheri massively-parallel neuromonitoring neurostimulation rodent headset nanotextured flexible microelectrodes. ieee trans. biomed. circuits syst. abdelhalim jafari kokarovtseva velazquez genov -channel wireless neural vector analyzer closed-loop phase synchrony-triggered neurostimulator. ieee solid-state circuits time epileptic seizure control. ieee solid-state circuits johnson implantable -channel neuromodulation simultaneous recording stimulation rapid artifact recovery. symposium vlsi circuits doi./vlsic.. epilepsy. neurotherapeutics dangi orsborn gastpar carmena subject-specific modulation local field potential spectral power brain-machine interface control primates. neural eng. flint lindberg jordan miller slutzky accurate decoding reaching movements field potentials absence spikes. neural eng. flint ethier miller slutzky local field potentials allow accurate decoding muscle activity. neurophysiol. signals delay movement onset. elife stavisky nuyujukian shenoy high performing brain– machine interface driven low-frequency local field potentials alone together spikes. neural eng. transfer motor cortex. nat. neurosci. sanes donoghue oscillations local field potentials primate motor cortex voluntary movement. proceedings national academy sciences united states america recording system. ieee solid-state circuits zhang holleman otis design ultra-low power biopotential amplifiers biosignal acquisition applications. ieee trans. biomed. circuits syst. shulyzki -channel active probe high-resolution neuromonitoring responsive neurostimulation. ieee trans. biomed. circuits syst. loop bidirectional brain machine interface system energy efficient neural feature extraction control. ieee trans. biomed. circuits syst. jiang hokhikyan chandrakumar karkare marković ±-mv linearinput-range vco-based neural-recording front-end digital nonlinearity correction. ieee solid-state circuits cancelling stimulus artifacts same-electrode neural stimulation recording. annual international conference ieee engineering medicine biology society doi./embc.. feedback leads optimal integration. nat. neurosci. pais-vieira lebedev kunicki wang nicolelis brain-to-brain interface real-time sharing sensorimotor information. sci. rep. fitzsimmons drake hanson lebedev nicolelis primate reaching cued multichannel spatiotemporal cortical microstimulation. neurosci. canolty ganguly carmena task-dependent changes cross-level coupling single neurons oscillatory activity multiscale networks. plos comput. biol. saleh reimer penn ojakangas hatsopoulos clinical study fast slow oscillations human primary motor cortex predict oncoming behaviorally relevant cues. neuron period sleep different electroencephalographic phenomena within alpha band. neurphysiol clin schulz rethinking sleep analysis. clin. sleep med. machine interfaces. ieee solid-state circuits salam perez velazquez genov seizure suppression efficacy closed-loop versus open-loop deep brain stimulation rodent model epilepsy. ieee trans. neural syst. rehabil. eng. on-chip calibration charge balancing. ieee biomedical circuits systems conference doi./biocas.. j.-j. sarpeshkar low-power blocking-capacitor-free charge-balanced electrodestimulator chip less error full-scale stimulation. ieee trans. biomed. circuits syst. programmable pulse shape epiretinal implants. ieee solid-state circuits pepin uehlin micheletti perlmutter rudell high-voltage compliant electrode-invariant neural stimulator front-end bulk-cmos. esscirc conference european solid-state circuits conference doi./esscirc.. acknowledgments work supported part defense advanced research projects agency r.m. j.m.r. j.m.c. national science foundation graduate research fellowship program a.z. authors thank prof. elad alon simone gambini igor izyumin technical discussion. a.z. b.c.j. g.a. a.m. f.l.b. j.m.r. r.m. designed tested system. b.c.j. r.m. designed tested integrated circuits. s.r.s. j.m.c. designed vivo experiments. a.z. s.r.s. b.c.j. g.a. a.m. performed experiments analysis. j.m.r. j.m.c. r.m. oversaw project. a.z. s.r.s. b.c.j. g.a. a.m. j.m.r. j.m.c. r.m. wrote edited paper. authors b.c.j j.m.r. j.m.c r.m. financial interest cortera neurotechnologies inc. cortera neurotechnologies inc. filed patent application integrated circuit used work. upplementary figure nmic stimulator parameters rapid waveform update. table including stimulator subsystem specifications settable stimulation pulse parameters shown left. rapid waveform reconfiguration pulses delivered maximum frequency demonstrated right. stimulation parameters updated every pulse. additionally multiple current sources multiplexed single electrode create higher amplitude stimulation complex waveforms example. ethods implemented nmic preventing mitigating stimulation artifact described here. nmic completely remove stimulation artifacts avoids saturation minimizes artifact duration make back-end cancellation manageable. order prevent large persistent artifacts biphasic stimulation pulses used instead monophasic pulses. following single-phase stimulation pulse second phase pulse opposite polarity delivered actively clear charge delivered first pulse. amount indirect artifact related amount residual charge left phases. nmic stimulator architecture prevents large indirect artifacts occurring ensuring accurate charge balance biphasic pulses also enabling passive discharge shorting electrodes. common methods charge-balancing stimulation pulses include current copying current driver feedback control voltage offset correction feedback. nmic employs h-bridge architecture allowing reuse current source phases stimulation eliminating effects variations achieving mismatch phases details found nmic paper. supplementary figure h-bridge stimulator timing diagram. stimulator reuses current source stimulation phases achieve precise phase matching. voltage offset used second phase prevent voltage either electrode going negative. shorting phase programmable duration used clear residual charge electrodes. ecause nmic integrates stimulators front-ends onto chip common ground reference shared subsystems provides additional benefit that passive discharge following stimulation pulse stimulation electrodes shorted reference voltage front-ends. supplementary figure system architecture nmic. nmic enables bidirectional neural electrode interface integrated stimulation recording impedance measurement power management. nmic uses reference electrode common reference sensing. counter package electrodes used additional simulation channels unused work. large direct artifacts remaining indirect artifacts saturate front-end amplifiers small input ranges. techniques mitigation stimulation artifacts recording front-end fall categories saturation prevention rapid recovery. saturation prevention achieved increasing dynamic range subtracting artifact signals analog domain. subtraction learned artifacts reduce voltage swings amplifier input current implementations still allow residual artifacts pass error subtracted artifact templates. alternatively designers larger signal swings without subtraction. rapid recovery methods reduce artifacts charge build-up components front-end circuit resetting capacitive elements front-end common method. complex implementation involves active discharging elements. nmic implements front-end architecture provides large input range rapid recovery samples. nmic front-end uses first order continuous-time incremental capacitive feedback achieve large input range forward signal path consists active integrator -bit adc. bringing inside amplifier’s capacitive feedback loop internal signal swings reduced resulting improved linearity. analog forward path filters residue providing first order quantization noise shaping approximately doubling oversampling frequency. oversampled times resulting nominal resolution bits ks/s. reset occurs every output sample using switches labeled srst. every sample memoryless therefore rapidly recovers saturating signal. input range defined closed-loop capacitive ratio voltage supply feedback side front-end input capacitance effective feedback capacitance approximately feedback dac. capacitive attenuation network used achieve feedback capacitance smaller unit size improve matching. input range calculated polarity mvpp. setting change capacitance ratio results input range mvpp used rare cases artifact amplitudes exceed amplitudes. large linear input range allows nmic record artifacts amplitude without saturating simultaneously recording small neural signals noise. noise level front-end dominated thermal noise analog forward path quantization noise converter flicker noise analog forward path would dominate order magnitude; however forward path uses chopper up-modulate flicker noise transconductance stage filtered integrator. supplementary figure architecture recording front-end measurement results. frontend incremental oversampled converter -bit nominal resolution dc-coupled. front-end resets every sample aids rapid recovery stimulation artifact. noise spectrum input-referred sfdr spectrum single channel normalized full scale input system circuits active measurements outputs taken digital stream. estimated four stimulators combined single channel average noise across channels nv/rthz system described work system described main comparison table supplementary figure screenshot wand running closed-loop experiment. left side window dedicated real-time data visualization. traces stimulation channels control channel calculated biomarkers thresholds shown horizontal line. case bottom traces appear show information value time derivative biomarker used. full power spectrums calculated device transmitted local integration band power performed visualization. right side window contains settings closed-loop experiment command shell displaying data stream information.", "year": "2017"}