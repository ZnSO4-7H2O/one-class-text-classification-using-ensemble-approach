{"title": "Registering the evolutionary history in individual-based models of  speciation", "tag": "q-bio", "abstract": " Understanding the emergence of biodiversity patterns in nature is a central problem in biology. Theoretical models of speciation have addressed this question in the macroecological scale, but little has been investigated in the macroevolutionary context. Knowledge of the evolutionary history allows the study of patterns underlying the processes considered in these models, revealing their signatures and the role of speciation and extinction in shaping macroevolutionary patterns. In this paper we introduce two algorithms to record the evolutionary history of populations in individual-based models of speciation, from which genealogies and phylogenies can be constructed. The first algorithm relies on saving ancestral-descendant relationships, generating a matrix that contains the times to the most recent common ancestor between all pairs of individuals at every generation (the Most Recent Common Ancestor Time matrix, MRCAT). The second algorithm directly records all speciation and extinction events throughout the evolutionary process, generating a matrix with the true phylogeny of species (the Sequential Speciation and Extinction Events, SSEE). We illustrate the use of these algorithms in a spatially explicit individual-based model of speciation. We compare the trees generated via MRCAT and SSEE algorithms with trees inferred by methods that use only genetic distance among extant species, commonly used in empirical studies and applied here to simulated genetic data. Comparisons between tress are performed with metrics describing the overall topology, branch length distribution and imbalance of trees. We observe that both MRCAT and distance-based trees differ from the true phylogeny, with the first being closer to the true tree than the second. ", "text": "understanding emergence biodiversity patterns nature central problem biology. theoretical models speciation addressed question macroecological scale little investigated macroevolutionary context. knowledge evolutionary history allows study patterns underlying processes considered models revealing signatures role speciation extinction shaping macroevolutionary patterns. paper introduce algorithms record evolutionary history populations individual-based models speciation genealogies phylogenies constructed. ﬁrst algorithm relies saving ancestral-descendant relationships generating matrix contains times recent common ancestor pairs individuals every generation second algorithm directly records speciation extinction events throughout evolutionary process generating matrix true phylogeny species illustrate algorithms spatially explicit individual-based model speciation. compare trees generated mrcat ssee algorithms trees inferred methods genetic distance among extant species commonly used empirical studies applied simulated genetic data. comparisons tress performed metrics describing overall topology branch length distribution imbalance trees. observe mrcat distance-based trees diﬀer true phylogeny ﬁrst closer true tree second. origin patterns diversity macroecological scale central problem biology last decades macroecological patterns geographical variation species richness species abundance distributions species-area relationships studied empirical theoretical perspectives theoretical context neutral models speciation diﬀerences individuals irrelevant birth death dispersal rates played central role understanding patterns diversity macroecological scale. help computers became possible test diﬀerent hypothesis mechanisms might drive speciation sympatric versus allopatric processes assortative mating eﬀect number genes among diﬀerent approaches designed quantitatively study speciation models explicitly incorporate space allowed study major macroecological patterns could compared observed nature however models given little attention historical evolutionary dimension origin diversity reﬂected macroevolutionary patterns described phylogenetic trees increased interest role microevolutionary processes resulting macroecological patterns extension approaches keeping track branching phylogenetic divergence process next fundamental step explore models speciation using simulations individualbased models widely used biology advantage easily extended include historical perspective provide record ancestral-descendent relationships among simulated individuals and/or species. relationships stored matrices individual genealogies species trees directly obtained. article describe algorithms save historical information individual-based models speciation. ﬁrst algorithm focus genealogies quantity saved parenthood individual. parenthood registered time recent common ancestor i.e. number generations needed backward common ancestor individual another individual population easily calculated terms common ancestral parents. times computed every generation pairs individuals simulation saved matrix second algorithm focus phylogenies consists directly record speciation extinction events setup matrix analogous mrcat whose entries species rather individuals. ssee matrix contains exact branching times simulated clade community including extinct species. mrcat ssee matrices used drawn exact branching sequence simulated individuals species respectively. procedure diﬀers inference methods based phenotypic genetic traits used estimate phylogenies natural studies model looking branching process forward time usual approaches process looked backwards time. addition presentation mrcat ssee algorithms compare trees generate obtained usual distance-based methods phylogenetic inference using genetic data simulated individuals ﬁnal species. comparing inferred phylogenies generated mrcat ssee algorithms might oﬀer practical evaluate reliability estimated trees recover natural macroevolutionary patterns. paper organized follows section describe algorithms record ancestor-descendant relationships speciation/extinction events section compare true phylogenetic tree drawn ssee algorithm genealogies individuals drawn mrcat algorithm considering individual species. section discuss applications algorithms proposed section first present individual-based model speciation proposed algorithms regarding ancestor-descendant relationships branching process incorporated emphasize algorithms quite general could implemented ibm’s. next brieﬂy describe unweighted paired group method arithmetic mean neighbor joining minimum evolution methods based genetic distances calculated directly individual species present last generation simulation closer empiricists phylogenies derived methods distant true phylogeny generated ssee algorithm phylogeny based mrcat algorithm presented here. section presenting statistical measurements utilized compare phylogenies obtained algorithms proposed estimated distance-based methods goal show accuracy methods usually employed information available data individuals collected nature evaluated help models. section present results regarding output simulations comparisons phylogenies. finally section devoted discussion section conclusions. section describe algorithms record historical information evolution population. ﬁrst algorithm records genealogical relationships pairs individuals every generation. second turn registers speciation extinction events occur along evolutionary history. algorithms general enough applied individual-based models speciation. table list individuals generation respective parents generation asexual model. information necessary construct mrcat matrix. parents individual must recorded track recent common ancestor individuals simulation. note individuals generation individuals generation subsection show time recent common ancestor pairs individuals obtained keeping track parental relationships every generation. also show information used draw genealogy individuals last simulated generation. distinguish asexual sexual models technical diﬀerences tracking parents. consider population asexual individuals generation generation list individuals comprising generation along list respective parents produced. example shown table figure illustration ancestor-descendant relationships asexual population constant size implemented mrcat algorithm. square individual colors represent diﬀerent species. phylogenetic trees constructed selecting individual species view algorithm shown fig. genealogical relationships individuals originated single ancestral represented. example total population size kept ﬁxed full mrcat matrix generation mrcat matrices sexual models slightly diﬀerent since individual parents mother father consider example population females males generation gives rise females males generation notice total number individuals also number males females vary generations. model sexual maternal paternal lineages followed simulations allowing generation diﬀerent mrcat matrices corresponding trees. third option table list individuals generation respective parents mother ather) generation sexual model. case individual parents notice couple generation oﬀspring individuals generation couples oﬀspring. additionally notice females males generation females males generation lineages hermaphroditic individuals. many simulations consider simplicity hermaphroditic individuals. case separation maternal paternal lineages make sense deﬁnition mrcat matrix recent common ancestor taking parental combinations account. deﬁnition applied sexual models separation recorded genealogy separate maternal paternal lineages. case hermaphroditic model mrcat matrix determine simulated evolutionary process mrcat matrix contains time recent common ancestor every pair individuals extant population information used draw genealogical trees. drawing tree mrcat matrix consists joining individuals groups according recent common ancestral tree starts units step process units joined together form group number units decreases next time recent common ancestral newly formed group units tree recalculated called clustering method. process ends single unit left root tree. discussed section unique tree generated independently clustering method asexual maternal paternal lineages. hermaphroditic populations separation mrca taking account parents case. situations tree drawn mrcat matrix using diﬀerent clustering procedures. cases tips tree represent extant individuals whereas internal nodes represent recent common ancestor pair individuals. branch length denote time generations ancestor descendants x-axis base tree display extant individuals spaced unit interested tree topology statistics time intervals might represent genetic distance individuals shown instance subsection information drawing trees available supporting information section algorithm described subsection records ancestral-descendant relationships pairs individuals population given point time. allows drawing entire genealogies. however information individuals died without leaving descendants species went extinct totally lost. subsection describe algorithm allows drawing true phylogenetic tree retaining information species ever existed evolution matrix time species branched common ancestral species. species extinct kept matrix assigned label distinguish living species. label stored extinction vector algorithm follows consider hypothetical sequence speciation extinction events displayed fig. time three species denote orange blue corresponding matrix vector steps further ﬁnds species orange blue. notice names arbitrary determine relation species ones previous time step need look parents individuals species. suppose illustrated ﬁgure parents individuals blue belonged species blue. case draw link blue blue mark blue species survived time step i.e. similarly orange links orange looking previous generation notice species leave descendant species i.e. went extinct. order keep track create virtual species mark longer living species went extinct time ssee vector time become extinct species therefore treated species never speciate kept matrix. drawing corresponding tree branch stop value proceeding living species always ﬁlling ﬁrst part matrix followed copies extinct species draw complete phylogeny study extinction dynamics important case occurs species merge single species might happen instance species become reproductively isolated able breed mutation. resulting merged species individuals parents ancestral species need deﬁne ’survived’ went extinct. although matter labeling species call surviving species parents previous generation. drawing species phylogenies ssee matrices almost identical mrcat matrices. diﬀerences nodes represent species individuals branches associated extinct species drawn present time stop extinction time recorded vector mrcat case separation lineages unique tree generated independently clustering procedure chosen exact times speciation extinction recorded simulations based algorithm. simulation mrcat matrix contains exact time recent common ancestor every pair individuals population. ssee matrix contains equivalent information species level including extinct species. matrices used draw phylogenetic trees. draw phylogeny species considering ancestral-descendant relationships individuals mrcat matrix following reasoning species exist time j-th individual tree drawn ssee algorithm true phylogeny species record exact speciation extinction events representing actual branching process. hand phylogeny species drawn mrcat algorithm diﬀerent although similar true phylogeny time recent common ancestor individuals diﬀerent species approximation speciation time since speciation happen several generations later. figure illustrates situation population splits three species closely spaced speciation events might happen ﬁrst group speciate species ﬁgure recent common ancestor subgroup figure illustration genealogy recorded mrcat corresponding population evolution. phylogenies constructed mrcat ssee diﬀer case because although individuals species recent common ancestor individuals species split ﬁrst followed separation time still form single species reproduction individuals might happen split preserving long time ancestry. likely happen populations spatial structure individuals belonging subpopulations occupy diﬀerent areas. model considered exemplify mrcat ssee algorithms extension speciation model introduced adapted characterize individuals separated sexes model already studied terms speciation rates species-area relationships species abundance distributions. adding historical information generated mrcat ssee algorithms i.e. recording parenthood individuals generation another well pattern time speciation extinction events individual allowed site lattice density population seldom occurs. genome individual represented sequence binary loci state locus plays role independent biallelic gene. individuals also carry separate label specify male female. evolution population involves combined inﬂuence sexual reproduction mutation dispersal reproduction trial starts individual goes individual individuals population chance reproduce. individual selected reproduction focal individual searches potential mates mating range circular area radius centered spatial location. focal individual reproduce within mating range genetically compatible i.e. genetic distance particular threshold among compatible individuals within mating range opposite randomly chosen mating partner. individuals whose genetic distance larger considered reproductively isolated genetic distances individuals calculated hamming distance genetic sequences i.e. number loci corresponding alleles diﬀerent. focal individual ﬁnds compatible mate opposite reproduction proceeds combination genetic materials produce oﬀspring genome locus equal probability transmitted mother father. combination locus oﬀspring genome mutate probability finally oﬀspring replaces focal reproducing individual. reproductive event descendant generated. oﬀspring dispersed probability within region around expiring focal parent. probability focal individual without reproducing. case neighbor randomly selected mating range reproduce place population size remains constant. evolution proceeds non-overlapping discrete generations entire population replaced oﬀspring. species deﬁned groups individuals connected gene pair individuals belonging diﬀerent species reproductively isolated however individuals belonging species also reproductively isolated long exchange genes indirectly individuals species. described previous subsection genome individuals identical beginning simulation mutations introduce diﬀerences many generations population display distribution genomes. genetic distances therefore calculated pairs individuals used proxy ancestry larger genetic distance individuals farther back common ancestor. order estimate phylogenies genetic distance selected individuals species used drawing phylogeny mrcat computed matrix genetic distances. process mimics sampling individuals real population comparison dna’s measure ancestry. genetic distance matrix estimated trees three distancebased methods. firstly used hierarchical clustering method cluster species based genetic distances. clustering realized ﬁrst using algorithm upgma algorithm groups species clustered based average distance members groups. method assumes constant rate change generating ultrametric trees distances root tips equal. secondly used method phylogenetic inference. method procedure pairs neighbors total branch length stage clustering minimal starting starlike tree. finally used method assumes true phylogeny probably smallest branch lengths method. diﬀerence method tree constructed ﬁrst next tree topologies close tree estimated certain criteria trees examined tree small branch lengths chosen. used function hclust stats package estimate ultrametric trees upgma method. estimate trees method used function package case estimated trees ultrametric transform ultrametric trees using chronom multidi functions package used rkitsch function rphylip package estimate ultrametric trees method assuming evolutionary clock. methods generally considered superior upgma optimizes tree according minimum evolution criterion. similarly upgma methods fast eﬃcient computationally. evaluate accuracy phylogenies generated mrcat algorithm genetic distance methods relation true phylogeny generated ssee three statistics robinson foulds metric gamma statistic sackin’s index metric measures distance phylogenetic trees providing overall topological resemblance phylogenies. speciﬁcally metric calculates number internal branches present trees compared. consider trees have number branches respectively. number branches shared represented metric calculated using rf.dis function phangorn package γ-statistic measures distribution branch lengths tree time interval speciation events represented nodes tree. pure birth process constant speciation rate branch γ-values follow standard normal distribution centered unit standard deviation. internal nodes closer tips closer root compared case constant speciation rate. γ-statistic calculated using gammastat function package number leaves. expected sackin’s index approximates large values since expected value sackin’s index increases tree size normalized index deﬁned compare trees diﬀerent sizes simulations speciation model described section parameters start showing results single simulation show examples phylogenies. figure shows population generations circles representing individuals colors indicating species generated. species form spatial clusters consequence small value used simulation. true phylogenetic tree population generated using ssee algorithm shown fig. figure shows full phylogeny includes speciation extinction events. large number events seen near root tree correspond mostly unsuccessful incomplete speciation events group individuals momentarily splits species quickly recombine single species mutations. phenomenon common beginning speciation process model described figure spatial distribution individuals simulation based model described section individuals represented circles color represents diﬀerent species. stars indicate individuals used draw phylogenies shown ﬁgure figure true phylogenies obtained ssee method. full phylogeny including speciation extinction events; ﬁltered phylogeny excluding branches individuals moment extinction; ﬁltered phylogeny excluding also branches lasted less generations generations. section fig. full phylogeny ﬁltered order remove speciation reversals keep true extinction events. model extinctions occur stochastic ﬂuctuations number individuals species might become small zero. figure shows phylogeny ﬁltered criterion population size moment vanishing species disappear individuals considered speciation reversals removed tree. figs. display phylogenies ﬁltered also criterion persistence time branches species lasted less generations generations removed. phylogenies computed ssee mrcat genetic distance matrices shown fig. panel shows true ssee phylogeny ﬁltered exhibit extant species. panel obtained mrcat algorithm individual species selected represent species. finally panel shows phylogeny estimated genetic distance matrix individuals used fig. upgma clustering method. diﬀerences topology branch lengths qualitatively visible among trees. maternal paternal genealogies obtained mrcat algorithm shown fig. statistical comparisons among phylogenies generated mrcat algorithm genetic distance methods relation true phylogeny shown fig. ﬁrst line shows comparisons topology branch length distribution degree imbalance among phylogenies generations simulations. second line shows comparisons generations simulations. colors represent diﬀerent methods utilized generate trees. scatterplots coordinates point refer normalized topological distance tree calculated mrcat matrix genetic distance matrix true phylogenies generated ssee algorithm. small values indicate phylogenies closer true phylogeny diagonal dotted line deﬁnes condition topology phylogenies equal trees generated genealogical relationships estimated genetic distance scatterplot shows phylogenies generated mrcat genetic distance using upgma method similar rf-values trees estimated methods diﬀerent rf-values. phylogenies estimated genetic distance-based methods diﬀer obtained mrcat. density distribution values shown scatterplots indicate mrcat always closer ssee especially regarding branch length distribution scatterplots show diﬀerence γ-values ssee phylogenies mrcat genetic distance phylogenies diagonal dotted line deﬁnes condition γ-values trees generated figure comparisons among phylogenies generated algorithms proposed phylogenies estimated genetic distance upgma methods. lines exhibit comparisons gamma sackin’s metrics simulations times generations. colors represent diﬀerent methods utilized generate trees. diﬀerence rf-values phylogenies obtained mrcat genetic distance-based methods small values indicate phylogenies closer true phylogeny diﬀerence branch length distributions phylogenies generated ssee mrcat algorithm genetic distance-based methods considering degree imbalance distributions scatterplots illustrate qualitatively diﬀerences topology branch length distribution degree imbalance phylogenies generated algorithm method simulations. genealogical relationships genetic distance equal values true phylogenies. observe times mrcat trees distributions closer true phylogenies genetic distance-based trees large match finally normalized sackin’s index presented fig. imbalance mrcat phylogenies closer true phylogenies hand imbalance similar mrcat distance-based methods except trees exhibited incorrect sackin index possibly trees rooted necessary condition compute index. rooting procedure chosen quite arbitrary aﬀecting balance trees consequently sackin index. distributions scatterplots show qualitatively diﬀerences topology branch length distribution degree imbalance phylogenies generated algorithm method simulations performed time understanding mechanisms promote speciation still open problem evolutionary biology even challenging identify mechanisms important particular case. large number mathematical computational models developed past years evaluate hypothesis speciation processes involving diﬀerent forces sexual selection ecological selection including models role geography speciation parapatric sympatric speciation results models however seldom compared real data cases comparisons often made macroecological scale including qualitative species abundance spatial distributions species-area relationships genetic phenotypic distances nevertheless little attention given evolutionary history individuals species models neglecting macroevolutionary scale underlying speciation process paper described procedures register history individuals species individual-based models. ancestral-descendant relationships speciation events saved mrcat ssee matrices drawn trees using clustering algorithm. trees properties demonstrated section supporting information. mrcat algorithm genealogies individuals phylogenies species obtained whereas ssee algorithm phylogenies species extracted. ssee algorithm speciation events precisely recorded true phylogenetic tree whereas mrcat algorithm relations among species recovered genealogical relationships individuals. mrcat algorithm allows construction maternal paternal general lineages last analogous cases hermaphroditic individuals. applied algorithms spatially explicit individuals separated males females sexual reproduction restricted genetic similarity spatial proximity. showed maternal paternal general genealogies mrcat algorithm diﬀerent even individuals chosen draw trees maternal paternal genealogies diﬀerent constructed drawn diﬀerent mrcat matrices. ﬁrst case mrcat matrix contains time recent common emale ancestor pair individuals second case mrcat matrix time recent common male ancestor individuals leads diﬀerent times genealogical relationships. addition general genealogy taking recent common ancestor among females males resulting mrcat matrix uniquely specify genealogy regarding phylogenetic trees showed diﬀerent obtained mrcat ssee algorithms fig. discussed subsection mismatch happens time recent common ancestor individuals diﬀerent species approximation speciation time since speciation happen several generations later structural properties phylogenies sackin index gamma distribution obtained ssee mrcat trees compared values calculated phylogenies estimated genetic distance among individuals extant species distance-based methods comparison show validity methods commonly used empirical studies complete past history inaccessible assessed help models. diﬀerences topology branch length distribution measured metric γ-statistic respectively revealed mrcat trees closer true phylogenies genetic distance-based trees. result derived chance back mutations happened genome individuals erasing information needed uncover real history among species. phenomenon likely happen long times small genome size. indeed observed generations phylogenies estimated genetic distance closer ones generated mrcat algorithm generations possibly ﬁrst case back mutations less likely. another factor explain diﬀerence genetic distance-based true phylogenies sampling individual estimate trees ﬁrst case. although sampling could reason diﬀerence important factor phylogenies generated mrcat algorithm also used individual species individual used compute genetic distance drawn trees still closed true phylogeny degree imbalance showed different picture less diﬀerences mrcat trees genetic distance trees. still mrcat trees closer true phylogenies others. trees estimated genetic information ibms closer true phylogenies larger genome sizes probability back mutations smaller. individual-based models large inﬁnite genome sizes already recent interest role evolutionary history explain spatial patterns abundance species diversity calls incorporation phylogenetic trees speciation modeling approach. phylogenetic trees essential tools understand patterns diversity. reveal species related times speciation events. moreover topological structure branch length also contain clues processes originating particular group species. previous works already considered problem simpler models mutation corresponds directly species study provides ﬁrst general attempt extend individual-based models incorporate branching process using ancestral-descendant relationships individuals species. believe methodology help predict classify macroevolutionary branching process well corresponding macroecological patterns resulting diﬀerent speciation models. comparison results empirical studies clarify role diﬀerent processes generating patterns observed nature finally role extinction determining macroevolutionary patterns open ﬁeld could explored using full phylogenetic trees generated ssee algorithm. research supported paulo research foundation national council scientiﬁc technological development coordination improvement higher education personnel thank costa constructive comments manuscript martins fernandes provided expertise greatly assisted research contributing insights comments research results.", "year": "2017"}