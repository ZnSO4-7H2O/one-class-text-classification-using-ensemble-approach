{"title": "Learning Based Segmentation of CT Brain Images: Application to  Post-Operative Hydrocephalic Scans", "tag": "eess", "abstract": " Objective: Hydrocephalus is a medical condition in which there is an abnormal accumulation of cerebrospinal fluid (CSF) in the brain. Segmentation of brain imagery into brain tissue and CSF (before and after surgery, i.e. pre-op vs. postop) plays a crucial role in evaluating surgical treatment. Segmentation of pre-op images is often a relatively straightforward problem and has been well researched. However, segmenting post-operative (post-op) computational tomographic (CT)-scans becomes more challenging due to distorted anatomy and subdural hematoma collections pressing on the brain. Most intensity and feature based segmentation methods fail to separate subdurals from brain and CSF as subdural geometry varies greatly across different patients and their intensity varies with time. We combat this problem by a learning approach that treats segmentation as supervised classification at the pixel level, i.e. a training set of CT scans with labeled pixel identities is employed. Methods: Our contributions include: 1.) a dictionary learning framework that learns class (segment) specific dictionaries that can efficiently represent test samples from the same class while poorly represent corresponding samples from other classes, 2.) quantification of associated computation and memory footprint, and 3.) a customized training and test procedure for segmenting post-op hydrocephalic CT images. Results: Experiments performed on infant CT brain images acquired from the CURE Children's Hospital of Uganda reveal the success of our method against the state-of-the-art alternatives. We also demonstrate that the proposed algorithm is computationally less burdensome and exhibits a graceful degradation against number of training samples, enhancing its deployment potential. ", "text": "abstract—objective hydrocephalus medical condition abnormal accumulation cerebrospinal ﬂuid brain. segmentation brain imagery brain tissue plays crucial role evaluating surgical treatment. segmentation pre-op images often relatively straightforward problem well researched. however segmenting post-operative computational tomographic -scans becomes challenging distorted anatomy subdural hematoma collections pressing brain. intensity feature based segmentation methods fail separate subdurals brain subdural geometry varies greatly across different patients intensity varies time. combat problem learning approach treats segmentation supervised classiﬁcation pixel level i.e. training scans labeled pixel identities employed. methods contributions include dictionary learning framework learns class speciﬁc dictionaries efﬁciently represent test samples class poorly represent corresponding samples classes quantiﬁcation associated computation memory footprint customized training test procedure segmenting post-op hydrocephalic images. results experiments performed infant brain images acquired cure children's hospital uganda reveal success method state-of-the-art alternatives. also demonstrate proposed algorithm computationally less burdensome exhibits graceful degradation number training samples enhancing deployment potential. hydrocephalus medical condition abnormal accumulation cerebrospinal ﬂuid brain. causes increased intracranial pressure inside skull cause progressive enlargement head occurs childhood potentially causing neurological dysfunction mental disability death typical surgical solution problem insertion ventriculoperitoneal *this work supported grant number †contributed equally. dept. electrical engineering center neural engineering dept. neurosurgery engineering science mechanics physics pennsylvania state university university park usa. cure children's hospital uganda mbale uganda department neurosurgery boston children's hospital department global health social medicine harvard medical school boston massachusetts division neurosurgery hospital sick children university toronto toronto canada shunt drains cerebral ventricles abdominal cavity. procedure pediatric hydrocephalus failure rates high percent ﬁrst years ongoing failures thereafter developed countries failures treated timely manner. however developing nations failures often lead severe complications even death. overcome challenges procedure developed avoids shunts known endoscopic third ventriculostomy choroid plexus cauterization however long-term outcome comparison methods fully quantiﬁed. achieving quantitative comparison compare volumes brain surgery. volumes estimated segmenting brain imagery brain tissue. manual segmentation volume estimation carried tedious scalable across large number patients. therefore automated/semi-automated brain image segmentation methods desired pursued actively recent research. substantial previous work done past segmentation pre-operative ct-scans hydrocephalic patients noted volume brain appears correlate neurocognitive outcome treatment hydrocephalus figure shows preop images figure shows corresponding segmented images using method hydrocephalic patient. figure shows slices near base skull second shows middle slices bottom shows slices near skull. observe figure segmentation pre-op images relatively simple problem intensities brain tissue clearly distinguishable. however post-op images complicated addition geometric distortions introduction subdural hematoma ﬂuid collections pressing brain. subdural collections separated brain volume calculations made. therefore images segmented classes subdurals must removed volume determination. figure shows sample post-operative images patients subdurals. note subdurals patient- small compared subdurals patients. further large subdurals observed patient- sides brain opposed patient-. observation make intensity subdurals patient- close intensity whereas intensity subdurals patients close intensity brain tissue. histogram linear combination training images collected matrix coefﬁcient vector determined sparsity constraint. seen signiﬁcant recent application image segmentation wherein pixel level classiﬁcation problem essentially solved. works described dictionary matrix simply includes training image patches class pixel must classiﬁed segmentation problems training dictionaries often grow prohibitively large. learning compact dictionaries continues important problem. particular label consistent k-svd dictionary learning method demonstrated success image classiﬁcation repurposed successfully applied medical image segmentation motivation contributions existing work sparsity based segmentation dictionary used voxel/pixel creates large computational well memory footprint. further objective function learning dictionaries described literature focused extracting features characterize class well. contend dictionary corresponding given class must additionally designed poorly represent out-of-class samples. develop objective function incorporates out-of-class penalty term learning dictionaries accomplish task. leads harder optimization problem develop tractable solution. also propose feature incorporates distance candidate pixel edge brain computed distance transform. based observation subdurals almost always attached boundary brain. intensity patches well distance features used learning framework. main contributions paper summarized follows objective function learn dictionaries segmentation sparsity constraint discriminating features automatically discovered call method feature learning image segmentation tractable algorithmic solution developed dictionary learning problem. feature captures pixel distance boundary brain used identify subdurals effectively subdurals mostly attached boundary brain. feature also enables dictionary learning framework single dictionary pixels image opposed existing methods separate dictionary pixel type. incorporating additional distance based feature helps signiﬁcantly reduce computation memory footprint flis. experimental validation validation challenging real data acquired cure children's hospital uganda performed. flis results compared manually labeled segmentation provided expert neurosurgen. comparisons also made recent state sparsity based methods medical image segmentation. many methods proposed past segmentation brain images methods work principles intensity based thresholding model-based clustering techniques. however traditional methods segmentation fail identify subdurals effectively hard characterize speciﬁc model subdurals pose different range intensities different patients. example figure illustrates performance images different patients subdurals. observe accuracy segmenting images poor. apart general methods brain image segmentation relatively limited work done identify subdurals methods work assumption images segmented classes brain subdurals. therefore methods unlikely succeed images acquired hydrocephalic patients volume signiﬁcant. intensity features help characterize pixel three segments apparent; must discovered learning framework. recently sparsity constrained learning methods developed image classiﬁcation found widely successful imaging problems essence aforementioned sparse representation based classiﬁcation write test image idea mathematically represented around pixel represents collection training patches pixel matrix form. vector obtained solving represents pseudo-norm vector number nonzero elements vector. represents euclidean norm. intuition behind idea minimize reconstruction error linear combination number non-zero elements less constraint pseudo-norm hence enforces sparsity. often pseudo-norm relaxed norm obtain fast unique global solutions. sparse code obtained pixel likelihood probabilities class obtained using probability likelihood maps normalized candidate pixel assigned likely class determined sparse code. training dictionaries could grow prohibitively large motivates design compact dictionaries lead high accuracy segmentation. tong adapted well-known lc-ksvd method segmentation minimizing reconstruction error along enforcing label-consistency criteria. idea formally quantiﬁed given pixel training patches. compact dictionary obtained size compact dictionary. sparsity constraint means column non-zero elements. rc×n represents label matrix training patches number classes/segments given pixel classiﬁed. example case label matrix patch around pixel ground truth rc×k linear classiﬁer obtained along represent represents frobenius norm. terms black minimize reconstruction error term represents label-consistency criteria. test image analyzed segmentation pixel invoked sparse fig. demonstration segmentation using traditional intensity based method represents original images patients. second represents manually segmented images. third represents segmentation using green-brain red-csf blue-subdurals complexity analysis memory requirements analytically quantify computational complexity memory requirements method competing methods. experimental time typical implementation platforms also reported. reproducibility experimental results presented paper fully reproducible code segmentation learning flis dictionaries made publicly available https//scholarsphere.psu.edu/concern/ generic works/bvqzn. preliminary version work presented short conference paper ieee int. conference neural engineering extensions conference paper include detailed analytical solution objective function further extensive experiments performed changing various parameters algorithm statistical insights provided. additionally detailed complexity analysis performed memory requirements flis along competing methods presented. remainder paper organized follows. review sparsity based segmentation detailed description proposed flis provided section experimental results reported section including comparisons state art. appendix contains analysis computation memory requirements method selected competing methods. concluding remarks provided section segment given image classes/segments every pixel image classiﬁed classes/segments. general intensity values patch size around pixel represent patch sparse linear combination terms represent complementary samples given class represents frobenius norm implies column non-zero elements label matrices concatenated maintain consistency dimension complimentary samples. positive regularization parameters. important parameter obtain solution objective function discuss subsequent sections. intuition behind objective function term black makes sure intra-class difference small term enforces label-consistency. terms make sure in-class samples well represented. represent complementary samples poorly reconstruction error complementary samples sparse linear combination in-class dictionary samples large. achieved term blue. further labelinconsistency term added utilizing sparse code class samples encourages interclass differences. essentially combination terms blue brown enables discover discriminative features differentiate class another effectively. note objective functions described special cases since include terms emphasizes inter-class differences. visual representation idea comparison objective function deﬁned shown figure problem non-convex respect optimization variables; develop tractable solution reported next. tong al.’s work promising segmentation identify open problems learned dictionaries pixel lead high computational memory footprint label consistency criterion enhances segmentation encouraging intrawithin-class similarity inter-class differences must maximized well. proposed flis addresses issues. introduce feature captures pixel distance boundary brain. serves purposes. first observe figure subdurals mostly attached boundary brain. adding feature along vectorized patch intensity intuitively helps enhance recognition subdurals. secondly longer need design pixel speciﬁc dictionaries aforementioned distance vector provides enough discriminatory nuance. notation given patient stack slice images starting base skull skull observed figure goal segment image stack three categories brain subdurals. rd×nb rd×nf rd×ns training samples brain subdurals respectively. column represents intensity elements patch size around training pixel concatenated distances boundary brain pixel patch represents number training patches class/segment. chosen classes/segments. denote dictionaries learned rd×k. size dictionary. rk×ni training sample r×ni represents label matrices corresponding training elements example column vector looks like ﬁnally denotes linear classiﬁer learned represent fig. visual representation flis comparison ddls represents idea ddls represents desirable outcome idea capable differentiating in-class class samples. new))} where problem convex positive semideﬁnite. however guaranteed positive semideﬁnite. make positive semideﬁnite matrix chosen following condition λmin λmax represent minimum maximum eigenvalues corresponding matrices. appropriate chosen solved using dictionary update step obtain dnew solved obtain values keep iterating steps obtain ﬁnal dnew. entire procedure formally described algorithm used per-class basis learn class/segment speciﬁc dictionaries corresponding brain subdurals. obtain class speciﬁc dictionaries linear classiﬁers concatenate obtain assignment test pixel class dictionaries learned classify pixel extract patch size around collect intensity values distance values boundary brain elements patch form column vector sparse code using learned dictionary obtained classify pixel using develop iterative method solve idea ﬁxed values obtain updated values process repeated converge. since already obtained initial value need initial value initial value obtain sparse codes solving following equations training test procedure design hydrocephalic image segmentation training set-up selecting training image patches segmentation infeasible extract patches pixels training image would require memory. further desired patches used training images correspondence patches test images. example training patches collected slices middle stack cannot used segmenting slice belongs bottom. address problem divide entire ct-stack patient partitions images belonging given partition anatomically similar. image partition must carefully extract patches enough representation classes likewise enough diversity range distances boundary brain. patch selection strategy class/segment first candidate region image ct-stack using optical approach mentioned candidate region binary image labels region image segmented brain subdurals then distance value pixel given min) euclidean distance pixel pixel candidate region. pixel essentially minimum distance calculated pixels part candidate region. candidate region sample image distance transform shown fig. subset these distances used training feature vectors. purpose propose simple strategy wherein ﬁrst calculate maximum minimum distance given label/class image pick patches randomly distance range uniformly sampled values. pseudo-code strategy implementation details found training patches partition extracted learn dictionaries linear classiﬁers partition using objective function described section ii-c.the entire training setup segmentation test stack summarized chart figure images. choose number partitions stack based neurosurgeon feedback. size slice slice thickness scans varied test includes patients number training patients ranged non-overlapping test set. validate results used dice-overlap coefﬁcient regions deﬁned note evaluates diceoverlap computed method using carefully obtained manually segmented results supervision expert neurosurgeon proposed flis compared following state methods based segmentation implemented using pre-deﬁned dictionaries voxel/pixel scans. objective function classiﬁcation procedure proposed work implemented data set. lc-ksvd based dictionary learning method used segment brain images hippocampus labeling. types implementations proposed paper named ddls f-ddls. fixed-ddls dictionaries learned ofﬂine segmentation performed online improve speed segmentation whereas ddls operations performed simultaneously. paper compare ddls approach storing dictionary pixel ofﬂine requires large memory. apart methods others dictionary learning sparsity based framework medical image segmentation objective function used aforementioned methods similar methods application different. chose compare widely cited also applied brain image segmentation. compare method state learning based segmentation demonstrate superiority learning based approaches comparison traditional intensity based methods. illustrated visually fig. section intensity based methods difﬁcult differentiate subdurals brain csf. validate quantitatively compare dice-overlap coefﬁcients obtained using segmentation results best known intensity based methods addressed brain intensity segmentation comparisons reported table learning based methods patch size number training patients sizes individual class speciﬁc dictionaries results table conﬁrm learning based methods clearly outperform traditional intensity based method esp. fig. comparison traditional intensity based thresholding method learning based approaches two-way anova. values reported anova across method factor indicating results learning based approaches signiﬁcantly different better bis. intervals shown represent percent conﬁdence intervals dice overlap values corresponding method-class conﬁguration. blue color represents method indicates learning based approaches. terms accuracy identifying subdurals. note dice overlap values table class/segment averaged test patients. norm remainder section unless otherwise stated. performed balanced two-way analysis variance dice overlap values across patients classes fig. illustrates comparisons using posthoc tukey range test conﬁrms ddls flis signiﬁcantly separated bis. values compared methods observed much less emphasizes fact learning based methods effective. method several parameters chosen carefully start implementation. important parameters patch size dictionary size number training patients regularization parameters picked cross-validation procedure compliance best values found algorithm fairly robust parameters patch size number training patients length dictionaries discussed subsequent sub-sections. patch size small namely single pixel extreme case necessary spatial information accurately determine class/segment unavailable. hand large patch size might include pixels different classes. experiment performed dictionary size class/segment number training patients performing experiments respectively. experiments reported square patch windows size varying mean dice overlap values patients shown fig. reveal results quite stable patch size range indicating patch size chosen carefully flis robust small departures optimal choice. method. similar patch size small dictionaries incomplete represent data accurately. however large dictionaries represent data accurately cost increased run-time memory requirements. results presented next varying dictionary sizes chosen. note dictionary sizes individual class. however ddls class speciﬁc dictionaries. therefore maintain consistency methods overall dictionary size ddls ﬁxed times size individual dictionary method. table compares flis ddls different dictionary sizes. compare dictionary learning used approach. experiments conducted patch size data patients used training. table observe flis remains fairly stable change size dictionary whereas ddls method performed better identifying subdurals size dictionary increased. fairly small dictionary size performance methods drops flis still relatively better. further compare methods statistically -way balanced anova performed classes shown fig. observe flis exhibits superior segmentation accuracy compared ddls although signiﬁcant overlap conﬁdence intervals flis ddls. primarily attributed discriminative capability flis objective function automatically discovers features crucial separating segments. visual comparisons available figure size dictionary visual results figure show methods performed similarly detecting large subdurals flis identiﬁes subdurals accurately patient subdurals smaller spatial footprint. following experiment vary number training test samples dividing total patients stacks conﬁgurations figure compares method ddls patch based conﬁgurations. note that results reported conﬁguration averaged random combinations given training-test conﬁguration remove selection bias. per-class dictionary size ﬁxed method ddls whereas dictionary size determined automatically given training selection. patch size plot dice overlap training size shown fig. unsurprisingly three methods shows drop performance number training image patches decreases. however note flis exhibits graceful degradation. fig. represents gaussian histogram dice-overlap coefﬁcients conﬁguration trends observed flis histogram mean higher competing methods indicating higher accuracy variance smallest flis conﬁrming robustness choice training-test selection. comparisons visually shown figure similar trend also observed patch based ddls improve number training patients increase. observe ddls based methods performed poorly identifying subdurals patient figure also observe ddls flis outperform implying dictionary learning improves accuracy signiﬁcantly. illustrate discriminative property flis plot sparse codes obtained classiﬁcation stage method ddls single random pixel dictionary size fig. lines ﬁgure boundary classes. three segments i.e. brain subdurals note active coefﬁcients sparse code concentrated accurately correct class/segment flis ddls. summarize quantitative results flis stands particularly ability correctly segment subdurals. overall accuracy brain ﬂuid segmentation better accuracy subdural segmentation methods. expected amount subdurals present throughout images relatively small compared brain ﬂuid volumes. compare computational complexity flis ddls method. compare learn dictionaries. complexity dictionary learning methods estimated calculating approximate number operations required learning dictionaries pixel. detailed derivation complexity presented appendix run-time derived complexity pixel shown fig. comparison flis ddls different dictionary sizes using -way anova. intervals represent percent conﬁdence intervals dice overlap values given conﬁguration method-classdictionary size. flis represented blue ddls red. values reported anova across method factor anova values across dictionary length factor also performed repeated anova across dictionary size factor methods reported p−value=.× conﬁrms fig. comparison results methods training size patients. first represents original images patients. second represents corresponding manually segmented image. third represents segmented images using flis. fourth fifth rows represent segmented images using ddls patch-based respectively. green-brain red-csf blue-subdurals. table iii. run-time computational complexity derived pixel. values parameters deﬁned follows number training patches class patch size sparsity level chosen time numbers consistent estimated number operations shown table obtained plugging values parameters derived complexity formulas. flis substantially less expensive computational standpoint. expected ddls uses pixel speciﬁc dictionaries whereas flis dictionaries class fig. comparison results methods dictionary size training size patients. first represents original images patients. second represents corresponding manually segmented image. third represents segmented images using flis. fourth represent segmented images using ddls green-brain red-csf blue-subdurals. fig. comparing sparse codes random pixel brain ﬂuid subdurals sparse code flis. sparse code ddls. axis indicates dimension sparse codes. left side ﬁrst line correspond brain middle section corresponds ﬂuid right side second line correspond subdurals. axis indicate values sparse codes. memory requirements derived appendix memory required storing dictionaries methods reported table numbers obtained assuming element requires bytes following parameter choices number training patients patch size consistent section iii-g memory requirements flis also modest. medical image segmentation implement technique designs convolutional neural network segmenting images. method extracts patches different sizes centered around pixel classiﬁed separate network designed patch size. output network connected single softmax layer classify pixel. three different patch sizes used work network conﬁguration patch size mentioned table reproduced design scans training. address method deep network image segmentation results terms comparisons flis shown table note training-test conﬁguration experiment performed subsection iii-e. unsurprisingly flis performed better dnis training scenarios dnis performed slightly better flis increase number training samples. further conﬁrm statistically -way balanced anova performed classes shown fig. inferred fig. flis outperforms dnis fig. comparison results dnis flis training-test conﬁguration first represents original images patients. second represents corresponding manually segmented image. third represents segmented images using flis. fourth represent segmented images using dnis. green-brain red-csf blue-subdurals. represented also assume sparsity constraint remains classes. training samples represented sparse code represented major steps dictionary learning methods dictionary update sparse coding steps case minimization. dictionary update step solved either using block coordinate descent singular value decomposition second step involves solving orthogonal matching pursuit expensive step. therefore derive computational complexities approximate number operations required solve sparse coding step iteration. discussed above approximate number operations required solve sparse coding step algorithm. that ﬁrst complexity major sparse coding step given dimension equal rd×n dimension equal rd×k. batch-omp problem dimensions computational complexity derived equal +dk. assuming approximately simpliﬁes fig. comparison flis dnis different training conﬁgurations using -way anova. intervals represent percent conﬁdence intervals dice overlap values given conﬁguration method-classtraining size. flis represented blue dnis red. values reported anova across method factor anova values across training size factor realistic training regime dnis competitive mildly better flis training generous. example visual illustration results shown patients fig. beneﬁts flis readily apparent. also note cost training dnis hours training time flis takes seconds table paper address problem segmentation post-op brain images hydrocephalic patients viewpoint dictionary learning discriminative feature discovery. challenging problem distorted anatomy subdural hematoma collections scans. makes subdurals hard differentiate brain csf. solution involves sparsity constrained learning framework wherein dictionary learned pre-labeled training images. learned dictionaries criterion shown capable yielding superior results state methods. aspect method class segment speciﬁc dictionaries necessary substantially reducing memory computational requirements. method tested real patient images collected cure children's hospital uganda results outperformed well-known methods sparsity based segmentation. derive computational complexity flis compare ddls computational complexity method derived ﬁnding approximate number operations required pixel learning dictionaries. simplify derivation assume number training samples size dictionary classes. substituting values complexity learning dictionary single class nk+l). since classes overall complexity learning multiplied cflis pixels image dictionary used nk+l) dimension cflis complexity ddls already showed removing discriminating term flis turns objective function described ddls section ii-c. therefore complex step remains ddls well. however since ddls include distance feature size changes also computes dictionaries classes once. keeping differences mind computational complexity ddls cddls addition separate dictionary computed pixel ddls means complexity scales size image. calculate memory required method compare ddls patch based memory requirement methods calculated estimating number bytes required store dictionaries. case flis ddls size dictionary plays important role calculating memory requirement whereas number training images plays important role uses pre-deﬁned dictionaries. another point note entire stack divided partitions dictionary stored partition derive memory required storing dictionaries individual partition. obtain suppose length dictionary size column vector size complete dictionary classes combined d×k. further also store linear classiﬁer classiﬁcation size therefore complete size dictionary assuming element dictionary represented bytes total memory bytes required storing flis dictionaries mflis memory required ddls major difference flis ddls size column vector ddls approximately half size flis’s case distance values considered ddls. major difference dictionary stored individual pixel. keeping differences mind dictionary length total memory bytes required storing ddls dictionaries mddls image size. memory required patch based method predeﬁned dictionaries pixel stored instead compact dictionaries. given pixel image patch size considered around pixel location training images patch size around pixels form dictionary pixel assuming training images total size dictionary given pixel size patch method approximately half size column vector flis method. therefore total memory bytes required methods msrc mandell volumetric brain analysis neurosurgery part particle ﬁlter segmentation brain cerebrospinal ﬂuid growth dynamics images journal neurosurgery pediatrics vol. mandell volumetric brain analysis neurosurgery part brain volumes discriminate neurocognitive outcomes hydrocephalus journal neurosurgery pediatrics vol. ribbens unsupervised segmentation clustering groupwise registration heterogeneous populations brain images ieee transactions medical imaging vol. automatic segmentation intracranial hematoma volume measurement annual international conference ieee engineering medicine biology society. ieee sharma venugopalan classiﬁcation hematomas brain images using neural network issues challenges intelligent computing techniques international conference ieee gong finding distinctive shape features automatic hematoma classiﬁcation head images traumatic brain injuries tools artiﬁcial intelligence ieee international conference jiang davis label consistent k-svd learning discriminative dictionary recognition ieee transactions pattern analysis machine intelligence vol. monga handbook convex optimization methods imaging brain tumor image segmentation using kernel dictionary learning annual international conference ieee engineering medicine biology society ieee bevilacqua dharmakumar tsaftaris dictionary-driven ischemia detection cardiac phase-resolved myocardial bold rest ieee transactions medical imaging vol. nouranian learning-based multi-label segmentation transrectal ultrasound images prostate brachytherapy ieee transactions medical imaging vol. cherukuri learning based image segmentation postoperative ct-images hydrocephalus case study neural engineering international ieee/embs conference ieee cherukuri implementation details flis pennsylvania state university tech. rep. available https //scholarsphere.psu.edu/concern/generic works/bvqzn. aharon elad bruckstein rmk-svd algorithm designing overcomplete dictionaries sparse representation ieee transactions signal processing vol. rubinstein zibulevsky elad efﬁcient implementation k-svd algorithm using batch orthogonal matching pursuit technion vol.", "year": "2017"}