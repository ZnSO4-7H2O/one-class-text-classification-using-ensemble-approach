{"title": "Implementation of Massive MIMO Uplink Receiver on RaPro Prototyping  Platform", "tag": "eess", "abstract": " The updated physical layer standard of the fifth generation wireless communication suggests the necessity of a rapid prototyping platform. To this end, we develop RaPro, a multi-core general purpose processor-based massive multiple-input-multiple-output (MIMO) prototyping platform. To enhance RaPro, high performance detection and beamforming are needed, whereas both of them request for accurate channel state information (CSI). In this paper, linear minimum mean square error (LMMSE)-based channel estimator is adopted and encapsulated inside RaPro to gain more accurate CSI. Considering the high comlexity and unknown of channel statistics, we design low-complexity LMMSE channel estimator to alleviate the rising complexity along with increasing antenna number and set more computational resource aside for massive MIMO uplink detection and downlink beamforming. Simulation results indicate the high mean square error performance and robustness of designed low-complexity method. Indoor and corridor scenario tests show prominent improvement in bit error rate performance. Time cost analysis proves the practical use and real-time transmission ability of the implemented uplink receiver on RaPro. ", "text": "abstract—the updated physical layer standard ﬁfth generation wireless communication suggests necessity rapid prototyping platform. develop rapro multi-core general purpose processor-based massive multipleinput-multiple-output prototyping platform. enhance rapro high performance detection beamforming needed whereas request accurate channel state information paper linear minimum mean square error -based channel estimator adopted encapsulated inside rapro gain accurate csi. considering high comlexity unknown channel statistics design lowcomplexity lmmse channel estimator alleviate rising complexity along increasing antenna number computational resource aside massive mimo uplink detection downlink beamforming. simulation results indicate high mean square error performance robustness designed lowcomplexity method. indoor corridor scenario tests show prominent improvement error rate performance. time cost analysis proves practical real-time transmission ability implemented uplink receiver rapro. tentially disruptive technology ﬁfth generation cellular network utilizes large excess base station antennas compared user equipment combination massive mimo promising transmission technology orthogonal frequency division multiplexing enables full usage spatial degrees freedom leads high data transmission rate. massive mimo system accurate channel estimator cannot provide channel state information downlink time-division duplex massive mimo system support multi-stream transmission beamforming also necessary state-of-the-art mimo detectors. aforementioned system encounters limitations uplink receiver implementation especially computational complex operations channel estimation mimo detection. complexity channel estimation module connected number antennas subcarriers. consider example massive mimo system subcarriers used transmit data. system times complex matrix-vector multiplication computed within slot adopting linear minimum mean square error channel estimator. general purpose processor amount computation cannot within slot means detection process delayed transmission real-time. enable real-time transmission massive mimo system employing complexity channel estimators saving computational resource detection beamforming plays critical role. condition suggests reduction lmmse estimation using nearest taps similarly low-rank lmmse channel estimator proposed analyzed ﬁxed design exhibited robustness changes channel correlation signal-to-noise ratio novel complexity lmmse channel estimator partitions channel autocorrelation matrix small sub-matrices non-overlapping overlapping manners signiﬁcantly reducing complexity mimo detector mmse detector presents best performance linear detection ﬁrst considered implementation. implementation veriﬁcation receiver linear channel estimation schemes mmse mimo detection technique ﬁeld-programmable gate array -based extremely time-consuming considering development cycle. application speciﬁc integrated circuit design low-complexity lmmse channel estimator constrained specialized hardware instead implemented veriﬁed over-the-air measurements general communication system testbed. developed rapro novel prototyping platform combines fpga-privileged modules software-deﬁned radio platform high-level programming language advanced algorithms server multi-core general purpose processors based platform data processing algorithms massive mimo uplink receiver includes channel estimation mimo detection implemented veriﬁed rapidly. present paper focuses implementation receiver data processing includes low-complexity channel estimation mimo detection schemes uplink long term evaluation -like massive mimo systems rapro server. monte-carlo simulation measurements conducted evaluate performance uplink receiver. subsequent contents organized follows. section establishes system model provide overview massive mimo system accordance prototype system rapro. section discusses design uplink receiver multi-core gpps rapro section presents speciﬁc implementation procedures practical channel estimation mimo detection schemes elaborating designed mapping rules w-lmmse w-lmmse. section presents discusses simulation measurement results. section provides config. illustration single-cell massive mimo system. system equipped antennas serves single-antenna ues. data transmission occurs uplink chain reversed downlink. fig. time-frequency resource grids single-antenna ues. allocation pilots inside sub-band corresponds individual subframes whereas subframe ﬁlled primary synchronization signals synchronization. pilot transmitting signals considered formula feature inﬂuence setting pilot properly. suppose sends pilot certain moment subcarrier whereas others send zero-value signals formula transforms following signal relationship formula observed frequency domain channel estimators subsequently conducted. formula transformed time domain frequency domain using fast fourier transform becomes following formula denote receiving signal antenna transmitting signal awgn noise antenna current channel subcarrier frequency domain respectively. total subcarriers zero-padding subcarriers observed; denotes number subcarriers recource block ofdm signal. figure illustrates resource allocation systems similar pilot gradually occupies subcarrier sub-band process repeated. example pilots occupy subcarrier notation matrices vectors denoted uppercase lowercase letters boldface respectively. identity matrix denoted specifying dimension necessary; stand conjugate transpose transpose inverse operations respectively; statistical expectation; denotes highest integer larger denotes convolution operation; means diag represents diagonal matrix whose diagnal elements vector inside brackets. figure illustrates uplink chain single-cell tddbased multi-user massive mimo system ofdm transmission scheme. shown ﬁgure equipped antennas serves single-antenna ues. antenna another antenna transmission link channel assumed path multipath channel time delay path moment receiving signal speciﬁc subcarrier determined follows corresponds transmitting signal additive white gaussian noise denotes channel impulse response. formula also form convolution. thus obtain following formula describes system terms ofdm architecture. spatial multiplexing mimo properties considered system formulated follows. ofdm subcarrier transmitting symbols receiving symbols detected. thus system mimo system. considering subcarrier system function follows fig. architecture rapro function module. rapro consists sdrs contained fpga module server multi-core gpps. fpga-privileged operations fft/ifft conducted sdrs. computational complex algorithms similar channel estimation mimo detection implemented server. iii. overall design uplink receiver rapro rapro novel rapid prototyping testbed recently proposed team; utilizes fpga devices gpps server. section describes rapro setup present overview prototyping platform. portion also shows overall design uplink receiver describe multi-core gpp-based multi-thread paralleled data processing procedure describes function calling typical data format. figure shows architecture rapro corresponding function module. rapro conﬁgured duplex mode. paper consider uplink chain elaborate implementation uplink receiver transmitter side rapro uplink transmission four active strings data bits generated randomized four hosts mapped constellation based quadrature amplitude modulation schemes. resource allocation inverse -based ofdm modulation cyclic preﬁx adding conducted nodes usrp-r. analog-to-digital conversion upconversion data transmitted simpliﬁed lte-like millisecond radio frame structure sent four individual dipole antennas bandwidth center frequency. receiver side rapro uplink transmission wireless signals collected uniform planar array connected eight sdrs conduct fpga-privileged operation includes removal fft-based ofdm demodulation resource deallocation. obtained baseband symbol streams aggregated subsequently extensions instrumentation chassis contains form user datagram protocol packages. packages sent small formfactor pluggable plus cables ethernet ports multi-core server contains intel xeon processors. baseband signal processing algorithms receiver include channel estimation mimo detection demapping implemented server; algorithms extended next subsection. bits sent laptop display constellation play video. accurate timing synchronization ensured among antennas pxie-t inside chassis whereas interface synchronization achieved ﬁne-timing synchronization algorithm implemented sdrs. rapro replaces proprietary hardware server contains gpps multi-core gpp-based architecture enables real-time ﬂexible scalable implementation baseband processing algorithms. server ubuntu operating system eclipse platform language used perform paralleled threading programming intel math kernel library provides wide range optimized functions calculate fig. thread-interactive relationship diagram ﬂowchart thread. bottom three threads controlled main thread. receiving processing threads send control words back main thread mark ﬁnish. main thread receiver starts activates udp-receiving threads. corresponding slot processing thread runs slot data received. otherwise thread waits enters next loop directly. udp-receiving thread waits stores memory sends control word main thread keeps receiving udp. baseband data processing includes channel estimation mimo detection demapping conducted slot processing threads. processing processing thread sends control word main thread enters next loop. recovered data udp-sending thread packed sent laptop show constellation. data comprise video stream udp-sending thread send data video display. multi-core gpp-based receiver design rapro uses multi-threads perform paralleled processing binds thread processor core diminish context switch overhead. figure summarizes overall data processing program diagram massive mimo uplink receiver server shows four kinds threads bound cores parallel total main thread bound core scheduling threads receiving threads bound cores receiving data sfp+ cables slot processing threads bound cores conducting baseband signal processing recover data bits sending thread bound core sending recovered data laptop display constellation video total slot processing threads considered subframe carries synchronization signals whereas subframes carry data thus radio frame includes slot data must processed. kind threads generated self-deﬁned structure using language. figure presents logical relationship among four kinds threads speciﬁc diagrams. three types thread controlled main thread receiving thread slot processing thread feedback control words main thread mark ﬁnish. spinlock fig. function calling data format. active slot processing thread calls receiver.c conduct data processing. five subfunctions channel estimation.c mmse mimo detection.c demapper.c xor.c calculation.c receiver.c called sequence realize corresponding functions literal meanings function names. inputs outputs function follow prescriptive layout enable functional design. typical example data format given numbers inside rectangles refer number data form corresponding types. data presented stored one-dimensional dynamic array allowing intel functions conduct matrix multiplication operations. channel estimate also interpolated interpolated channel estimator linear interpolation second-order polynomial interpolation cubic spline interpolation lmmse channel estimators interpolated channel estimator lmmse-based channel estimators dedicated make channel estimate dense ﬁlled subcarriers. lmmse channel estimator weighted estimator refers weight matrix. lmmse channel estimation method determines optimal weight matrix minimizing mean square error. indicates optimal weight matrix written follows formula shows prior information channel frequency correlation real-time value necessary conduct lmmse estimation. however obtaining information presents difﬁculty practice. thread. otherwise sending semaphore program checks whether slot processing threads completed sends semaphore udp-sending thread waits microsecond check receiving state again. otherwise program waits microsecond enters next loop directly. udp-receiving thread program waits semaphore main thread using function wait. semaphore positive program waits arrives stores memory. udp-receiving thread collects packages eight receiving antennas sends control word main thread ﬁrst three uplink ofdm symbols include uplink pilot ofdm symbol uplink data ofdm symbols within slot eight antennas stored. afterward packages still ready udp-receiving thread continually checks arrival udp. received data transferred slot processing threads conduct baseband data processing channel estimation mimo detection demapping vital operation uplink receiver; topic expounded later. processing slot processing threads send control words main thread wait next semaphore. udp-sending thread packs recovered data sends laptop display constellation. data played using data include video streams. slot processing thread operations channel estimation mimo detection demapper operation error rate calculation packed functions functions compressed function receiver.c. active thread calls receiver.c conduct data processing function calling design provides remarkable beneﬁts. active slot processing threads share code receiver.c different data conduct parallel data processing. novel algorithm channel estimation mimo detection needs veriﬁcation written separate function replace original one. shared code uniﬁed format input output data plays important role. figure illustrates typical example data layout. data presented stored onedimensional dynamic array using language command malloc. format properly allows intel functions conduct matrix multiplication operations. notably dynamic arrays must freed release memory. section discusses implementation computational complex data processing algorithms massive mimo uplink receiver; algorithms include channel estimation schemes mmse mimo detection. apart conventional algorithms simpliﬁed lmmse-based channel estimation methods w-lmmse w-lmmse channel estimation designed explained detail. basics conventional channel estimators detectors conventional channel estimation schemes considered include channel estimation lmmse channel estimation. mimo detection schemes include detection mmse detection. methods shown follows. following conditions. zero-mean complex random variables power-delay proﬁle ce−τm/τrms delays uniformly independently distributed. indicates single element correlation matrix rhrshrs subcarrier ˆhlsrs channel model computed follows represents assumptive number channel paths number subcarriers denote indexes subcarriers intended calculate correlation. thus element ˆhlsrs rhrshrs depends difference instead value therefore given formula transitions following robustness characteristics lmmse estimator toward snrﬁxed enable pre-calculation weighed matrix assumptive parameters snrﬁxed present simulation results section therefore weight matrix depends relative locations subcarrier certain snrﬁxed indicating difference mmse mimo detector mmse mimo detector must know prior noise variance. however detectors must still calculate matrix inverse timeconsuming. massive mimo system equipped increasing number antennas gain improved accuracy performance causing rising complexity channel estimators. formula shows matrix inverse operation dominates computational complexity lmmse channel estimation. matrix dimension must reduced obtain low-complexity lmmse channel estimator. according dimension reduction design mapping rules wlmmse w-lmmse reduce matrix dimension respectively. w-lmmse channel estimator complexity lmmse channel estimate calculation according formula mainly draws upon inverse matrix. matrix features dimension presence subcarriers. w-lmmse channel estimator reduce computation effectively separating dimension matrix inverse times dimension matrix inverse performance trade-off. w-lmmse channel estimator partitions estimate groups group contains three elements overlap. ls-group-constituted vector multiplied ×-dimension weight matrix generated formula then group results sequenced. obtained channel estimate result w-lmmse estimator. three weight matrices needed process instead simpliﬁed channel model. thus method named w-lmmse. illustrate idea assuming system subcarriers resource block receiving antennas four active. based assumed pilot structure groups tabulated table table shows difference element subcarriers ˆhlmm sers subcarriers ˆhlsrs equivalent indexes thus ˆhlsrs same. difference elements subcarriers inside ˆhlsrs equivalent indexes thus rhrshrs same. formula shows weight matrix indexes weight matrix must also considered. variations pilot location result effect subcarriers ˆhlmm sers ˆhlsrs. thus ˆhlsrs also unchanged. remains unchanged. similarly ˆhlsrs thus table correspond weight matrices values follows fig. implementation procedures low-complexity lmmse channel estimation. weight matrices ﬁrst calculated matlab passed function channel estimation server parameters. combined receiving data local pilots channel estimates obtained low-complexity lmmse w-lmmse w-lmmse estimates included complex multiplication weight matrix channel estimates. value reﬁned based performance test environment. w-lmmse channel estimator compared wlmmse w-lmmse channel estimator employs subcarriers calculate correlation matrix. thus complexity w-lmmse complex wlmmse still less lmmse channel estimator. w-lmmse group features goal wlmmse group whereas elements identiﬁed vector weight matrix presents dimension. table provides data w-lmmse group interpreted interpreted .... lmmse estimate calculated multiplication weight matrix corresponding estimate vector. w-lmmse estimator highly complicated considering implementation. addition computations matrix inverse times complex multiplication needed weight matrices. hand three weight matrices needed w-lmmse conduct times complex multiplication. different w-lmmse lead fig. intel interpretation complex multiplication. function cblas cgemm used complex multiplication matrices vectors. typical example shown middle whose meaning explained bottom presents function calculates multiplication ×-dimension matrix vector. fig. simulation results channel estimation schemes performance channel estimation schemes without timing errors. performance channel estimation schemes two-point timing error. performance changes mmse-based channel estimation schemes along varies realistic value performance changes mmse-based channel estimation schemes along snrﬁxed varying realistic value different subcarriers ˆhlsrs. although subcarriers hlmm sers show changes ˆhlsrs still changes causes different feature different weight matrix groups. contains weight matrices differ others namely implementation procedures channel estimators mimo detector packaged functions invoked slot processing threads section presents detailed implementation procedures within channel estimation.c mmse mimo detection.c. channel estimation.c figure shows detailed wlmmse channel estimation procedure. first weight matrix calculated based formula table ﬁxed snrﬁxed different values vary matlab. certain value weight matrix group includes weight matrices weight matrix contains elements. considering hardware implementation real imaginary parts weight matrices written .txt ﬁles elements row. parts combined ﬂoat complex array shown eclipse figure fig. test scenarios deployment rapro. indoor scenario occurs typical ofﬁce room area approximately corridor scenario transpires long narrow corridor. details components include antennas sdrs eight sdrs chassis control panel server resource monitor. read parameter starting main thread. parameter contains information weight matrix passed slot processing thread w-lmmse channel estimation algorithm within slot deployed. data needed conduct channel estimation include received data local pilots. thus data also passed thread. ﬁrst ofdm symbol local pilot according formula paper replace division multiplication magnitude quadrature phase-shift keying modulated pilot symbol normalized local pilot conjugated pilot. next step performs complex multiplication weight matrix channel estimation results obtained former step obtain ˆhlmm sers based formula weight matrix group w-lmmse channel estimator differs w-lmmse channel estimator shares weight matrix group among ues. thus data belonging different must distinguished multiplied corresponding weight matrix w-lmmse channel estimator. considering robustness simulation results regarding parameter adequate found selecting weight matrix group largest checking performance. performance continually checked using weight matrix comprising group less another group best performance achieved. group regarded suitable weight matrix current scenario. another point consider means conducting complex multiplication matrix vector subcarrier group ˆhlsrs. solution employs function intel simplify accelerate calculation instead using several loops calculate scalar elements individually arranging sequence. times complex multiplication performed w-lmmse channel estimation implying importance intel mkl. intel provides math routines functions improved performance software applications solve large computational problems. program optimized latest intel processors include multiple cores. routines blas level intel designed vector-vector matrixvector matrix-matrix operations respectively. matrixmatrix operations used generalized purposes. intel indicates function cblas cgemm computes complex matrix product general matrices. syntax function cblas cgemm shown figure operation function deﬁned alpha beta either alpha beta scalars; matrices. m-by-k matrix k-by-n matrix m-by-n matrix. input parameters imply state factors. layout speciﬁes whether two-dimensional array storage row-major column-major example cblasrowmajor means matrix gradually stretches vector row. transa speciﬁes form used multiplication transb similar transa used specify refer initial positions complex matrix factors initial position result. indicate number column matrices respectively according layout typical example complex multiplication matrix subcarrier group ˆhlsr vector presented middle figure example initialization values alpha beta denote transmission receiver antenna denotes ﬁrst group subcarriers denotes ﬁrst group lmmse subcarriers. therefore operation calculates content bottom figure rapro mmse mimo detector adopted recover data according formula mimo detection module packed function mmse mimo detection.c. section describes detail realization procedure function. parameters antennas single-antenna size used subcarriers type modulation channel type channel taps channel delay channel power proﬁle assumptive assumptive channel taps ﬁrst step involves preparation prior data include channel matrix noise variance fixed temporarily used lack estimation module. channel matrix subcarrier comprises element picked channel estimate passed channel estimation.c function. data account subcarriers shown figure thus channel estimation cover subcarriers conduct detection each. situation naturally occurs w-lmmse channel estimation. schemes mentioned channel estimation results consider upsampled subcarriers must complemented advance. common idea zero-order holding indicates following subcarrier blanks padded last channel estimation value. uplink data inside slot. matrix-vector multiplication also employs intel function cblas cgemm figure regard transa cblasconjtrans realize conjugate transpose multiplication. intel function lapacke cposv used solve linear equation routine solves real complex systems linear equation n-by-n symmetric/hermitian positive-deﬁned matrix columns matrix individual right-hand sides columns corresponding solutions. cholesky decomposition involves factor uplo triangular matrix factored form used solve system equation finally recovered symbol stored regulated format figure fig. scenario test results channel estimation schemes. performances different channel estimation schemes indoor test. performances different channel estimation schemes corridor test. monte carlo method utilized simulate matlab based bits generated randomly compare performance among aforementioned channel estimation schemes. table tabulates system simulation parameters. figure shows simulation results. figure presents performances accurate synchronization. wlmmse channel estimator offers approximately gain method close lmmse estimator difference w-lmmse channel estimator presents approximately gain gain three-fold interpolated figure displays performance twopoint timing synchronization error exists. two-point timing synchronization error leads slight degradation performance mmse-based estimators. therefore w-lmmse w-lmmse channel estimators robust detecting several point timing errors property crucial implementation prototyping testbeds practical system cannot ensure accurate synchronization times. figure illustrates performance mmsebased channel estimators along increasing assumed channel taps several channel taps exist. lmmse possesses least equals real number less distant correct value large result undesirable. results attributed neglected channel paths discarded carried information. result additional noise performance decreases slightly slightly higher trend also suitable w-lmmse w-lmmse although degree performance decrease less less subcarrier correlation considered. observations imply performance lmmse-based channel estimation methods easily affected less real value especially subcarriers involved. hand lmmse-based channel estimation schemes show robustness slightly higher real number taps. indoor test scenario occurs typical ofﬁce room area approximately shown figure corridor test scenario long narrow corridor approximately long shown figure component rapro observed directly images. four single-antenna connected four interfaces sdrs encapsulated wireless signals sent antennas. data processed sdrs collected chassis sent server multi-core gpps spf+ cables. figure displays details components. distance transmitting receiving antennas approximates modulation schemes four comprise qpsk -qam qam. reﬁne performance different measured -qam mmse detection. table provides results indoor corridor test scenarios. antenna gain conﬁgured w-lmmse declines indoor scenario rises corridor scenario. difference suggests channel numbers indoor corridor scenarios equal less respectively. result reasonable number reﬂection paths open places corridor scenario less ofﬁce ﬁlled reﬂectors. compared indoor scenario corridor scenario presents larger gain w-lmmse wlmmse indicating w-lmmse channel estimation outperforms w-lmmse corridor scenario indoor scenario. w-lmmse w-lmmse channel estimation presents rising trend increasing ﬁnding differs simulation results shown figures observations difference simulation realistic channels. adopt scenarios moderate value performance relatively stable figures show performances -qam mmse detection indoor corridor scenarios respectively. w-lmmse channel estimation performs best followed w-lmmse three-fold interpolated channel estimator; result previously indicated performance simulation. designed low-complexity channel estimation mapping rules w-lmmse w-lmmse result prominent performance improvement reach approximately -fold -fold lower -fold interpolated channel estimators antenna gain measures reach value w-lmmse channel estimator save approximately antenna gains compared w-lmmse -fold interpolated channel estimators respectively. corridor scenario achieves better performance compared indoor scenario antenna gain totals w-lmmse channel estimation. wlmmse channel estimator achieves indoor scenario antenna gain whereas achieve corridor scenario. performance w-lmmse corridor scenario similar indoor case whereas w-lmmse corridor case performs better indoor case agreeing former analysis w-lmmse performs better corridor scenario indoor scenario. table summarizes time costs. estimation cycles represent average clock cycles consumed conduct channel estimation slot processing thread. estimation time corresponding time considers principal frequency ghz. total mean cycle refers average cycles ﬁguring data bits slot processing thread. given slot processing threads parallel total cycles equivalent time cycles processing data within whole frame. estimation cycles w-lmmse w-lmmse account half total cycles suggesting high complexity mmse-based channel estimation. theoretical duty cycle calculated dividing total time close realistic duty cycles shown system monitor table shows realistic duty cycles less therefore time costs multi-core gpp-based uplink receiver contains w-lmmse w-lmmse channel estimator mmse mimo detector allow real-time transmission rapro. paper applied massive mimo uplink receiver multi-core gpps massive mimo rapid prototyping system rapro. also present overall multithreads functional design discuss speciﬁc procedures w-lmmse channel estimation mmse mimo detector. numerical simulation results indicate robustness standard parameter choice designed lowcomplexity lmmse channel estimation schemes w-lmmse w-lmmse. indoor corridor scenario test results suggest feasibility practicality uplink receiver implementation.", "year": "2018"}