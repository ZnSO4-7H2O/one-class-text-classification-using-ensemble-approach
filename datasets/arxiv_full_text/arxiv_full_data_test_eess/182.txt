{"title": "Sparse recovery of undersampled intensity patterns for coherent  diffraction imaging at high X-ray energies", "tag": "eess", "abstract": " Coherent X-ray photons with energies higher than 50 keV offer new possibilities for imaging nanoscale lattice distortions in bulk crystalline materials using Bragg peak phase retrieval methods. However, the compression of reciprocal space at high energies typically results in poorly resolved fringes on an area detector, rendering the diffraction data unsuitable for the three-dimensional reconstruction of compact crystals. To address this problem, we propose a method by which to recover fine fringe detail in the scattered intensity. This recovery is achieved in two steps: multiple undersampled measurements are made by in-plane sub-pixel motion of the area detector, then this data set is passed to a sparsity-based numerical solver that recovers fringe detail suitable for standard Bragg coherent diffraction imaging (BCDI) reconstruction methods of compact single crystals. The key insight of this paper is that sparsity in a BCDI data set can be enforced by recognising that the signal in the detector, though poorly resolved, is band-limited. This requires fewer in-plane detector translations for complete signal recovery, while adhering to information theory limits. We use simulated BCDI data sets to demonstrate the approach, outline our sparse recovery strategy, and comment on future opportunities. ", "text": "sparse recovery undersampled intensity paerns coherent diraction imaging high x-ray energies maddali* calvo-almazan almer p.kenesei j.-s. park harder nashed hruszkewycz materials science division argonne national laboratory lemont x-ray sciences division argonne national laboratory lemont mathematics computer science division argonne national laboratory lemont department electrical engineering computer science northwestern university evanston *corresponding author smaddalianl.gov coherent x-ray photons energies higher possibilities imaging nanoscale laice distortions bulk crystalline materials using bragg peak phase retrieval methods. however compression reciprocal space high energies typically results poorly resolved fringes area detector rendering diraction data unsuitable three-dimensional reconstruction compact crystals. address problem propose method recover fine fringe detail scaered intensity. recovery achieved steps multiple undersampled measurements made in-plane sub-pixel motion area detector data passed sparsity-based numerical solver recovers fringe detail suitable standard bragg coherent diraction imaging reconstruction methods compact single crystals. insight paper sparsity bcdi data enforced recognising signal detector though poorly resolved band-limited. requires fewer in-plane detector translations complete signal recovery adhering information theory limits. simulated bcdi data sets demonstrate approach outline sparse recovery strategy comment future opportunities. introduction coherent x-ray diraction imaging methods applied bragg peaks emerged powerful tool materials science characterising lattice distortion elds defects crystalline nanostructures–. experiments currently feasible photon energies lower hard x-ray spectrum beyond third-generation synchrotrons limited coherent however ongoing planned construction next-generation synchrotrons bring greatly increased coherence beam energies greater making high-energy bragg feasible. capability enable nanoscale structural characterization material volumes environments accessible highly penetrating x-rays. example critical research area probe deformation states within individual grains macroscopic volumes wide application structural functional materials. measurements complement enhance models gleaned existing non-destructive imaging techniques high-energy diraction microscopy diraction contrast tomography providing structure strain resolution within grains. step direction paper addresses prominent issues arise imaging individual nanomicro-scale crystals high-energy coherent x-rays. context structural materials compact crystal proxy single grain polycrystal. otherwise represent isolated nanocrystal dense medium requires penetrative power high energy x-rays opening potential avenues study. treatment focused simulations bcdi measurement single compact crystal illuminated uniformly coherent high-energy x-rays rotated bragg condition. consequently three-dimensional volume reciprocal space measured area detector sequence parallel layers bcdi experiment increasing beam energy value currently suitable necessary hedm compresses reciprocal space least dimension. conditions solid angle subtended detector pixel covers substantial portion diraction pattern. result signal features raction fringes) critical inversion diraction pattern longer resolved typical pixelated x-ray area detector. demonstrated figure shows coherent diraction intensity pattern depicted well-resolved under-resolved fringes mimicking measurements made lower higher x-ray energies respectively. subsequent loss diraction feature visibility higher energies renders conventional phase retrieval ineective. recovery feature detail intensity pattern additional independent measurements wave intensity therefore necessary. work consider case additional measurements come figure bragg experimental geometry incident scattered wave vectors. three-dimensional reciprocal space sampled nite steps shown. three steps detector plane gure plane denoted ‘◦’) third dictates migration plane. sampling vectors crystallographic orientation scatterer respect beam manner rotation. acquisition data detector translations perpendicular incoming beam case coarse detector resolution. application sparse recovery techniques greatly reduces number additional measurements required. translating area detector perpendicular incoming beam sub-pixel steps explored previously. pixel measurement data imposes constraint particular region scattered intensity theory detail desired sub-pixel resolution could recovered acquire adequate number constraints taken suciently small detector osets. diculties fullling requirement described detail section appendix. paper utilise compressed sensing demonstrate signal recovery signicantly fewer pixel constraints pixels desired image. required number constraints dictated information content desired image expressed fourier space. reduced number constraints made possible fact bcdi intensity pattern compact single crystal necessarily band-limited. compressed sensing approach employed here needs make approximately many coarse pixel measurements poorly-resolved signal non-zero components fourier representation well-resolved signal. specic representation used method cosine basis. recovery condensed representation signal perfectly suited mathematical optimization algorithms specialize sparse arrays. throughout paper refer upsampled intensity patterns resulting sparse recovery scheme ‘recovered’ images patterns. paper organised following manner beginning simplifying assumptions describe bcdi simulations range energies latter corresponding high-energy experiment conceivable high-brightness synchrotron. includes establishing suitable ground truth intensity pattern well-resolved intensity fringes consistent currently feasible measurements recovered intensity patterns benchmarked. describe detector sub-pixel translation method additional constraints provided intrinsic band-limit intensity pattern followed compressed sensing algorithm employed recover slice data independently. demonstrate recovery qualitatively dierent intensity patterns simulations represent dierent beam energies varying sub-pixel detector translations. finally show three-dimensional reconstructions simulated nanocrystal obtained applying conventional bcdi phase retrieval simulated high-energy data sets recovered approach. describe method emulate variety physical modications bcdi experiment dicult realise experimentally. close comments experiments method potentially enable next-generation synchrotrons. figure target recovery algorithm suciently well-resolved approximation continuous scattered eld. sub-pixel translation detector constraints pixel values obtained. high-energy bcdi simulations bcdi measurements query wave intensity fraunhofer regime scattered wave front fourier transform illuminated compact crystal. scatterer rotated bragg condition intensity pattern measured slice slice area detector. crystal size illuminated hard x-rays energy required range rotation suciently small successive slices approximated parallel reciprocal space. simulate compact crystal grid points inside faceted volume centre three-dimensional complex array. interior points complex-valued magnitude spatially varying phase mimics strain eld. exterior points magnitude corresponding diraction signal obtained three-dimensional array dimensions represent pixel coordinates area detector third represents successive images acquired rotating crystal bragg condition. simulations crystal resides inside within simulation array size denoting angular steps pixel detector. ground truth intensity pattern taken squared modulus array. nominally associate beam energy ground truth. data kind could conceivably collected existing bcdi facility. simulation overbinned diraction signal higher energies straightforward slice ground truth blocks pixels summed single intensity value binning operation mimics high-energy bcdi experiment since photons would spread larger solid angle lower x-ray energies aggregate fewer pixels higher energies compression reciprocal space. equivalently imagine overbinning arise measurement proportionately larger pixels. ratio pixel sizes equal ratio beam energies. example diraction features contained every block pixels squeezed single pixel beam energy kev. case manner binning eectively reduces feature visibility bcdi intensity measurement redress additional information collected sub-pixel detector translations. similar method ptychography proposed batey general nite size physical pixels makes impossible suciently constrain intensity features ground truth lost binning regardless nely detector translated plane. assertion rigorously proved section supplementary material. mentioned earlier approach instead demonstrate sub-pixel-scale feature recovery fewer measurements enabled sparsity fourier representation scattered intensity. focus section discuss binned data sets context compressed sensing measurement motivate sparse recovery techniques. point real-world bcdi experiment energies given detector would span larger q-space aperture would entirely covered kev. simulations consider q-space aperture corresponding detector space ground truth. focus recovery features original ground truth simulation binned data sets subtend range. justify pointing typical bcdi experiments edge pixels detector capture relatively intensities compared central pixels scattered intensities outside aperture contribute negligibly fourier representation original scatterer. sparse recovery mathematical details seek method reverse binning process described section obtain original ground-truth diraction pattern features well-resolved fringes. method recovery detail limited binned pixel measurements hinges representing two-dimensional slice discrete cosine basis utilise numerically convenient variant two-dimensional discrete cosine transform dened n-sized image linear transformation qπ/n]. transform instrumental many digital media compression formats jpeg figures compare representations diraction pattern demonstrate section results sparse recovery algorithm depend smallest components. thus simulations consider detector noise high signal-to-noise ratio noise manifests weakly automatically removed optimisation. three-dimensional diraction pattern nite crystal inherently band-limited function since auto-correlation scattering factor nite crystal follows two-dimensional slice diraction pattern also band-limited since slice contains essentially signal information two-dimensional would require approximately many pixel measurements number non-zero components latter representation order fully determine well-known principle information theory underlies compressed sensing/sparse recovery algorithms. approach immense importance scenarios scant number physical measurements seemingly fail mathematically constrain system. sparse recovery target intensity pattern ultimately seek obtained simply inverting transform. avoid information loss ground truth simulation patterson function simulated crystal fully captured within three dimensional simulation array. words buer width around scatterer least span scatterer dimension simulation sizes described section well minimum requirement ensure patterson function fully captured also sparse array. dene sparse recovery problem terms unknown diraction slice desired ne-pixel resolution sparse representation measurements made signal represented linear operation resulting measured values illustrate operations using example intensity pattern shown figure relatively small number pixels. example coarse pixelation grid size pixels results total measurements therefore matrix. additional measurements obtained translating detector plane perpendicular incoming beam shown. detector oset provides pixel measurements pixel measurement corresponds matrix proved section appendix possible obtain independent rows matrix detector shifts address problem compressed sensing. compressed sensing techniques solve system equations enforcing sparse. small penalty imposition objective function equation explicitly enforces sparsity unknown briey optimisation converges solution fewest non-zero components simultaneously satises constraints target image recovered inverting sparsifying transform point recovery scheme strictly enforce constraint non-negativity results recovered images negative-valued pixels simply threshold zero show section thresholding still results working approximation continuous signal phase retrieval point view. compressed sensing theory provides precise success threshold number pixel measurements image size pixels number signicant components sparse representation. general results recovery well threshold negligibly dierent original image itself. recovery results figure shows visual comparison benchmark ground truth diraction slice corresponding ne-pixel diraction slice recovered simulated intensity patterns obtained sub-pixel detector translation coarsely binned diraction slice size pixels recovered diraction slice size pixels corresponding better quantitative picture examine delity dierent recovered diraction patterns respective ground truth benchmark slices function beam energy degree upsampling. benchmark images represent qualitatively dierent intensity distributions \"on-bragg\" central slice strong highly localised peak intensity distribution \"o-bragg\" terminal slice weaker spread out. delity quantied sparse recovery transfer function dene single recovered image indices pixels nely pixelated diraction pattern. srtf analogous phase retrieval transfer function common phase retrieval literature. perfect recovery srtf pixels. results expressed terms mean srtf standard deviation spread around mean evaluated recovered images. figures indicate steady improvement srtf detector osets. sucient sub-pixel translations detector ensure srtf recovered image remains vicinity ideal value higher beam energy greater variance srtf. appearance artefacts insuciently constrained optimisation prominently seen figures gures hand slight deviation srtf high stems small penalty α|x| objective function equation finally figure show results standard bcdi phase retrieval applied diraction intensity patterns upsampled simulations data sets sub-pixel translations. upsampled intensity pattern data recovered original detector position additional detector osets along pixel diagonals. reconstructions agreement original structure discussion outlined framework features high-energy coherent diraction intensity patterns individual compact crystals recovered using compressed sensing sparse recovery. success methods often figure slice diraction signal slice imaged detector nominally spectrum magnitude signal equivalent signal simulated recovered image pixelation equivalent signal spectrum magnitude recovered signal benchmark image scale recovered image scale showing regions negative pixels thresholded zero. figure central slice diraction pattern edge slice diraction pattern srtf trend central slice srtf trend edge slice original synthetic particle surface phase variation reconstructed particle surface phase variation corresponding energies respectively. phase retrieval recipe used solvent ipping →hybrid input-output →solvent ipping →error reduction shrinkwrapping every iterations. justied literature demonstrating recovery fewer measurements size actual signal array. thus also described methodology terms coarse ‘pixel measurements’ quantifying information content signal. section translate phrasing quantities directly related design experiments. specically show sparse recovery technique exploited emulate smaller pixel sizes larger sample-detector distances. thereby demonstrate advantage putting burden signal detection numerical algorithms opposed substantially modifying existing experimental setup constructing massive experimental enclosures enable large detector distances large bragg angles. firstly table shows number pixel measurement constraints simulations function x-ray energy multiplier number detector positions. maximum number pixel measurements computed using equation appendix. regions interest numbers coloured fall theoretical limit grey-shaded numbers show detector osets along diagonals give additional binning constraints grid periodicity. here aimed recover ground truth within pixel region number unknown sub-pixels recover therefore also simulated crystal cant components central diraction slice). numbers region result inadequate number detector positions. regime acquired signal information truly decient sparse recovery possible. region denotes limitations chosen detector translation strategy sets only). given crystal size detector pixel size appropriate choices sample-detector distance detector oset strategy ensure existence intermediate region grey compressed sensing successfully recover diracted intensity pattern. connection experimental parameters made imagine binning constraints also obtained single detector image pixels queries region interest reciprocal space. stated dierently oset detector images larger pixel size conceptually equivalent single detector image smaller pixel size. information theoretical point view sets constraints equivalent descriptions scattered wave intensity. immediately suggests reinterpretation table terms experimental parameters. example beam energy relative measurement kev. original ×-pixel q-space region interest ground truth simulation squeezed ×-pixel region centre detector reciprocal space compression. eective coarse pixel size original region interest simply units. detector positions energy table shows access total pixel measurements eectively emulating pixel grid region interest. eective pixel size scaled factor equivalently able resolve spatial frequencies better label factor fraunhofer approximation quantity also interpreted eective increase sample-detector distance given pixel size. spatial frequency step related pixel size sample-detector distance table number unique binning constraints resulting diagonal detector osets alone function pbf. values information theoretic limit shown red. shaded numbers indicate detector osets contribute binning constraints. eective multiplier sample-detector distance variation beam energy number detector osets. colour codes reference earlier bcdi experiment crystal imaged sample detector distance pixel size beam energy limit reached possible binning constraints accounted detector osets give constraints. shown section appendix case number pixel measurements fall fully within q-space region interest figure shows maximum values condition wider range beam energies. maximum upsampling nearly undoes eect pixel binning high energies proportionate increase eectively emulating sample-detector distance would otherwise needed resolve intensity fringes. dierence accounted fact pixels fully contained within original q-range used measurement constraints. closely related fact system equations solved inevitably underdetermined. summary described signal recovery technique single-crystal bcdi data sets acquired x-ray energies typically suited hedm applications methodology relies modication conventional bcdi setup additional data acquired translating detector across incoming diracted beam. described fundamental incompleteness data collected method upsampling calls incorporation form extra information signal. necessity motivated techniques recover signal directly sparse representations based methodology rigorous proof existence representation coherent scattering fully-illuminated compact single crystal. quantied image recovery compressed sensing process shown subsequent phase retrieval recovered data sets agreement original simulated crystal. information theorybased analysis detector-space upsampling shows smaller pixels larger sampledetector distances emulated minimal changes experimental setup. capability potential signicantly inuence design space-constrained experiments high energy coherent scattering beamlines. incorporated existing nearfar-eld hedm workows high-energy bcdi could nanoscale component generalised experiment imaging characterisation polycrystalline samples multiple length scales. coupled development computational methodologies multiscale characterisation capabilities could long validating existing models materials physics well informing creation processing engineering materials. figure behaviour maximum value sample-detector distance multiplier dierent beam energies. pixel size distance multiplier asymptotically approaches limit large reciprocal space aperture data availability ground truth simulation python code sparse recovery available upon reasonable request. please contact corresponding author. author contributions analysis developed implemented help ica. wrote manuscript contributions jsp. authors contributed rening concepts presented. acknowledgements design simulation demonstration in-plane detector translation upsampling framework high-energy coherent x-ray diraction supported laboratory directed research development funding argonne national laboratory provided director science u.s. department energy contract de-acch. phase retrieval upsampled patterns feasibility estimates supported advanced photon source u.s. department energy science user facility operated science argonne national laboratory contract de-ac-ch. adaptation sparsity-based signal processing methods coherent diraction patterns upsampled detector translation supported u.s. department energy science basic energy sciences materials science engineering division. detector-plane upsampling under-determined system equations goal method reverse binning process described section main text re-obtain original high-resolution representation single detector image. figure example one-dimensional grid osets steps quarter physical pixel. two-dimensional grid osets simulations along physical pixel diagonals. star signies centre un-translated detector orange markers denote centres oset detector. high-energy bcdi experiment pixel size determined smallest oset detector matter convenience. osets fractions chosen pixel size undesirable since forced make assumptions intensity distribution within single pixel. sampling conditions obtain constraints couple intensities \"sub-pixels\" measured coarse pixel intensities. show section sub-pixels always outnumber constraints available detector translation regardless neness oset. words system equations couples sub-pixels coarse pixel measurements always underdetermined unique solution. form additional knowledge system required adequately constrain demonstrate underdetermined nature problem consider one-dimensional binning simplicity suppose wish upsample resolution sub-pixels coarse pixel. here simply pixel binning factor high-energy simulations gure original aperture size pixel size number pixels d/p. periodicity binning grid implies need oset detector sub-pixel positions right order generate unique constraints. oset would simply result redundant constraints. oset left also expressed equivalent oset right periodicity. since interested range reciprocal space dened original aperture discard coarse pixel measurements partially outside region. total number unique constraints therefore constraints come un-translated grid grid osets contribute constraints. hand number sub-pixels coupled constraints numbers generalise higher dimensions straightforward manner thus nite coarse pixel size ensures always less therefore system equations sub-pixels always underdetermined without unique solution unless additional knowledge system incorporated. example non-negativity could enforced sub-pixel intensities. methodology additional information provided fact diracted intensity pattern compact crystal compact support real space. physical insight applies compact single crystals successfully incorporated system equations paves sparse numerical solvers high-energy bcdi. simulations detector oset along diagonals coarse pixels counting possible constraints case straightforward unique detector positions along diagonals even positions along diagonals. cases exactly detector position set) contributes constraints remaining contribute constraints. thus maximum number unique constraints diagonal osets given proof signal sparsity projection-slice theorem states two-dimensional slice three-dimensional fourier transform scalar alternately obtained taking two-dimensional fourier transform projection slicing plane specically patterson function scattering compact single crystal equation quantity measured area detector point rocking curve. computing inverse fourier transform throughout have equation fourier representation single detector image indexed slicing plane planar projection compact patterson function therefore also compact. sparsity two-dimensional fourier transform ensured provision sucient buer region described section main text. thus detector image bragg experiment sparse representation making compressed sensing techniques applicable independently. references robinson vartanyants williams pfeifer pitney reconstruction shapes gold nanocrystals using coherent x-ray diraction. phys. rev. lett. https//link.aps.org/ doi/./physrevlett... ./physrevlett... ulvestad topological defect dynamics operando battery nanoparticles. sci. three dimensional variable-wavelength x-ray bragg coherent diraction imaging. phys. rev. lett. http//link.aps.org/doi/./physrevlett... ./physrevlett... bernier barton lienert miller far-eld high-energy diraction microscopy tool intergranular orientation strain analysis. strain analysis eng. des. http//dx.doi. org/./. http//dx.doi.org/./ ludwig schmidt lauridsen poulsen x-ray diraction contrast tomography novel technique three-dimensional grain mapping polycrystals. direct beam case. appl. crystallogr. https//doi.org/./s. ./s. chushkin zontone upsampling speckle patterns coherent x-ray diraction imaging. appl. crystallogr. https//doi.org/./s. ./s. candes romberg robust uncertainty principles exact signal reconstruction highly incomplete donoho compressed sensing. ieee transactions inf. theory ./tit... goodman introduction fourier optics. mcgraw-hill physical quantum electronics series shannon communication presence noise. proc. ./jrproc... suykens lukas vandewalle sparse approximation using least squares support vector machines. circuits systems proceedings. iscas geneva. ieee international symposium vol. candès eldar needell randall compressed sensing coherent redundant dictionaries. appl. comput. harmon. analysis http//www.sciencedirect.com/science/ article/pii/s. http//dx.doi.org/./j.acha.... tibshirani regression shrinkage selection lasso. royal stat. soc. ser. chapman high-resolution initio three-dimensional x-ray diraction microscopy. opt. soc. http//josaa.osa.org/abstract.cfm?uri=josaa---. ./josaa... invited article unied evaluation iterative projection algorithms phase retrieval. rev. sci. instruments http//dx.doi.org/./.. ./.. http//dx.doi.org/./.. bracewell numerical transforms. sci. http//science.sciencemag.org/ content///. ./science.... http//science.sciencemag.org/ content///.full.pdf.", "year": "2017"}