{"title": "Segmentation of the Proximal Femur from MR Images using Deep  Convolutional Neural Networks", "tag": ["cs.CV", "cs.LG", "stat.ML"], "abstract": "Magnetic resonance imaging (MRI) has been proposed as a complimentary method to measure bone quality and assess fracture risk. However, manual segmentation of MR images of bone is time-consuming, limiting the use of MRI measurements in the clinical practice. The purpose of this paper is to present an automatic proximal femur segmentation method that is based on deep convolutional neural networks (CNNs). This study had institutional review board approval and written informed consent was obtained from all subjects. A dataset of volumetric structural MR images of the proximal femur from 86 subject were manually-segmented by an expert. We performed experiments by training two different CNN architectures with multiple number of initial feature maps and layers, and tested their segmentation performance against the gold standard of manual segmentations using four-fold cross-validation. Automatic segmentation of the proximal femur achieved a high dice similarity score of 0.94$\\pm$0.05 with precision = 0.95$\\pm$0.02, and recall = 0.94$\\pm$0.08 using a CNN architecture based on 3D convolution exceeding the performance of 2D CNNs. The high segmentation accuracy provided by CNNs has the potential to help bring the use of structural MRI measurements of bone quality into clinical practice for management of osteoporosis.", "text": "segmentation proximal femur images using deep convolutional neural networks deniz* siyuan xiang spencer hallyburton arakua welbeck stephen honig kyunghyun gregory chang department radiology york university school medicine york bernard irene schwartz center biomedical imaging york university school medicine center data science york university york harvard college cambridge osteoporosis center hospital joint diseases york university langone medical center york courant institute mathematical science york university york *cem.deniznyumc.org magnetic resonance imaging proposed complimentary method measure bone quality assess fracture risk. however manual segmentation images bone time-consuming limiting measurements clinical practice. purpose paper present automatic proximal femur segmentation method based deep convolutional neural networks study institutional review board approval written informed consent obtained subjects. dataset volumetric structural images proximal femur subject manually-segmented expert. performed experiments training different architectures multiple number initial feature maps layers tested segmentation performance gold standard manual segmentations using four-fold cross-validation. automatic segmentation proximal femur achieved high dice similarity score precision recall using architecture based convolution exceeding performance cnns. high segmentation accuracy provided cnns potential help bring structural measurements bone quality clinical practice management osteoporosis. osteoporosis public health problem characterized increased fracture risk secondary bone mass microarchitectural deterioration bone tissue. fractures serious consequences requiring hospitalization major surgery almost cases. early diagnosis treatment osteoporosis plays important role preventing osteoporotic fracture. bone mass bone mineral content currently assessed commonly dual-energy x-ray absorptiometry years cross-sectional imaging methods quantitative computed tomography magnetic resonance imaging shown provide useful additional clinical information beyond secondary ability image bone provide metrics bone structure quality. successfully performed vivo structural imaging trabecular bone architecture within proximal femur–. provides direct detection trabecular architecture taking advantage signal difference bone marrow trabecular bone tissue itself. osteoporosis related fracture risk assessment using images requires image analysis methods extract information trabecular bone using structural markers topology orientation trabecular networks– using ﬁnite element modeling–. bone quality metrics derived analysis images shown correlate high resolution imaging reveal different information bone quality provided dxa. technical developments overlay signiﬁcance image analysis tools determine osteoporosis related fracture risk. initial studies assessment bone quality proximal femur focused quantiﬁcation parameters within speciﬁc regions interest femoral neck femoral head ward’s triangle extracting fracture risk relevant parameters. recently investigation whole proximal femur proposed assess mechanical properties strength whole proximal femur rather subregion–. latter however requires manual segmentation whole proximal femur images expert. given large number slices single subject acquired scan session time-consuming manual segmentation proximal femur hinder practical based fracture risk assessment. addition manual segmentation subject inter-rater variability. automatic segmentation whole proximal femur would help overcome challenges. previous studies hybrid image segmentation approaches including thresholding morphological operations well statistical shape models deformable models used segment proximal femur images. approaches developed automated segmentation frameworks based sophisticated algorithms. even though frameworks achieve sensitivities limited time required obtain proximal femur segmentations robustness large variation femur shapes. convolutional neural networks revolutionized image recognition speech recognition natural language processing. deep cnns recently successfully used medical research image segmentation– computer aided diagnosis–. contrast previous approaches segmentation rely development hand-crafted features deep cnns learn increasingly complex features data automatically. ﬁrst applications cnns medical image segmentation used pyramidal architectures based information local regions around voxel input predict whether central voxel input patch belongs foreground not. study using structural mris hallyburton used pyramidal architectures segmenting proximal femur achieve moderate segmentation results. approaches limited size receptive ﬁeld networks time required training inference especially volumetric datasets. developments image segmentation using fully convolutional network architectures emerged resulting accurate pixel-wise segmentations–. networks used encoder-decoder type architectures role decoder network project resolution encoder feature maps high resolution feature maps pixel-wise classiﬁcation. encoder-decoder based architectures recently used extensively biomedical ﬁeld providing accurate image segmentation–. work propose investigate different architectures based u-net extension u-net compare performance automatic segmentation proximal femur images reference standard expert manual segmentation. comparison performance various architectures used automatic segmentation biomedical images–. study different supervised deep architectures based convolution convolution used evaluated automatic proximal femur segmentation images. overview proposed approach automatic segmentation proximal femur presented figure receiver operating characteristics precision-recall curve analysis modeled cnns dataset presented figure using mean curves -fold cross-validation. initial feature maps layers contracting/expanding paths outperformed cnns area curve area curve .±.. model achieved highest accuracy segmentation proximal femur exceeded performance cnns achieved =.±.. optimal threshold applied segmentation probability maps calculate binary segmentation mask. post-processing also applied segmentation mask. initial feature maps layers resulted highest precision recall .±.. analysis performance metrics individual subjects illustrated figure table applying post-processing segmentation results improved overall accuracy segmentation masks indicated increase average indicated figure post-processing improves precision cnns; however average recall affected post-processing signiﬁcantly. segmentation accuracy segmentation results subjects shown figure proximal femur bone probability includes misclassiﬁed regions part proximal femur removing small clusters misclassiﬁed bone regions post-processing clearly improved segmentation accuracy results well-connected proximal femur however still misclassiﬁed locations remain e.g. bottom part proximal femur. contrast automatically captures global connectivity proximal femur training. results better delineation proximal femur trabecular bone probability provides segmentation mask resembling ground truth higher accuracy. this opposed doesn’t require additional post-processing step. computational efﬁciency training epoch takes approximately minutes minutes respectively. total time required inference segmentation data subject central coronal slices approximately seconds seconds respectively. increase inference time cnns multiple patches calculating segmentation mask full ﬁeld view. discussion present deep automatic proximal femur segmentation structural images. automatic segmentation results indicate requirement expert knowledge location speciﬁcations training/time segmentation proximal femur avoided using cnns. deep automatic segmentation help bringing proximal femur measurements closer clinical practice given manual segmentation images require approximately hours effort high resolution volumetric datasets. cnn-based automatic segmentation images performed brain including brain tumors microbleeds skull stripping brain extraction. cnn-based automatic segmentation also used pancreas knee recent years automated segmentation proximal femur images using begin emerge workshops conferences. results conﬁrm previous results extends adding value aspects increased number subjects analysis architectures using convolution concept automated segmentation proximal femur images. future expect number imaging applications cnns rapidly increase especially given publicly available software libraries tensorﬂow create cnns algorithm executed commercially available desktop computers. implementation segmentation algorithms used convolutional kernels ﬁrst approach could reasons misclassiﬁed bone regions. even though information consecutive slices incorporated model training global connectivity proximal femur modeled properly using convolutions alone. although used post-processing prevent misclassiﬁed small regions cnns approach using convolutional kernels resulted better segmentation masks directly modeling connectivity proximal femur training. avoiding post-processing step automatic segmentation algorithm crucial segmentation tasks identify multiple regions. cnns convolutional networks computationally demanding result higher overﬁtting increased number weights train. experiments used validation error early stopping criteria overcome successfully possible overﬁtting. similar original u-net paper mirrored images used inference calculating probability voxel part proximal femur. resulted inferencing multiple patches covering image averaging probability calculate output segmentation mask. mirrored images also used training removes necessity multiple calculations averaging inference. however increase input size network result increased training time higher memory requirement. hand using mirrored images modeling reduce time required inference post-processing cnns unpadded convolution. cnns padded convolutions instead unpadded ones done used obtain segmentation outputs size input images. remove necessity extracting multiple patches calculating multiple segmentation probability maps averaging inference. study limitations. first dataset consisted subjects. future larger dataset expect performance cnns improve. second even though implemented multiple cnns different number feature maps layers automatic advanced hyperparameter optimization training parameters implemented current study. future optimization learning rate number initial feature maps performed. expect misclassiﬁed proximal femur bone regions mitigated; network architectures optimization provide superior segmentation results. third image segmentation fast growing ﬁeld architectures approaches presented year. limited architectures demonstrated work cover current fundamental architectures variants used extensively biomedical image segmentation. comparing results recent architectural developments using different loss functions instead weighted cross-entropy beyond scope work. conclusion compared major architectures increasingly used biomedical image segmentation. experiments demonstrated improved performance obtained using convolutions automatic segmentation proximal femur. automatic segmentation using cnns potential help bringing structural measurements clinical practice. methods convolutional neural networks ﬁrst approach uses so-called u-net architecture built upon fully convolutional network u-net architecture network uses larger images input starts contracting path similar conventional pyramidal architectures. pooling operation followed convolutional layers twice many feature maps. contracting path network starts expand less symmetric contracting path cropping copying contracting path. yields u-shaped architecture output trabecular bone probability center area input image. size center area depends number layers contracting/expanding paths. second approach extension three dimensions volumetric segmentation using three-dimensional convolution up-convolution max-pooling layers. padded convolutions opposed unpadded ones proposed order provide trabecular probability whole image output. cnns horizontal ﬂipping data augmentation since dataset contained images subjects scanned either right left hip. initialization convolution kernel weights known important achieve convergence. experiments so-called xavier weight initialization method. xavier initializer designed keep scale gradients roughly layers. prevents vanishing gradient enabling effective learning. proposed original u-net article unpadded convolutions max-pooling operations stride gradually decrease size feature maps. expanding path upsampling feature size followed unpadded up-convolution halves number feature maps. padded convolutions up-convolutions max-pooling stride used contrast unpadded operations proposed and. padded operations enable size output trabecular bone mask equal input image size. removes requirement using mirrored images inference. non-linearly transforming data within layer rectiﬁer linear unit used activation function. relu deﬁned max. last layer softmax compute conditional distribution voxel label. output softmax layer used deﬁne loss function aims minimize error ground truth automatic segmentation training. implementation loss function deﬁned negative logprobability target label expert manually-segmented image. medical images anatomical structure interest usually occupies small portion image. potentially biases prediction towards background constitutes large portion images. overcome imbalanced class problem re-weighted loss function training. achieve incorporating number proximal femur background voxels loss value error voxels belonging trabecular bone given importance tensorﬂow software library implement cnns. minimization loss function adaptive moment estimation parameters used training cnns outlined table perform experiments server using nvidia tesla card. used three consecutive slices segmentation mask center slice order capture connectivity information network architecture. inference post-processing predict segmentation voxels border region images extrapolate missing content mirroring input image inference experiments cnns. probability voxel trabecular bone calculated using multiple batches covers voxel center area patch. reason inference multiple patches voxel average probability voxel calculate probability voxel trabecular bone. total divide mirrored image patches cover full mirrored image ordered overlap. cnns mirroring images required selection padded convolutions network architecture. perform basic post-processing segmentation results cnns remove small clusters misclassiﬁed bone regions. since trabecular bone forms connected volume covers number voxels output volumetric constraints imposed removing clusters volumes smaller maximum volume connected labels. label corresponding maximum connected volume within segmentation mask represents proximal femur. approach successfully removes small clusters misclassiﬁed proximal femur inference. since using convolution capable capturing connectivity information trabecular bone accurately post-processing step required experiments based cnns. dataset study institutional review board approval york university school medicine written informed consent obtained subjects. study performed accordance regulatory ethical guidelines protection human subjects national institutes health. images obtained using commercial scanner -element radiofrequency coil setup high resolution proximal femur microarchitecture t-weighted fast angle shot images acquired following parameters tr/te= angle in-plane voxel size section thickness matrix size number coronal sections acquisition time minutes seconds; bandwidth hz/pixel. high resolution acquisitions required resolving bone microarchitecture fundamental accurate osteoporosis characterization. using imaging protocol postmenopausal women scanned. segmentation proximal femur achieved manual selection periosteal border bone images expert guidance musculoskeletal radiologist. resulted regions deﬁned trabecular bone proximal femur background. central coronal slices used segmentation tasks covering proximal femur reducing size input image especially cnn. memory limitations card resampled slice images using bicubic spline interpolation used initial feature maps cnn. analysis segmentation results performed original hand-segmented proximal femur masks. model selection four-fold cross-validation performed assess performance different architectures. stratiﬁed random sampling used partition sample four disjoint groups. ﬁrst groups subjects each groups patients each. four groups serves validation assess accuracy prediction model obtained three groups combined training set. four separate segmentation models derived model applied segment proximal femur validation data independent ones used derive model. training cnns early stopping order prevent over-ﬁtting enable fair comparison different architectures. training stopped accuracy validation improve within last epochs. first epochs trained without early stopping. evaluation manual segmentations proximal femur used ground truth evaluate different structures. deﬁne voxels within proximal femur background voxels positive negative outcomes respectively.the performance cnns evaluated using analysis sensitivity/recall precision. metric also known f-score measures similarity/overlap manual automatic segmentations. metric widely used metric validating medical volume segmentations deﬁned detected number true positives false positives false negatives respectively. sensitivity/recall measures portion proximal femur bone voxels ground truth also identiﬁed proximal femur bone voxel automatic segmentation. sensitivity/recall deﬁned similarly speciﬁcity measures portion background voxels ground truth also identiﬁed background voxel automatic segmentation. speciﬁcity deﬁned lastly precision also known positive predictive value measures proportion trabecular bone voxels ground truth voxels identiﬁed trabecular bone automatic segmentation. deﬁned curve analysis provides means evaluating performance automatic segmentation algorithms selecting suitable decision threshold. area measure classiﬁer’s performance comparing different cnns. output deﬁnes probability voxel belonging within proximal femur. using analysis optimal threshold selected distinguish proximal femur bone voxels background comparing performance cnns. optimal operating point selected choosing point smallest euclidean distance maximum precision recall. voxels higher probabilities selected threshold predicted belonging within proximal femur rest background. references genant noninvasive assessment bone mineral structure state art. bone mineral research ofﬁcial journal soc. bone miner. res. http//www.ncbi.nlm.nih.gov/ pubmed/. ./jbmr.. trabecular microfractures femoral head osteoporosis analysis microcallus formations synchrotron radiation micro bone http//www.sciencedirect.com/science/article/ pii/s. ./j.bone.... chiba burghardt osaki majumdar heterogeneity bone microstructure femoral head patients osteoporosis vivo hr-pqct study. bone http//www.ncbi.nlm.nih. gov/pubmed/. ./j.bone.... bousson volumetric quantitative computed tomography proximal femur relationships linking geometric densitometric variables bone strength. role compact bone. osteoporos. int. http//dx.doi.org/./s---. ./s---. nagarajan characterizing trabecular bone structure assessing vertebral fracture risk volumetric quantitative computed tomography. proc spie med. imaging http//proceedings. spiedigitallibrary.org/proceeding.aspx?doi=./.. ./.. boutroy bouxsein munoz delmas vivo assessment trabecular bone microarchitecture high-resolution peripheral quantitative computed tomography. clin. endocrinol. metab. https//academic.oup.com/jcem/article-lookup/doi/./jc.-. ./jc.-. kazakia vivo determination bone structure postmenopausal women comparison hr-pqct high-field imaging. bone miner. res. http//doi.wiley.com/./ jbmr.. ./jbmr.. muller hildebrand ruegsegger non-invasive bone biopsy method analyse display three-dimensional structure trabecular bone. phys. medicine biol. http//stacks. iop.org/-//i=/a=?key=crossref.cabfeffeeabebb. ./-///. majumdar trabecular bone architecture distal radius using magnetic resonance imaging subjects fractures proximal femur. osteoporos http//dx.doi.org/./ wehrli cancellous bone volume structure forearm noninvasive assessment microimaging image processing. radiol. http//radiology.rsna.org/content/// .abstract. krug feasibility vivo structural analysis high-resolution magnetic resonance images proximal femur. osteoporos. international journal established result cooperation eur. foundation osteoporos. natl. osteoporos. foundation http//www.ncbi.nlm.nih.gov/pubmed/. ./s---. chiba banerjee carballido-gamio krug variable angle three-dimensional fast spin-echo sequence combined outer volume suppression imaging trabecular bone structure proximal femur. magn. reson. imaging http//doi.wiley.com/./jmri.. ./jmri.. chang finite element analysis applied imaging proximal femur microarchitecture lower bone strength patients fragility fractures compared control subjects. radiol. ./radiol.. hildebrand laib m¨uller dequeker r¨uegsegger direct three-dimensional morphometric analj. bone ysis human cancellous bone microstructural data spine femur iliac crest calcaneus. miner. res. http//doi.wiley.com/./jbmr..... ./jbmr..... ladinsky trabecular structure quantiﬁed mri-based virtual bone biopsy postmenopausal women contributes vertebral deformity burden independent areal vertebral bmd. bone mineral research ofﬁcial journal soc. bone miner. res. http//www.pubmedcentral.nih.gov/articlerender. fcgi?artid={&}tool=pmcentrez{&}rendertype=abstract. ./jbmr.. gomberg saha kwon song hwang wehrli topological analysis trabecular bone images. ieee transactions med. imaging http//ieeexplore.ieee.org/lpdocs/epic/ wrapper.htm?arnumber=. ./.. rajapakse micro-mr imaging-based computational biomechanics demonstrates reduction cortical trabecular bone strength renal transplantation. radiol. http//www.ncbi.nlm. nih.gov/pmc/articles/pmc/pdf/.pdf. ./radiol.. macneil boyd bone strength distal radius estimated high-resolution peripheral quantitative computed tomography ﬁnite element method. bone http//linkinghub. elsevier.com/retrieve/pii/s. ./j.bone.... orwoll finite element analysis proximal femur fracture risk older men. bone miner. res. http//doi.wiley.com/./jbmr.. ./jbmr.. chang measurement reproducibility magnetic resonance imaging-based ﬁnite element analysis proximal femur microarchitecture vivo assessment bone strength. magma http//www.ncbi.nlm.nih.gov/pubmed/. ./s---y. rajapakse patient-speciﬁc fracture strength assessment microstructural imaging–based finite element modeling. radiol. http//pubs.rsna.org/doi/./radiol. ./radiol.. carballido-gamio structural patterns proximal femur relation fracture risk women. bone http//linkinghub.elsevier.com/retrieve/pii/s. ./j.bone.... zorooﬁ segmentation avascular necrosis femoral head using images. comput. medical imaging graphics ofﬁcial journal comput. med. imaging soc. http//www.ncbi.nlm. nih.gov/pubmed/. schmid magnenat-thalmann robust statistical shape models bone segmentation presence small ﬁeld view. med. image analysis http//dx.doi.org/./j.media. ./j.media.... schmid magnenat-thalmann bone segmentation using deformable models shape priors. metaxas axel fichtinger sz´ekely medical image computing computer-assisted intervention miccai international conference york september proceedings part https//doi.org/./----{_}. ./---- arezoomand w.-s. rakhra beaul´e active model framework segmentation proximal femur images. int. comput. assist. radiol. surg. http//link.springer.com/ ./s---. ./s---. pereira pinto alves silva brain tumor segmentation using convolutional neural networks images. ieee transactions med. imaging http//ieeexplore.ieee.org/ document//. ./tmi... roth deeporgan multi-level deep convolutional networks automated pancreas segmentation vol. lecture notes computer science http//link. springer.com/./----. roth representation lymph node detection using random sets deep convolutional neural network observations. medical image computing computer-assisted intervention–miccai http//link.springer.com/./----{_}. ./--- arxiv.v. uniﬁed framework automatic wound segmentation analysis deep convo annu. int. conf. ieee eng. medicine biol. soc. lutional neural networks. http//ieeexplore.ieee.org/lpdocs/epic/wrapper.htm?arnumber=. ./embc... multi-instance deep learning discover discriminative local anatomies bodypart recognition. ieee transactions med. imaging http//ieeexplore.ieee.org/lpdocs/epic/ wrapper.htm?arnumber=. ./tmi... ciresan giusti gambardella schmidhuber deep neural networks segment neuronal membranes electron microscopy images. nips https//papers.nips.cc/paper/ -deep-neural-networks-segment-neuronal-membranes-in-electron-microscopy-images. pdf. zhang deep convolutional neural networks multi-modality isointense infant brain image segmentation. neuroimage http//dx.doi.org/./j.neuroimage.... ./j.neuroimage.... nihms. automatic detection cerebral microbleeds images convolutional neural networks. ieee transactions med. imaging http//ieeexplore.ieee.org/document/ ./tmi... kleesiek deep brain extraction convolutional neural network skull stripping. neuroimage http//dx.doi.org/./j.neuroimage.... ./j.neuroimage.... para¨ıso position-squared coupling tunable photonic crystal optomechanical cavity. phys. rev. https//link.aps.org/doi/./physrevx... ./physrevx... hong learning deconvolution network semantic segmentation. ieee international conference computer vision vol. inter http//ieeexplore.ieee. org/document//. ./iccv... ronneberger fischer brox u-net convolutional networks biomedical image segmentation. med. image computing computer-assisted intervention miccai int. conf. med. image comput. comput. interv. http//arxiv.org/abs/.. ./----. christ automatic liver lesion segmentation using cascaded fully convolutional neural networks conditional random fields. proceedings international conference medical image computing computer assisted intervention http//arxiv.org/abs/.. ./---- deep convolutional neural network deformable approach tissue segmentation musculoskeletal magnetic resonance imaging. magn. reson. medicine http//dx.doi.org/./ mrm.. ./mrm.. wachinger reuter klein deepnat deep convolutional neural network segmenting neuroanatomy. neuroimage http//linkinghub.elsevier.com/retrieve/pii/s. ./j.neuroimage.... zeng u-net multi-level deep supervision fully automatic segmentation proximal femur images. wang h.-i. suzuki machine learning medical imaging brosch deep convolutional encoder networks shortcuts multiscale feature integration applied multiple sclerosis lesion segmentation. ieee transactions med. imaging http //ieeexplore.ieee.org/document//. ./tmi... imagenet classiﬁcation deep convolutional neural netpereira burges bottou weinberger advances neural information works. processing systems http//papers.nips.cc/paper/ -imagenet-classification-with-deep-convolutional-neural-networks.pdf. bengio simard frasconi learning long-term dependencies gradient descent difﬁcult. ieee transactions neural networks http//ieeexplore.ieee.org/document//. ./.. acknowledgements work supported part performed rubric center advanced imaging innovation research nibib biomedical technology resource center gratefully acknowledge support nvidia corporation donation research. author contributions statement c.m.d. study concept design experiments analysis results manuscript preparation s.x. literature research implementation data analysis literature research data preparation a.w. data acquisition segmentation s.h. study concept patient recruitment k.c. study design manuscript editing data acquisition data segmentation manuscript editing figure overview proposed learning algorithm automatic segmentation proximal femur. training yields automatic proximal segmentation model used model evaluation test dataset. output model probability bone used obtain proximal femur segmentation mask using threshold. table cross-validation results different network architectures segmentation proximal femur. segmentation algorithms including post-processing represented number initial feature maps number layers. figure architecture cnns used paper. blue rectangles represent feature maps size number feature maps indicated. different operations network depicted color-coded arrows. architecture represented contains feature maps ﬁrst last layer network layers contracting/expanding paths. figure precision-recall curve segmentation models. left panel shows receiver operating characteristics curves different cnns modeled work. number initial feature maps layers contracting/expanding paths presented legend area curve right panel shows precisionrecall curves modeled cnns. legend average precision presented comparison different models. figure example results using cnn. proximal femur shown ground truth/hand segmentation mask probability produced presented corresponding segmentation mask post-processing presented probability produced presented corresponding segmentation mask obtained thresholding without post-processing presented arrow indicates location misclassiﬁed cnn. misclassiﬁed regions removed post-processing using proximal femur connectivity size prior information", "year": 2017}