{"title": "An Occluded Stacked Hourglass Approach to Facial Landmark Localization  and Occlusion Estimation", "tag": ["cs.CV", "stat.ML"], "abstract": "A key step to driver safety is to observe the driver's activities with the face being a key step in this process to extracting information such as head pose, blink rate, yawns, talking to passenger which can then help derive higher level information such as distraction, drowsiness, intent, and where they are looking. In the context of driving safety, it is important for the system perform robust estimation under harsh lighting and occlusion but also be able to detect when the occlusion occurs so that information predicted from occluded parts of the face can be taken into account properly. This paper introduces the Occluded Stacked Hourglass, based on the work of original Stacked Hourglass network for body pose joint estimation, which is retrained to process a detected face window and output 68 occlusion heat maps, each corresponding to a facial landmark. Landmark location, occlusion levels and a refined face detection score, to reject false positives, are extracted from these heat maps. Using the facial landmark locations, features such as head pose and eye/mouth openness can be extracted to derive driver attention and activity. The system is evaluated for face detection, head pose, and occlusion estimation on various datasets in the wild, both quantitatively and qualitatively, and shows state-of-the-art results.", "text": "figure proposed facial landmark localization occlusion estimation using occluded stacked hourglass showing non-occluded occluded landmarks. visualization heat maps output network overlaid original image. system warn driver ahead time unseen danger seen noticed minimize probability accident. creating system also paves systems coordinates heads eyes hands systems looks humans inside outside vehicle cabins distraction effort create system stacked hourglass existing deep neural network implementation designed body pose joint estimation modiﬁed take detected face window output occlusion heatmap images facial landmarks used estimate landmark location occlusion. heatmap scores include rich landmark feature information faces also allows reﬁnement original face detection input system allowing system robustly reject false positives part initial detections. main contributions paper heatmap-based facial landmark localization occlusion estimation quantitative evaluation face detection head pose occlusion estimation qualitative evaluation various datasets video sequences showing robust generalization trained model. rest paper follows next section discusses related works face detection landmark localization occlusion estimation main contributions paper. section goes proposed system discussing detail training sample generation data augmentation landmark localization abstract—a step driver safety observe driver’s activities face step process extracting information head pose blink rate yawns talking passenger help derive higher level information distraction drowsiness intent looking. context driving safety important system perform robust estimation harsh lighting occlusion also able detect occlusion occurs information predicted occluded parts face taken account properly. paper introduces occluded stacked hourglass based work original stacked hourglass network body pose joint estimation retrained process detected face window output occlusion heat maps corresponding facial landmark. landmark location occlusion levels reﬁned face detection score reject false positives extracted heat maps. using facial landmark locations features head pose eye/mouth openness extracted derive driver attention activity. system evaluated face detection head pose occlusion estimation various datasets wild quantitatively qualitatively shows state-ofthe-art results. index terms—driver assistance systems distraction invehicle activity monitoring face detection facial landmark localization occlusion estimation found common factors accidents caused distraction drowsiness inattention minimum every year total fatal crashes involving drivers resulted deaths approximately crashes involved distraction. result distraction least injured crashes involving distracted drivers year period least fatalities every year involving drowsy driving minimize events introducing active safety system assist driver monitoring face order give alerts driver paying attention particular surrounding area. tracking landmarks face along information head pose computed provide driver’s facing direction. indicators eyes mouth provide information closure duration blink rates yawning provide information driver’s drowsiness fatigue often people drowsy cover mouths yawning eyes cause occlusion must detected order avoid computing inaccurate measurements driver’s drowsiness even head pose. allows real-time face detection using computationally efﬁcient features multi-stage classiﬁer allowing quickly reject background samples focusing face-like windows later stages. face detection discrete pose estimation landmark estimation modeling facial landmarks parts using global mixtures handle structural changes caused different poses. face detection facial part responses detects multiple different objects improvesdetection accuracy incorporating landmark localization learning. detects faces large visual variations pose expression lighting using cascade reject background regions operating low-resolution space speed performance evaluate higher probability candidates later stages higher resolution. performs landmark localization robustly occlusion also estimating occlusion landmarks. face detection landmark estimation occlusion estimation using hierarchical deformable part model allowing augmented positive samples using synthetic occlusion. robust face detection harsh lighting occlusion exploring advantages disadvantages training augmented samples. robust face detection landmark estimation head pose estimation harsh lighting occlusion using alexnet stacked hourglass networks trained using augmented positive samples synthetic occlusion. facial landmark localization occlusion estimation head pose estimation face detection reﬁnement using occluded stacked hourglass network trained using augmented samples synthetic occlusion. occlusion estimation face detection reﬁnement head pose estimation. section evaluates system face detection head pose estimation challenging dataset found driving well real-world presenting scenarios harsh lighting heavy occlusions face. occlusion estimation evaluated caltech occluded faces wild showing state-of-the-art results improvements previous work occlusion. concluding remarks future direction discussed section section several face detectors facial landmark localizers occlusion estimation works discussed along objective methodologies. early work face analysis domain include viola jones face detector using multi-stage cascade structure computationally inexpensive features detects faces localizes landmarks estimates discrete head pose using deformable part model. robust cascaded pose regression localizes estimates occlusion landmarks using robust shape-indexed features. ghiasi improves al.’s work model formulating hierarchical deformable part model improve landmark localization performance occlusion also estimating occlusion landmark. recent studies face domain deep learning achieved performing results ddfd faceness cascadecnn densebox ddfd ﬁne-tunes alexnet well known structure train face detector generating score image extracting detected faces. faceness multiple dcnn components trained detect individual components face e.g. eyes nose mouth etc. merges individual responses face. cascadecnn achieves faster figure proposed pipeline system using different structures detecting face localizing landmarks estimating occlusion head pose. input pre-processing done histogram equalization passed face detector module. resulting detected faces processed landmark module estimate landmark locations/occlusion reﬁne original face detection output localization score using landmark information. head pose estimated using posit algorithm generic face model selected rigid landmarks indicated dots model. times cascading multiple cnns quickly reject nonface background areas early stages detector less parameters later stages increasing complexity reject difﬁcult false positives. summary related face detection papers shown table past work face detection objective methodolody whether estimated landmarks occlusion. past research done face detection researched landmark localization papers researched occlusion estimation. work builds upon previous papers include occlusion estimation face detection landmark localization. densebox introduced end-to-end framework directly predicting bounding scores showed accuracy improved incorporating landmark localization network. stacked hourglass network dense network used predicting body joint locations given location pedestrian model work mainly based network essentially pools resolution many features upsamples back higher resolution provide heatmap output network fusing features multiple resolutions resulting visually looks like hourglass. placing hourglass modules together forms stacked hourglass network. advantages cascaded modular system ability take existing networks known work well individual modules together able choose smaller quicker networks ﬁrst stage reject false positives entering larger slower networks precise predictions. control precision recall controlled stage outputs well able monitor went wrong middle system. work mainly composed systems following idea viola jones cascadecnn cascading classiﬁers together. ﬁrst stage alexnet face detector following closely work ddfd performs face detection likely face window candidates. stacked hourglass used second stage faceness densebox found success face detection incorporating facial part responses perform expensive analysis candidate face windows generating facial landmark occlusion heatmap images. developing system estimate location occlusion facial landmarks occlusionaware face analysis system possible. work builds previous work trains alexnet detect faces exploring effects augmentating training samples mimic harsh lighting conditions occlusion found driving. another previous work shown fig. stacked hourglass model modiﬁed trained process detected faces output facial landmarks. given idea inputoutput functionality stacked hourglass essentially designed take input image ﬁxed dimension outputs multiple heatmap images speciﬁed training. heatmap image training labels generally designed small gaussian blob amplitude placed location landmark relative input image rest heatmap approximately zero. results heatmap image values roughly range high valued areas indicate high conﬁdence landmark location. paper occluded stacked hourglass presented training label heat stacked hourglass modiﬁed also estimate occlusion facial landmark system tell parts face occluded allowing future face analysis systems robust occlusions occur. network trained following original work stacked hourglass paper face using location estimated landmarks provide better localization face score reﬁned using occlusion conﬁdence information. proposed modiﬁcation landmark module shown fig. vehicle domain driver’s face undergo harsh lighting caused occlusions objects sunglasses hands. important system remains robust situations order continue monitoring driver’s face behavior send signal longer able monitor certain activities occlusion. contribution two-fold augmentation training samples include harsh lighting occlusion examples improve training data imbalance improve robustness system situations augmented occlusion automatically create occlusion training labels allow landmark module simultaneously localize landmarks estimate occlusion. landmark samples combined dataset faces landmark annotations follows multi-pie dataset format. images gathered existing datasets helen lfpw landmark annotations provided challenge negative samples challenge provide annotations every face image aflw used generate negative samples known faces annotated dataset. face samples aflw used landmark training since dataset landmarks annotated. window sampling positive face samples faces head pose roll angle desired training set. accomplish this face image ﬁrst de-rotated face longer tilted done rotating image left-right symmetrical landmark pairs face e.g. mouth corners nose corners corners brow corners form horizontal line close possible. afterwards face randomly rotated angle chosen uniform distribution degrees. since landmarks provided annotated face samples challenge dataset equivalent face computed ﬁtting around annotated landmarks small possible still containing landmarks. annotated ground truth generated extending height include forehead bounding annotations face datasets include portion face. positive training sample face generated randomly shifting resizing retains least ground truth box. negative training samples taken aflw dataset square window less iou. threshold chosen since used train landmark localization i.e. minimize amount facial parts appear negative training though higher values experimented yet. figure proposed landmark module network structure estimating facial landmark occlusion scores reﬁnement face boxes scores improve localization precision. system takes detected face images preprocessed histogram equalization individually channel. images stacked hourglass network hourglasses. resulting landmark score images size landmarks network post-processed using -stage heuristic reﬁnement method extract face landmark locations less since original input detections clustered together face. minor modiﬁcation including occlusion information heatmap ground truth labels. speciﬁcally landmark labeled occluded gaussian blob placed location landmark would amplitude instead reasoning behind location landmark still derived looking magnitude heatmap sign gives indication whether it’s occluded not. training techniques previous paper used apply augmentations include artiﬁcial occlusion data. heuristics applied heatmaps resulting network output extract facial landmarks occlusion estimation. head pose estimated posit algorithm generic face selected rigid landmarks. initial bounding proposal face detector reﬁned generating tighter-bounding around occlusions dataset containing annotated regions objects used artiﬁcially occlude positive face samples training placing random locations face varying sizes. since distribution object types heavily biased towards region/objects wall window ﬂoor etc. danger over-ﬁtting model learn particular object type dataset. resolve this object type ﬁrst randomly selected object category type randomly selected uniform distribution. initial training using dataset issues landmarks marked nonoccluded even though covered hands and/or sunglasses small dataset collected composed hands sunglasses transparency masks already included various sources web. object chosen ﬁrst randomly selecting uniform distribution three datasets e.g. hands sunglasses. object randomly selected within chosen dataset augmented placed positive sample. resource constraints landmarks marked non-occluded artiﬁcially occluded landmarks using method described here marked occluded. expected harm results signiﬁcantly faces training dataset non-occluded upon visual inspection although ideal situation would annotate occluded landmarks original images optimal results trained possible errors ground truth. histogram equalization since domain resides driver cabin harsh lighting occur improvements found applying contrast-limited adaptive histogram equalization luma channel ycrcb space. training test images preprocessed using clahe ensure model working type input order optimize performance. hourglass network outputs score images smaller input image factor positive samples score image gaussian mean scaled location landmark image coordinates standard deviation amplitude gaussian landmark non-occluded landmark occluded landmarks non-face negative sample. motivation setting occluded landmarks value opposed value magnitude score image looks stacked -hourglass network trained using published code provided newell yang deng original authors paper. large powerful design network contains convolutional layer stride pooling layer beginning downsample input factor hourglass repeatedly pools data smaller size upsamples back symmetrical form. hourglass takes advantage recently presented residual learning models shown make networks easier optimize improve accuracy depth using throughout network. details hourglass network residual modules highly recommended read original papers. training network uses hourglass modules features hourglass. batch iteration images randomly chosen either face non-face equal probability randomly uniformly selects image corresponding replacement. learn rate manually adjusted based training results validation data iteration iteration iteration output boxes face detector cropped image hourglass network output score images landmark. predicted landmark locations extracted score images order re-localize detection box. score landmark calculated summed represent reﬁned score detection. initial experiments different localized detections face found agreed location non-occluded landmarks however occluded landmarks agree much. slight noise occlusion estimation across different detections. take care issues noisy landmark localization occlusion estimation averaged summing score images overlapping detections assumption face. landmark locations re-extracted normalized summed score images score landmark computed thresholded determine landmark occluded. steps explained detail below. initial landmark location detected face score images corresponding landmarks visualization shown fig. similar procedure face detector’s testing phase score images used. magnitude score image thresholded value times highest value image connected component labeling applied group clusters pixels together. location landmark calculated weighted centroid group pixels highest value magnitude score image repeated remaining landmarks. locations carefully transformed back score image space resized input face image space ﬁnally back original image coordinate space. detection re-localized based minimum maximum coordinates landmarks extending done training sample generation chapter. landmark scores ideal ground truth image generated placing gaussian predicted location landmark following ground truth sample generation described earlier. score landmark slmi computed computing squared magnitude difference pixels ideal ground truth image using |islmi |islmi corresponds pixel location actual ideal magnitude score image respectively given landmark using scoring equation ideal landmark would score scoring landmark would large negative value. summing individual landmark scores reﬁned face detector score derived using reﬁning landmark location extracting occlusion score looking preliminary results found gaussian always negative would expect occluded landmarks making difﬁcult classify landmark occluded. location occluded landmarks also jittery different detections face compared non-occluded landmarks locations generally agreed. remedy this results averaged together produce better prediction occluded landmark location scores taking advantage observations. using reﬁned detection boxes scores detections clustered together groups applying non-maximum suppression creates list sorting detections descending order score selects highest scoring detection list groups remaining detections list least overlap current detection removes list. overlap values explored detail work. continues detections assigned groups. original unreﬁned detection similar initial landmark locations converted except working score images rather location points. aligned score images summed together process repeated landmarks resulting score images. normalizing number detections group found hurt landmark score used determine occlusion. detections chosen part group little overlap true face likely score image negative sample zeros would lower magnitude landmark score. instead normalizing number detections group maximum absolute value across score images used normalization highest magnitude score images assumption least landmark visible detected well network best scoring landmark given magnitude score rest landmarks scored relatively extract reﬁned landmark locations step initial landmark location subsection applied using landmark score images. value pixel corresponding score image reﬁned landmark location used landmark occlusion score. head pose estimation landmarks using rigid landmark locations selected generic face model along corresponding estimated landmark positions head pose estimated posit algorithm rigid landmarks corners nose nose corners chin. non-rigid landmarks mouth corners move person talking yawning used pose estimation would deform generic face model much more. currently occlusion estimation disregard occluded landmarks used head pose estimation explored yet. evaluation face detection reﬁnement head pose estimation performed viva-face dataset test dataset challenge featuring large range lighting conditions occlusions various objects hand activities. dataset contains total faces total images selected challenging situation daytime naturalistic driving data video sequences coming data recorded lisa-ucsd vehicles well youtube videos face detection evaluated using standard pascal overlap precision-recall curve shown fig. methods boosted cascade haar boosted cascade mixture tree structure shown baseline comparison. face detectors trained occlusion estimation evaluated using cofw test dataset. dataset contains faces large variations pose expression average occlusion face landmarks annotated indicating location whether landmark occluded. evaluation results shown fig. showing signiﬁcant improvement across recall values comparison robust cascaded pose regression burgosartizzu hierarchical deformable part model ghiasi ideally occlusion score threshold around since ground truth generated setting non-occluded occluded landmark samples score respectively training process. however practice positive score landmark also corresponds network high conﬁdence detection localization landmark caused form occlusion. found threshold found work better. resulting higher recall small cost precision. comparison images cofw dataset method ghiasi burgos-artizzu shown figure method shows out-perform methods parts landmark localization occlusion estimation. landmark localization still improved particular areas heavy occlusion areas images rows mask large camera blocking large percentage face. fig. shows system robust datasets viva-face fddb also proving generalizable even statues drawings faces. system shown able handle predict occlusions caused hands shoulders various objects well harsh light washes features face point would considered occluded. previous work based alexnet face detection module. evaluating proposed system improvement found concatenating outputs previously trained face detectors similarly done ensemble methods improve recall rate. curves show combination face detectors improved recall secondstage reﬁnement face detection done landmark module precision signiﬁcantly boosted particularly higher recall regions combination improvement face bounding localization false positive rejection using landmark data. head pose estimation estimation system evaluated viva-face dataset. yaw-angle evaluations head pose shown described table showing detection rate face success rate estimating within degrees mean standard deviation absolute error. system able achieve high detection rate least estimate angle head pose average error least reasonable standard deviation leading success rate able estimate head pose within ground truth. table evaluation results benchmark submissions angle estimation head pose. detection rate percentage images face detector able detect face least overlap ground truth face. success rate percentage correctly detected faces estimated angle within degrees annotation. mean standard deviation absolute error respectively calculated correctly detected faces. deploying video analysis tool background subtraction tracking face detection landmark head pose stages considered order reduce false positives increase robustness system exploiting temporal consistency. paper framework proposed detect face high recall rates using alexnet processing detected faces estimating landmark location occlusion using stacked hourglass network subsequently reestimating score detection high precision rate ﬁnally using landmarks estimate head pose. shown results high precision recall rate face detection along high success rate estimating head pose. paper also introduced occluded stacked hourglass method train stacked hourglass model occlusion information embedded heat maps labels able successfully outperform previous state-of-the-art methods estimating facial landmark occlusion information. using information occlusion occurred driver’s face allows future head mouth algorithms become robust case objects sunlight occlude related facial parts. current issue stacked hourglass module trained handle proﬁle faces. head turned away camera half face visible landmark module issues estimating location missing landmark. -landmark training data used composed faces landmarks occluded selfocclusion. issue planned resolved future work training separate model proﬁle-view fewer points -proﬁle/-frontal landmarks annotated cmu-multipie dataset newly released menpo dataset introduced system allows future research development future higher level facial analysis driver’s state focus distraction drowsiness emotions gaze zone estimation social activities involving face. authors would like specially thank sujitha martin reviewers helpful suggestions towards improving work. authors would also like thank sponsors colleagues computer vision robotics research laboratory assistance. figure example outputs occluded stacked hourglass model applied cofw dataset shown columns column shows resulting landmark heat maps showing non-occluded occluded landmarks. column shows reﬁned face detection estimated non-occluded landmarks occluded landmarks head pose. columns show results ghiasi burgos-artizzu respectively using publicly available code. viva-face dataset contains images drivers many different camera views temporal relation between images. however results image frames video clips processed individually shown fig. showing landmarks compute opening used detecting blinks driver looking down. ﬁgure head pose angle provides driver facing towards. fig. shows mouth landmarks compute mouth opening detect driver yawns. portion shows occlusion driver naturally covers mouth hand yawning. note y-axis values normalized based minimum maximum observed values drives. ghiasi fowlkes occlusion coherence localizing occluded faces hierarchical deformable part model proceedings ieee conference computer vision pattern recognition yuen martin trivedi looking faces automobile issues algorithms evaluation naturalistic driving dataset international conference pattern recognition ieee hirayama mase miyajima takeda classiﬁcation driver’s neutral cognitive distraction states based peripheral vehicle behavior driver’s gaze transition ieee transactions intelligent vehicles vol. martin tawari murphy-chutorian cheng trivedi design evaluation robust head pose visual user interfaces algorithms databases comparisons proceedings international conference automotive user interfaces interactive vehicular applications. belhumeur jacobs kriegman kumar localizing parts faces using consensus exemplars pattern analysis machine intelligence ieee transactions vol. sagonas tzimiropoulos zafeiriou pantic semiautomatic methodology facial landmark annotation proceedings ieee conference computer vision pattern recognition workshops martin yuen trivedi vision intelligent vehicles applications face detection head pose challenge ieee intelligent vehicles symposium ieee doll´ar appel belongie perona fast feature pyramids object detection pattern analysis machine intelligence ieee transactions kevan yuen received b.s. m.s. degrees electrical computer engineering university california diego jolla. graduate studies computer vision robotics research laboratory university california diego. currently pursuing ﬁeld advanced driver assistance systems deep learning laboratory intelligent safe automobiles ucsd. mohan manubhai trivedi distinguished professor founding director ucsd lisa laboratory intelligent safe automobiles winner ieee itss lead institution award currently trivedi team pursuing research distributed video arrays active vision human body modeling activity analysis intelligent driver assistance active safety systems automobiles. trivedis team played roles several major research initiatives. include developing autonomous robotic team shinkansen tracks human-centered vehicle collision avoidance system vision based passenger protection system smart airbag deployment lane/turn/merge intent prediction modules advanced driver assistance. professional awards received include ieee societys highest honor outstanding research award pioneer award meritorious service award ieee computer society distinguished alumni award utah state university. three students awarded best dissertation awards professional societies number papers best honorable mention awards international conferences. trivedi fellow ieee iapr spie. trivedi regularly serves consultant industry government agencies u.s. europe asia. figure example outputs occluded stacked hourglass model applied viva-face dataset fddb showing reﬁned face detection estimated non-occluded landmarks occluded landmarks head pose. figure proposed system applied videos driver’s face. left sequence shows analysis driver’s landmarks around eyes computes opening driver’s opened blinking looking speedometer right sequence shows driver’s head pose angle driver’s head facing straight ahead looking left looking right indicates scores landmarks used head pose estimation meet required threshold. figure example application another video sequence driver yawning. mouth opening graph computed area enclosed inner mouth landmarks. driver’s mouth shown closed slowly opens shows occluded landmarks caused hand covering mouth. line graph indicates mouth occluded computed based certain threshold landmarks estimated occluded area mouth. finally shows driver’s mouth longer occluded closed. video demonstration occluded stacked hourglass shown here http//cvrr.ucsd.edu/kcyuen/occluded stacked hourglass/", "year": 2018}