{"title": "Adaptive Smoothing in fMRI Data Processing Neural Networks", "tag": ["cs.CV", "stat.ML"], "abstract": "Functional Magnetic Resonance Imaging (fMRI) relies on multi-step data processing pipelines to accurately determine brain activity; among them, the crucial step of spatial smoothing. These pipelines are commonly suboptimal, given the local optimisation strategy they use, treating each step in isolation. With the advent of new tools for deep learning, recent work has proposed to turn these pipelines into end-to-end learning networks. This change of paradigm offers new avenues to improvement as it allows for a global optimisation. The current work aims at benefitting from this paradigm shift by defining a smoothing step as a layer in these networks able to adaptively modulate the degree of smoothing required by each brain volume to better accomplish a given data analysis task. The viability is evaluated on real fMRI data where subjects did alternate between left and right finger tapping tasks.", "text": "abstract—functional magnetic resonance imaging relies multi-step data processing pipelines accurately determine brain activity; among them crucial step spatial smoothing. pipelines commonly suboptimal given local optimisation strategy treating step isolation. advent tools deep learning recent work proposed turn pipelines end-to-end learning networks. change paradigm offers avenues improvement allows global optimisation. current work aims beneﬁtting paradigm shift deﬁning smoothing step layer networks able adaptively modulate degree smoothing required brain volume better accomplish given data analysis task. viability evaluated real fmri data subjects alternate left right ﬁnger tapping tasks. non-invasive functional magnetic resonance imaging techniques determining brain activity requires data processing steps transforms data validated elements suitable statistical analysis. intensities important preprocessing step. spatial smoothing serves several purposes local averaging reduces uncorrelated random noise voxel hence increasing signal-to-noise ratio leading improved statistical power detect true functional brain activation; also spatial smoothing serves eliminate unimportant anatomical details across subjects preserved despite afﬁne non-linear transformations common spatial normalisation steps pipeline; additionally smoothing ensure assumptions typically made enable multiple comparison correction using random field theory locating brain activation fulﬁlled. resolution brain volume decreased applying smoothing step meaning appropriate trade-off original volume degree smoothing applied sought. compromise governed single parameter stating width gaussian ﬁlter. spite importance parameter established method automatically select appropriate value every situation often according best practices relying scientist’s expertise. previous attempts build system capable adaptively smoothing brain volumes fmri include deﬁnes bayesian approach general linear model able determine optimal amount smoothing regressor; smooth resulting statistical ----//. ieee parametric maps instead input volumes providing appropriate activation threshold based spatial correlation; uses non-stationary spatial gaussian markov random ﬁelds allowing spatial extent smoothing vary across space time. recent work proposes change paradigm converting fmri data processing pipelines deep neural networks purpose optimising pipelines end-toend instead current state optimises locally step pipeline. study authors propose generalisation spatial transformer networks building blocks fmri data processing neural networks. current study aforementioned architecture build module able adaptively select appropriate degree smoothing volume data analysis task allowing vary across time. sharp contrast previous work ﬁeld normally using preselected static smoothing dynamic component within glm. contrast previous work explicitly consider main goals spatial smoothing designing training network. provided solution used standalone module regular fmri pipelines part fmri data processing neural networks. rest document structured follows section deﬁnes architecture system provides accurate implementation details evaluate performance real fmri brain data section subjects instructed simple ﬁnger tapping tasks. finally provide concluding remarks future research directions. following architecture proposed learnt using neural network made subnetworks transformation network smooths input volumes convolving gaussian ﬁlter parameterised according values provided parameters network calculates adequate ﬁlter size current volume. next describe system depicted fig. detail. omitting origin important parameter gaussian ﬁlter calculated using parameters network. network implemented conventional feed forward neural network ﬁnal regressor outputting value volume. precisely ﬁrst layer network centring layer provided reference volume subtracted brain volumes. rationale using external reference multiple explanations. first resulting network learns account relative deviations volume reference template appropriate study). secondly given high dimensionality data domain unlikely volumes study loaded memory processed time external volume eases task keeping global reference. second layer maxpooling module purpose quantifying average noise level volume. deﬁnition centring data average voxel intensity volume lays roughly around max-pooling layer keeps highest value neighbourhood effectively increasing average voxel intensity noise present out-of-training sets. effect multiplying factor value outputted network. ﬁnal layer fully-connected layer single output neuron softplus activation function ensuring non-negativity. order train current module explicitly encode goal reducing inter-subject anatomical variability objective function. particular seek minimise variability smoothing individual volumes penalising deviation original volume. ﬁnal loss computed overcome limitation small sample size usually available domain reduce overﬁtting number parameters network strongly rely data augmentation techniques obtain realistic samples speciﬁcally given volume training generate sample volume spatial transformation function. particular neural network composed ﬁrst able apply afﬁne transformations input volumes second using thin plate splines perform non-linear deformations contrast given input volume value specifying standard deviation parameter gaussian ﬁlter ﬁrst appropriate ﬁlter constructed convolved input. steps precisely deﬁned following. gaussian ﬁlter construction consider smoothing function continuous isotropic -dimensional gaussian function standard deviation ﬁlter varying size obtained sampling speciﬁc locations speciﬁed grid deﬁned number standard deviations mean gaussian function truncated. finally values ﬁlter renormalised care must taken values. particular whenever truncated discrete gaussian function generates single-cell ﬁlter leading partial derivatives qijk hence causing backpropagation gradient disappear. misbehaviour alleviated stochastically adding probability values mentioned threshold. renormalising single-cell ﬁlter must done care since dividing elements cancels causing gradient disappear. alternative solution clip values provided parameters network certain threshold avoids problem altogether. moreover typically reasonable apply certain minimum smoothing particular assumptions sought fulﬁlled smoothing minimally times voxel size usually recommended volume smoothing given convolutional smoothing operator rh×w spatially smoothing volume accomplished sliding operator performing convolution location. finally element resulting smoothed volume rh×w×d computed conventional parameters modules calculated corresponding parameters networks randomly sampled multivariate gaussian distribution calculated aligning ﬁrst volume pair subjects ﬁrst volume training set. formally series subjects respectively. goal optimise ˆφαβ every pair subjects double network deﬁned previous paragraph. then sample mean covariance matrix fmri data simple sequential ﬁnger tapping paradigm subjects alternated second blocks left right ﬁnger tapping separated seconds rest. data recorded siemens scanner equipped standard birdcage headcoil. subjects’ data consisted volumes isotropic resolution sampled repetition time seconds. acquisition parameters found basic preprocessing steps including realignment normalisation standard settings volume labelled according left/right/rest condition starting second volume block. experimental setup subjects ﬁrst used training remaining aside testing. experiment volumes subject using intra-subject extrema) used irrespectively labelling. fully-connected layer parameters network initialised using xavier initialisation reference volume constructed averaging ﬁrst volume subjects training set. epoch data created randomly selecting volumes subject training applying random transformation them explained section ii-d. network trained using stochastic gradient descent nesterov momentum number internal epochs data generated. hyperparameters selected using bayesian optimisation strategy validated subjects test randomly picking volumes subject applying random transformations whole procedure repeated remaining subjects test set. optimal results rounds obtained hyperparameters epochs internal epochs learning rate momentum results assessing capacity system deal noisy inputs randomly sample volume remaining subjects test uniform white noise voxel predeﬁned maximum noise level expressing deformation percentage applied volume. reference volume created averaging ﬁrst volume subject set. procedure repeated times generating volumes varying noise levels. volumes network computes corresponding ﬁlter size volumes. results converted full width half maximum fig. shows correlation noise level fwhm similarly previously introduced generate brain volumes affected different deformation levels. maximum parameter levels translations shearing scaling rotations nonlinear warpings. fig. depicts correlation different deformation levels resulting fwhm experiment want evaluate capacity pre-trained system deal anatomical differences subjects test set. pre-trained network volumes test using average subjects’ ﬁrst volume reference. table shows average squares difference smoothed subject’s brain volume reference volume smoothed accordingly penalty term also calculated purpose quantify degree loss incurred subject smoothing. results show smoothing used anatomical differences highest standard-practise smoothing applied differences diminished price higher penalty image; adaptive smoothing presents better trade-off two. anat. column fwhm shows average smoothing network calculates subject. looking fig. system shows general consistency assigning varying smoothing levels volumes according distance reference volume. likewise interesting notice although different smoothing accounting inter-subject dissimilarities seems plausible intra-subject differences quite minimal therefore real need per-volume smoothing stage. differences show average squares distance subject reference volume variety smoothings data ﬁxed using adaptive method. similarly penalty expresses measure smoothed instances. fwhm shows kernel width selected adaptive method different analytical tasks inter-subject anatomical differences brain decoding decoding noise. acc. column reports obtained accuracies noisy brain decoding task. data analysis task part multilayer neural network. section decoding module smoothing aiming classifying brain volume state subject ﬁnger tapping right left hand; hence brain volumes labelled rest discarded using volumes subject. decoding module composed fully-connected layer single linear output variant batch-normalisation applied sigmoid activation. importantly volumes subject conform mini-batch coupled ofﬂine nature experiments allows using current batch statistics training validation testing. settings training procedures deﬁned previous experiment using pre-trained weights starting point parameters network. data augmentation used binary crossentropy predicted values targets loss function choice. network trained allowing ﬁne-tune parameters network using hyperparameters epochs learning rate here allow adaptive smoothing freely choose adequate smoothing providing highest classiﬁcation accuracy. notice aiming improving accuracy setting rather want observe behaviour adaptive smoothing module. expected dec. column table shows average smoothing parameter subject tends vanish current task. order challenge network gaussian white noise artiﬁcially added input volumes forcing smoothing kernel widened column shows appropriate average smoothing subject last columns present corresponding classiﬁcation accuracies. although seems slight improvement classiﬁcation accuracy method employed experiments done fig. correlation volume difference reference fwhm proposed network. colour represents different subject. datasets encoding tasks highly dependent smoothing step appreciate extent method. using novel implemented spatial smoothing module demonstrate possible construct differentiable modules neural networks form ﬂexible dynamic analysis pipelines fmri data. proof concept additionally show feasible train networks end-to-end important step towards truly optimal processing pipelines. future work focus development standard fmri pipeline form neural network including determining spatial location activations. project received funding european union’s horizon research innovation programme marie sklodowska-curie grant agreement gratefully acknowledge support nvidia corporation donation gpus used research. hauberg dreaming data class-dependent distributions diffeomorphisms learned data augmentation aistats bookstein principal warps thin-plate splines decomposition deformations ieee trans. pattern anal. mach. intell. vol. jun.", "year": 2017}