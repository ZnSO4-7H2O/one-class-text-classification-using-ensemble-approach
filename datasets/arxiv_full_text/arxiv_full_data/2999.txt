{"title": "Deep Fruit Detection in Orchards", "tag": ["cs.RO", "cs.AI", "cs.CV", "cs.LG"], "abstract": "An accurate and reliable image based fruit detection system is critical for supporting higher level agriculture tasks such as yield mapping and robotic harvesting. This paper presents the use of a state-of-the-art object detection framework, Faster R-CNN, in the context of fruit detection in orchards, including mangoes, almonds and apples. Ablation studies are presented to better understand the practical deployment of the detection network, including how much training data is required to capture variability in the dataset. Data augmentation techniques are shown to yield significant performance gains, resulting in a greater than two-fold reduction in the number of training images required. In contrast, transferring knowledge between orchards contributed to negligible performance gain over initialising the Deep Convolutional Neural Network directly from ImageNet features. Finally, to operate over orchard data containing between 100-1000 fruit per image, a tiling approach is introduced for the Faster R-CNN framework. The study has resulted in the best yet detection performance for these orchards relative to previous works, with an F1-score of >0.9 achieved for apples and mangoes.", "text": "example almond tree image data used paper contains large pixel fruit count megapixels images containing fruit each. additionally data captured outdoor scenes signiﬁcant intra-class variations variability illumination conditions distance fruit fruit clustering camera viewpoint etc. aspects result challenging data labelling process supervised learning high resolution imagery imposes hardware/algorithm constraints. fig. research ground vehicle shrimp developed australian centre field robotics university sydney traversing rows mango orchard capturing tree image data. paper address speciﬁc constraints imposed fruit detection large scale orchard data using state-of-the-art deep learning detector faster r-cnn. paper provides implementation details rationale design decisions ablation studies experimentation spanning three significantly different orchard types including apples mangoes almonds. primary contributions releasing datasets used work authors’ previous publications alongside object labelling annotation toolbox designed rapid fruit labelling remainder paper organised follows. section presents related work object detection abstract— accurate reliable image based fruit detection system critical supporting higher level agriculture tasks yield mapping robotic harvesting. paper presents state-of-the-art object detection framework faster r-cnn context fruit detection orchards including mangoes almonds apples. ablation studies presented better understand practical deployment detection network including much training data required capture variability dataset. data augmentation techniques shown yield signiﬁcant performance gains resulting greater two-fold reduction number training images required. contrast transferring knowledge orchards contributed negligible performance gain initialising deep convolutional neural network directly imagenet features. finally operate orchard data containing fruit image tiling approach introduced faster r-cnn framework. study resulted best detection performance orchards relative previous works f-score achieved apples mangoes. vision based fruit detection critical component inﬁeld automation agriculture. accurate knowledge individual fruit locations ﬁeld possible perform yield estimation mapping important growers facilitates efﬁcient utilisation resources improves returns unit area time. precise localisation fruit also necessary component automated robotic harvesting system help mitigate labour intensive tasks orchard typically prior work utilises hand engineered features encode visual attributes discriminate fruit non-fruit regions although approaches well suited dataset designed feature encoding generally unique speciﬁc fruit conditions data captured. recently advances computer vision community translated agrovision achieving state-of-the-art results deep neural networks object detection semantic image segmentation networks avoid need hand-engineered features automatically learning feature representations discriminately capture data distribution. outdoor orchard image data present additional challenges fruit detection. efﬁcient large scale operation sensor ﬁeld view needs span entire trees high resolution imagery required relatively small fruit size. computer vision focus towards agrovision. section describes detection approach uses faster rcnn framework. section details experimental setup ablation studies presented section discuss ﬁndings lessons learned section concluding section future directions. fruit detection explored many researchers agrovision across variety orchard types purposes autonomous harvesting yield mapping/estimation detection typically performed transforming image regions discriminative features spaces using trained classiﬁers associate either fruit background objects foliage branches ground. semantic image segmentation performs densely resulting pixel-wise classiﬁcation image. post-processing techniques applied differentiate individual whole-objects interest groups adjacent pixels. hand detection search space reduced using low-level image analysis identify regions interests image followed high-level feature extraction classiﬁcation. analysis local colours textures used pixel-wise mango classiﬁcation followed blob extraction identify individual mangoes avoiding hand-engineered features convolutional neural networks used pixel-wise apple classiﬁcation followed watershed segmentation identify individual apples. radial symmetries specular reﬂection berries shown useful extraction kd-forest used berry classiﬁcation. detect citrus fruit circular hough transforms used extract key-points classiﬁed using support vector machine recently region based convolutional neural networks combine approach cnns produced state-of-the-art detection results pascal-voc detection dataset rois initially proposed using selective search ﬁnds interesting regions merging superpixels. cnns used classify regions directly regress bounding location object contained within. subsequent work authors proposed faster r-cnn model merges region proposals object classiﬁcation localisation uniﬁed deep object detection network. end-to-end network yielded improvements detection results signiﬁcantly reducing training prediction times. paper explore necessary adaptations faster r-cnn framework fruit detection orchard image data. large scale orchard data typically characterised whole tree images containing thousands fruit large variations fruit sizes image data. data cannot directly imported network hardware constraints labelling images high object count difﬁcult task. address issues provide practical insights data requirements strategies reducing training data discuss knowledge transfer orchards fruit classiﬁcation. work natural progression authors’ line prior work orchard imaging focused achieving stateof-the-art results fruit detection orchard-scale yield mapping estimation. parallel work recently demonstrated faster r-cnn sweet pepper rockmelon detection greenhouse showed versatility detector amongst fruit types images obtained google image search. orchard imagery differs substantially study warrants dedicated investigation. greenhouses afford images taken relatively close fruit similarly google images taken hand-held cameras. cases leads imagery relatively high pixel count fruit fruit-count image compared outdoor orchard imagery furthermore larger trees outdoor environment orchards leads greater illumination variability despite efforts minimise strobe lights. present additional details guidance regarding structure faster r-cnn particular requirements orchard scale image data. ongoing work faster r-cnn framework also introduced recently advocates fully convolutional networks resulting advances accuracy speed however paper focus original faster r-cnn network within family deep learning based detectors easy-to-use open-source implementation. section presents faster r-cnn framework fruit detection orchards introduces details transfer learning data augmentation techniques used within ablation studies conducted section faster r-cnn object detection system composed modules region proposal network used detection rois image followed classiﬁcation module classiﬁes individual regions regresses bounding around object. training input network -channel colour image arbitrary size along annotated bounding boxes around fruit. image data propagated number convolutional layers depending choice cnn. paper experiment network contains convolutional layers deeper contains convolutional layers output convolution layers high dimensional feature sub-sampled factor strides pooling layers. local regions feature forward propagated sibling fully connected fig. faster r-cnn network. -channel input image propagated convolutional layers region interest boxes proposed propagated fully connected layers return class probability regresses ﬁner bounding around individual objects ground truth input image used r-cnn layers training. testing class speciﬁc detection threshold applied output followed non-maximum suppression remove overlapping results. layers box-regression layer box-classiﬁcation layer. layer ﬁxed number class agnostic detections object proposals. using attention mechanisms individual proposals propagated subsequent fully connected layers ending sibling layers ﬁner region classiﬁcation output associated object bounding box. training done end-to-end using stochastic gradient descent allowing convolutional layers shared r-cnn components. testing network returns bounding detections image class probabilities. probability threshold applied followed non-maximum suppression handle overlapping detections. faster r-cnn network illustrated fig. showing intermediate outputs sample image apple orchard. reader referred original work detailed overview network architecture implementation details become standard computer vision train using large base network transfer learned features target task typically fewer labelled examples. imagenet dataset often used base containing object categories million images. using imagenet pre-trained features state-of-the-art results obtained variety image processing tasks image classiﬁcation image captioning default faster r-cnn advocates initialisation detection network weights learned imagenet however transferring weights target task performance degrade target classes drastically different base classes. deeper layers network learn features speciﬁc task hand begs question best initialise network task fruit detection orchard data captured ground vehicle typically different imagenet? networks initialised imagenet features would suitable transfer knowledge features ﬁne-tuned another orchard dataset? data augmentation common expand variability training data artiﬁcially enlarging dataset using label-preserving transformations. process increases networks capability generalise reduces overﬁtting. typical augmentation techniques used computer vision community include left-right ﬂipping image re-scaling changes image colour. numerous approaches colour augmentation including colour/intensity jittering range colour spaces hsv. paper adapts augmentation technique presented alexnet colour perturbations along natural variations dataset denoted principal components pixel colours. augmentations implemented either expanding dataset copies augmented versions randomly augmenting data training epoch. employing latter preferable avoids pre-computing wide range random augmentations. orchard data evaluated paper consists three fruit varieties apples almonds mangoes captured daylight hours orchards victoria queensland australia. apple mango data captured sensors on-board general purpose research ground vehicle built australian centre field robotics vehicle traversed across different rows orchards collecting tree image data. apple trees trellised enabling ground vehicle close proximity fruit. longer distance mangoes ground vehicle compensated higher resolution sensor. additionally mango orchard external strobe lighting used small exposure time reduce variable illumination artefacts. almond trees hand larger canopies host almonds smaller size apples mangoes. high resolution imagery therefore required obtain good representation fruit achieved hand-held dslr camera. images captured orchard spanned entire trees driven primary experimental objective efﬁcient yield estimation mapping. fruit detection work presented paper therefore critical component overarching project objective. tree image data varied image containing around fruit apples mangoes fruit almonds. however hardware constraints limit large images image requiring memory network. additionally ground truth data collection found labelling large number small objects large images perceptually difﬁcult task. mitigate problems randomly sampling smaller sub-image patches pool larger images acquired farm. leaves smaller images fruit counts covering data variability across farm. data conﬁgurations different fruits summarised table ground truth fruit annotations almonds mangoes collected using rectangular annotations circular annotations suitable apples. however faster r-cnn operates bounding prediction therefore circular annotations initially converted rectangular ones equal width height. practice easier label apples mangoes almonds size contrast fruit compared surrounding foliage complexity canopy. help differentiate fruit background shadowed regions image annotation software provides sliders contrast brightness adjustments. finally labelled dataset fruit split training validation testing splits split done contained data captured different part orchard block order minimise biased results. images training containing fruit discarded. number training images transfer learning orchards data augmentation techniques. studies performed using shallower network faster train however performance evaluation deeper network presented well. finally simple technique deploying learned networks large images proposed. although faster r-cnn framework capable multi-class detection binary problem considered orchard data model trained fruit type. restricting number classes generally lead better classiﬁcation accuracy acceptable orchard applications orchard blocks typically homogeneous fruit block without mixing network sub-sampling factor ﬁnal convolution layer therefore minimal possible object size pixels. ensure this training sub-images scaled shorter side pixels meant enlarging apple almond sub-images. sub-image dimensions speciﬁed previous section chosen allow large enough fruit representations post re-scaling. networks initialised imagenet ﬁlters trained convergence detection performance validation set. roughly iterations apples almonds iterations mangoes. exploration initialisations learning rates mango dataset could enable quicker training. network learning hyper-parameters ﬁxed conﬁguration used pascal-voc detection challenge. detection performance reported using averageprecision response fruits area precision recall curve. ﬁnal results reported using fscore class threshold evaluated held validation set. threshold parameter also optimised validation ranged different fruits however found results sensitive range. fruit detection considered true positive predicted ground truth bounding intersection union greater equates overlap along axis object considered sufﬁcient fruit mapping application. example higher thresholds small errors detections smaller fruit caused registered false positives. one-to-one matching enforced evaluation penalising single detections fruit clusters multiple detections single fruit. three fruits number training images learning phase varied detection performance evaluated held test set. process repeated times account variance training data time random images sampled training without replacement. fig. shows detection results three fruits function number training images. detection performance rises quickly small number training images reaching apples images. number training images reaches amount available labelled data performance close convergence apples increasing ﬁnal increase number training images. almond mango data reached convergence datasets yielding improvement last increase training data. types transfer learning apple detection network initialised using pre-trained models mangoes almonds detection performance number training images compared network initialised directly imagenet. results show initial beneﬁts transfer learning orchards diminish quickly number training images increase difference training images. data augmentation applied apple mango dataset using scale ﬂip-scale augmentations. training iteration scale augmentation rescaled images shorter size pixels augmentation perturbed intensities along eigenvector factor eigenvalues multiplied uniform random number zero mean variance results illustrated fig. fig. apple detection performance different transfer learning procedures. default setting initialises network weights training imagenet features. tested networks initialised features learned almond mango detection networks. magnitude increased further) scale augmentations help increase detection performance. best boost detection performance achieved ﬂip-scale augmentations. suggests shape scale variability dataset relative colour variations along principal components. beneﬁts augmentation decrease performance asymptotes increasing training images. apples negligible difference point asymptote. whereas mangoes performance asymptote reached given labelled data data augmentation still evident gain performance. cases data augmentation network reached ﬁxed detection performance less half number training samples. example apples score achieved training images compared images required augmentation used. obtain peak detection performance three fruits deeper network architecture trained using available training data ﬂip-scale augmentations. detection results reported fruit f-scores allowing comparison previous work using dataset presented previous approach used cnns pixel-wise classiﬁcation followed watershed segmentation blob detection. detection results shown table v-d. fig. apple mango detection performance different number training instances different data augmentation procedures used training. best viewed colour. almonds performance converged number training images. apples mangoes faster r-cnn outperformed pixel-wise approach. attributed deeper network faster r-cnn end-to-end approach detection localisation fig. shows example detections fruit containing successful faulty detections. networks trained nvidia using cuda cudnn network took minutes train fruit class less hours training time pixel-wise based classiﬁcation system. however faster r-cnn performed much faster predictions detection image averaging seconds image compared seconds image pixel-wise cnn. perform higher level tasks yield mapping estimation image prediction needs performed large sensor images captured farm rather sub-images used training. memory bottleneck overcome performing detections using smaller sliding windows larger images ‘tiling’. keeping overlap region greater maximum size fruit data detections proposals collected sub-sections thresholding applied fused output large image. fig. shows fruit detection whole tree mango orchard using tiled faster r-cnn. original image scanned smaller windows overlap pixels. ﬁgure shows image cropped single tree contains visible fruit. tiling approach detected fruit correctly without false positive detections. proposed framework used detecting fruit trees images captured across orchard block. work conducted parallel authors approach perform yield estimation fruit localisation mango orchard. fig. detection mangoes mango tree using tiled faster r-cnn. example image contains true positive detections false negative detections false positives. best viewed colour. faster r-cnn detection framework yields state-ofthe-art performance multiple orchard image data. section provides insights practical implementation detection network orchards drawn ablations studies presented earlier. study detection performance number training images useful identifying fruit reached performance asymptote hence warrant additional data labelling. images labelled apples enough span variability dataset. mango almond datasets containing images respectively however would require order magnitude increase labelled data reach asymptote. data augmentation helped boost detection performance effectively reducing number training images required enabling network reach performance asymptote less labelled data. little advantage transferring knowledge farms surprising result given apparent visual similarities imagery different orchards. imagenet features sufﬁcient performing ﬁne-grained classiﬁcation detection orchards results adding increasing evidence fig. sample detections test apples mangoes almonds true positive detections green false positives false negatives blue. paired columns contain instances examples true positives false positives false negatives left right. best viewed screen colour. analysis fruit precision recall give better insight practical signiﬁcance observed improvements detection performance. focusing mangoes improvement f-score network equates change precision change recall means detection extra fruit reduction incorrect detections depending farm application network choice trade-off accuracy speed. example yield mapping would beneﬁt higher detection accuracy performed ofﬂine worst detection performance observed almonds attributed aspects dataset lower number training images. almonds smaller fruit large tree resulting resolution fruit given need capture whole tree single image would require tree images pixel density almond mangoes apples. secondly almonds similar colour texture foliage which combined resolution imagery resulted difﬁcult dataset manually label perform detection detection approach presented paper easily extended orchards. provided labelling toolbox used labelling process parallel training/testing process help evaluate change detection performance increasing number training images. labelling processing could terminated based labelling budget and/or performance requirements. smaller fruit images need rescaled minimum fruit size greater pixels however fruit resolution detrimental labelling detection performance. results advocate simple data augmentation techniques image ﬂipping rescaling transfer learning different fruits deemed necessary. transfer learning could still important base task similar target task. example model trained given apple dataset might still useful initialising detection network different apple dataset captured different illumination conditions and/or different sensor. tests need conducted adapt model variations dataset however shows reasonable qualitative performance dataset without re-learning. fig. shows examples fruit detections covering image instances number true positives false positives false negatives. portion detection errors observed attributed inability detect fruit appearing cluster error ground truth labelling resulting incorrect false positive false negative evaluations. overlapping detections clustered regions suppressed understand severity error one-to-one evaluation criteria relaxed allow detection represent cluster. mango detection network increased recall subsequently increasing f-score therefore error fruits appearing tight clusters. although outside scope paper recent instance segmentation techniques limited image resolution similarities fruit foliage inconsistencies object deﬁnition labelling task tedious prone errors. missing ground truth annotations cause many false positive instances fig. annotation error reduced consensus voting amongst multiple human labellers expensive operation. investigation required test labelling orchard data feasible online listings mechanical turk ﬁeld expertise required discern fruit background. less expensive means reduce labelling error would output trained detector clean-up ground truth data human loop though care would required avoid inducing biases. paper presented fruit detection system image data captured orchards using state-of-the-art detection framework faster r-cnn. ablation studies conducted three orchard fruit types apples mangoes almonds better understand practical deployment system. study detection performance number training images demonstrated amount training data required reach convergence. analysis transfer learning showed transferring weights orchards yield signiﬁcant performance gains network initialised directly highly generalised imagenet features. data augmentation techniques scale augmentations found improve performance varying number training images resulting equivalent performance less half number training images. study leads best detection performance authors’ line prior work f-score achieved mangoes apples. high level applications yield mapping estimation proposed tiled faster r-cnn implement trained model large images required fruit counting orchards. future work integrate detection output faster r-cnn yield mapping conducting object association adjacent frames. additional analysis fruit detection also conducted understand transfer learning datasets representing fruit captured different lighting conditions sensor conﬁgurations times year. work supported australian centre field robotics university sydney funding australian government department agriculture water resources part rural proﬁt programme. thanks rishi ramakrishnan insightful discussions detection framework experimental layout. information videos available http //sydney.edu.au/acfr/agriculture kapach barnea mairon edan ben-shahar computer vision fruit harvesting robots state challenges ahead international journal computational vision robotics vol. payne walsh subedi jarvis estimating mango crop yield using image analysis using fruit ’stone hardening’ stage night time imaging computers electronics agriculture vol. wang nuske bergerman singh automated crop yield estimation apple orchards experimental robotics ser. springer tracts advanced robotics. springer international publishing vol. sengupta identiﬁcation determination number immature green citrus fruit canopy different ambient light conditions biosystems engineering vol. girshick donahue darrell malik region-based convolutional networks accurate object detection segmentation pattern analysis machine intelligence ieee transactions vol. hung nieto taylor underwood sukkarieh orchard fruit segmentation using multi-spectral feature learning ieee international conference intelligent robots systems", "year": 2016}