{"title": "DeepLung: 3D Deep Convolutional Nets for Automated Pulmonary Nodule  Detection and Classification", "tag": ["cs.CV", "cs.LG", "cs.NE"], "abstract": "In this work, we present a fully automated lung CT cancer diagnosis system, DeepLung. DeepLung contains two parts, nodule detection and classification. Considering the 3D nature of lung CT data, two 3D networks are designed for the nodule detection and classification respectively. Specifically, a 3D Faster R-CNN is designed for nodule detection with a U-net-like encoder-decoder structure to effectively learn nodule features. For nodule classification, gradient boosting machine (GBM) with 3D dual path network (DPN) features is proposed. The nodule classification subnetwork is validated on a public dataset from LIDC-IDRI, on which it achieves better performance than state-of-the-art approaches, and surpasses the average performance of four experienced doctors. For the DeepLung system, candidate nodules are detected first by the nodule detection subnetwork, and nodule diagnosis is conducted by the classification subnetwork. Extensive experimental results demonstrate the DeepLung is comparable to the experienced doctors both for the nodule-level and patient-level diagnosis on the LIDC-IDRI dataset.", "text": "emergence large-scale dataset luna accelerates nodule detection related research. typically nodule detection consists stages region proposal generation false positive reduction. traditional approaches generally require manually designed features morphological features voxel clustering pixel thresholding recently deep convolutional networks faster r-cnn fully convolutional networks employed generate candidate bounding boxes second stage advanced methods complex features carefully designed texture features designed remove false positive nodules. nature data effectiveness faster r-cnn object detection natural images design faster r-cnn nodule detection unet-like encoder-decoder structure effectively learn latent features deep learning feature engineering followed classiﬁers general pipeline nodule classiﬁcation public large-scale dataset lidc-idri becomes available deep learning based methods become dominant nodule classiﬁcation research multi-scale deep convolutional network shared weights different scales proposed nodule classiﬁcation weight sharing scheme reduces number parameters forces multi-scale deep convolutional network learn scale-invariant features. inspired recent success dual path network imagenet propose novel framework nodule classiﬁcation. first design deep dual path network extract features. gradient boosting machines deep dual path features nodule size cropped nodule pixels nodule classiﬁcation last build fully automated lung cancer diagnosis system deeplung combining nodule detection network nodule classiﬁcation network together illustrated fig. image ﬁrst detection subnetwork detect candidate nodules. next employ classiﬁcation subnetwork classify detected nodules either malignant benign. finally patient-level diwork present fully automated lung cancer diagnosis system deeplung. deeplung contains parts nodule detection classiﬁcation. considering nature lung data networks designed nodule detection classiﬁcation respectively. speciﬁcally faster r-cnn designed nodule detection u-net-like encoder-decoder structure effectively learn nodule features. nodule classiﬁcation gradient boosting machine dual path network features proposed. nodule classiﬁcation subnetwork validated public dataset lidc-idri achieves better performance state-of-the-art approaches surpasses average performance four experienced doctors. deeplung system candidate nodules detected ﬁrst nodule detection subnetwork nodule diagnosis conducted classiﬁcation subnetwork. extensive experimental results demonstrate deeplung comparable experienced doctors nodule-level patient-level diagnosis lidc-idri dataset. lung cancer common cause cancer-related death men. low-dose lung screening provides effective early diagnosis sharply reduce lung cancer mortality rate. advanced computer-aided diagnosis systems expected high sensitivities time maintaining false positive rates. recent advances deep learning enable rethink ways clinician lung cancer diagnosis. current lung analysis research mainly includes nodule detection nodule classiﬁcation work building complete lung cancer diagnosis system fully automated lung cancer diagnosis integrating nodule detection nodule classiﬁcation. worth exploring whole lung cancer diagnosis system understanding performance current technology differs experienced doctors. best knowledge ﬁrst work fully automated complete lung cancer diagnosis system. copyright association advancement artiﬁcial intelligence rights reserved. figure framework deeplung. deeplung ﬁrst employs faster r-cnn generate candidate nodules. uses deep dual path network extract deep features detected cropped nodules. lastly gradient boosting machine deep features detected nodule size nodule pixels employed classiﬁcation. patient-level diagnosis achieved fusing classiﬁcation results detected nodules main contributions follows best knowledge deeplung ﬁrst work complete automated lung cancer diagnosis system. deep convolutional networks designed nodule detection classiﬁcation. speciﬁcally inspired effective faster r-cnn object detection deep dual path network’s success imagenet propose faster r-cnn nodule detection deep dual path network nodule classiﬁcation. classiﬁcation framework achieves superior performance compared state-of-the-art approaches performance surpasses average performance experienced doctors largest public dataset lidc-idri dataset. deeplung system comparable average performance experienced doctors nodulelevel patient-level diagnosis. traditional nodule detection requires manually designed features descriptors recently several works proposed deep convolutional networks nodule detection automatically learn features proven much effective hand-crafted features. setio proposes multi-view convolutional network false positive nodule reduction nature scans work propose convolutional networks handle challenge. fully convolutional network proposed generate region candidates deep convolution network weighted sampling used false positive candidates reduction stage ding uses faster r-cnn generate candidate nodules followed convolutional networks remove false positive nodules effective performance faster r-cnn design novel network faster rcnn nodule detection. further u-net-like encoderdecoder scheme employed faster r-cnn effectively learn features manual feature design several works designed contour feature shape feature texture feature nodule diagnosis recently deep networks shown effective medical images. artiﬁcial neural network implemented nodule diagnosis computationally effective network multi-scale convolutional neural network shared weights different scales learn scale-invariant features proposed nodule classiﬁcation deep transfer learning multi-instance learning used patientlevel lung diagnosis comparison convolutional networks conducted shown convolutional network superior convolutional network data further multi-task learning transfer learning framework proposed nodule diagnosis different approaches propose novel classiﬁcation framework nodule diagnosis. inspired recent success deep dual path network imagenet design novel totally deep dual path network extract features nodules. then employ gradient boosting machine deep features nodule size nodule pixels nodule diagnosis. patientlevel diagnosis achieved fusing nodule-level diagnosis. fully automated lung cancer diagnosis system deeplung consists parts nodule detection nodule classiﬁcation. design faster r-cnn nodule detection propose gradient boosting machine deep dual path network features nodule pixels nodule size nodule classiﬁcation. gradient boosting machine dual path feature nodule classiﬁcation inspired success dual path network imagenet design deep dual path network framework lung nodule classiﬁcation fig. dual path connection beneﬁts advantage residual learning dense connection shortcut connection residual learning effective eliminate gradient vanishing phenomenon deep networks. learned feature weights sharing perspective residual learning enables feature reuse dense connection advantage keeping exploiting features densely connected network fewer parameters residual learning need relearn redundant feature maps. assumption dual path connection might exist redundancy exploited features. dual path connection uses part feature maps dense connection part residual learning. implementation dual path connection splits feature maps parts. part used residual learning part used dense connection shown fig. hyper-parameter deciding many features exploited. dual path connection formulated feature dual path connection used relu activation function convolutional layer functions input dual path connection block. dual path connection integrates advantages advanced frameworks residual learning feature reuse dense connection keeping exploiting features uniﬁed structure obtains success imagenet dataset. data advanced method effective extract volume feature design deep dual path network lung nodule classiﬁcation fig. ﬁrstly crop data centered predicted nodule locations size that convolutional layer used extract features. dual path blocks employed learn higher level features. lastly average pooling binary logistic regression layer used benign malignant diagnosis. figure faster r-cnn framework contains residual blocks u-net-like encoder-decoder structure. model employs anchors multitask learning loss including coordinates diameter regression candidate classiﬁcation. numbers boxes feature sizes format numbers connections format faster r-cnn nodule detection faster r-cnn u-net-like encoder-decoder structure illustrated fig. memory limitation input faster r-cnn cropped reconstructed images pixel size encoder network derived resnet- ﬁrst max-pooling convolutional layers used generate features. that four residual blocks employed encoder subnetwork. integrate unet-like encoder-decoder design concept detection learn deep networks efﬁciently fact region proposal generation faster r-cnn conducts pixel-wise multi-scale learning u-net validated effective pixelwise labeling. integration makes candidate nodule generation effective. decoder network feature maps processed deconvolution layers residual blocks subsequently concatenated corresponding layers encoder network convolutional layer dropout used second last layer. last layer design anchors scale references designed based distribution nodule sizes. anchor parts loss function classiﬁcation loss lcls whether current nodule regression loss lreg nodule coordinates nodule size anchor overlaps ground truth bounding intersection union higher consider positive anchor hand anchor ground truth boxes less consider negative anchor multi-task loss function anchor deﬁned center detected center size detected nodule size kept classiﬁcation model part features. deep dual path network employed extract features. construct features conduct diagnosis detected nodules. pixel feature cropped size center detected nodule center experiments. patient-level diagnosis detected nodules positive patient cancer patient detected nodules negative patient negative patient. conduct extensive experiments validate deeplung system. perform -fold cross validation using detector luna dataset. nodule classiﬁcation lidc-idri annotation employ luna’s patientlevel dataset split. finally also validate whole system based detected nodules patient-level diagnosis nodule-level diagnosis. training model epochs total stochastic gradient descent optimization momentum used batch size relied memory. weight decay initial learning rate half training epoch datasets luna dataset subset largest public dataset pulmonary nodules lidc-idri dataset luna dataset detection annotations lidc-idri contains almost related information low-dose lung including several doctors’ annotations nodule sizes locations diagnosis results nodule texture nodule margin informations. luna dataset removes slice thickness greater slice spacing inconsistent missing slices lidc-idri dataset explicitly gives patient-level -fold cross validation split dataset. luna dataset contains low-dose lung lidc-idri contains lowdose lung cts. note luna dataset removes annotated nodules size smaller nodule classiﬁcation extract nodule annotations lidc-idri dataset mapping different doctors’ nodule annotations luna’s nodule annotations ground truth nodule diagnosis taking different doctors’ diagnosis averagely ﬁnal average score equal remove nodule. nodules score greater label positive. otherwise label negative. doctors’ annotations keep four doctors label nodules comparison. keep within luna dataset cross validation split luna classiﬁcation. figure deep dual path network framework nodule classiﬁcation subnetwork contains dual path connection blocks. training deep dual path network feature extracted gradient boosting machine nodule diagnosis. numbers ﬁgure formats fig. concatenating learned deep dual path network features nodule size cropped nodule pixels. given complete effective features gradient boosting machine superior method build advanced classiﬁer features validate feature combining nodule size cropped nodule pixels employ classiﬁer obtain test accuracy averagely. lastly employ constructed feature achieve best diagnosis performance. deeplung system fully automated lung cancer diagnosis deeplung system includes nodule detection using faster r-cnn nodule classiﬁcation using gradient boosting machine constructed feature fig. memory limitation ﬁrst split whole several patches process detector combine detected results together. keep detected boxes detection probabilities larger that non-maximum suppression adopted based detection probability intersection union threshold expect miss many ground truth nodules. figure sensitivity rate respect false positives scan. froc faster r-cnn recall rate nodules. dash lines lower bound upper bound froc conﬁdence interval using bootstrapping bootstraps solid line interpolated froc based prediction. luna’s given segmentation ground truth remove useless background. worth visualizing processed data processing segmentations imperfect need removed. that data processed deep networks. deeplung nodule detection train evaluate detector luna dataset following -fold cross validation given patient-level split. training ﬂipping randomly scale cropped patches augment data. evaluation metric froc average recall rate average number false positives scan ofﬁcial evaluation metric luna dataset. froc performance luna visualized fig. solid line interpolated froc based true prediction dash lines upper bound lower bound bootstrapped froc performance. faster r-cnn achieves froc without false positive nodule reduction stage comparable best method uses two-stage training deeplung nodule classiﬁcation validate nodule classiﬁcation performance deeplung system lidc-idri dataset luna’s split principle -fold patient-level cross validation. nodules left nodules positive. training ﬁrstly nodules size randomly crop padded data horizontal vertical z-axis data augmentation randomly patch normalize data mean std. obtained training data. total number epochs learning rate ﬁrst became epoch turned epoch time resource limitation training fold test ﬁnal performance average performance test folds. nodule classiﬁcation performance concluded table table deep dual path network achieves better performance multi-scale power structure deep dual path network. power gradient boosting machine nodule size nodule pixels crop size achieves comparable performance multi-scale finally construct feature deep dual path network features nodule size nodule pixels obtain accuracy. compared experienced doctors individually conﬁdent nodules compare predictions four experienced doctors individually conﬁdent nodules note nodules labeled doctor. comparison results concluded table table doctors’ conﬁdent nodules easy diagnosed nodules performance comparison model’s performances table table surprise average performance model better experienced doctors. fact model’s performance better doctors nodule diagnosis task. result validates deep network surpasses human-level performance image classiﬁcation deeplung better suited nodule diagnosis experienced doctors. deeplung fully automated lung cancer diagnosis also validate deeplung fully automated lung cancer diagnosis lidc-idri dataset protocol luna’s patient-level split. firstly employ faster r-cnn detect suspicious nodules. retrain model nodule classiﬁcation model detected nodules dataset. center detected nodule within ground truth positive nodule positive nodule. otherwise negative nodule. mapping detected nodule ground truth nodule evaluate performance compare performance experienced doctors. adopt test fold validate performance nodule classiﬁcation. different pure nodule classiﬁcation fully automated lung nodule diagnosis relies nodule detection. evaluate performance deeplung detection true positive detection false positive individually table detected nodule center within ground truth nodule regions set. detected nodule center ground truth nodule regions set. table deeplung system using detected nodule region obtains accuracy detected nodules. note experienced doctors obtain accuracy nodule diagnosis average. deeplung system fully automated lung nodule diagnosis still achieves average performance experienced doctors. nodule classiﬁcation subnetwork deeplung reduce detected nodules guarantees fully automated system effective lung cancer diagnosis. compared experienced doctors individually conﬁdent employ deeplung patientlevel diagnosis further. current nodule classiﬁed positive diagnosis positive. nodules classiﬁed negative diagnosis negative. evaluate deeplung doctors’ individually conﬁdent benchmark comparison table table deeplung achieves patient-level diagnosis accuracy. performance average performance four experienced doctors performance deeplung better doctor thus deeplung used help improve doctors’ performance like doctor goal computer aided diagnosis system. also employ kappa coefﬁcient common approach evaluate agreement raters test agreement deeplung ground truth patient-level labels comparison valid individual doctors individual conﬁdent cts. kappa coefﬁcient deeplung average kappa coefﬁcient doctors shows predictions deeplung good agreement ground truths patient-level diagnosis comparable experienced doctors. nodule detection randomly pick nodules test fold visualize ﬁrst third fig. detected nodules visualized second fourth ﬁfth row. numbers detected nodules format ﬁfth detection probabilies false positive detections. visualize slice center yellow circles ground truth nodules detected nodules respectively. center circle nodule center diameter circle relative nodule size. ﬁrst four rows fig. observe faster r-cnn works well nodules test fold detection probability also high nodules. detected false positive nodules last false positives suspicious nodules visually observe carefully. sizes false positive nodules small. note nodules less removed ground truth annotations. nodule classiﬁcation also visualize nodule classiﬁcation results test fold fig. nodules ﬁrst four rows deeplung predicted right doctors predicted wrong. ﬁrst number deeplung predicted malignant probability. second number doctor predicted wrong. probability large malignant nodule. otherwise benign nodule. rest nodules deeplung predicted wrong numbers indicating deeplung predicted malignant probability. experienced doctor nodule irregular shape high probability malignant nodule. ﬁrst rows fig. observe doctors mis-diagnose nodules. reason that humans good processing data signal noise ratio. fact even high quality natural image performance deep network surpasses humans doctors’ individual experience point view doctors intend optimistic nodules doctors intend pessimistic them. observe slice time. irregular boundaries vague. machine learning based methods learn complicated rules high dimensional features doctors’ annotations avoid bias. figure visualization central slices nodule ground truths detection results. randomly choose nodules test fold detection results shown second fourth row. numbers detected nodules format last shows false positive detected nodules detection probabilities. note ground truth nodules diameter greater deeplung performs well detection. rest nodules numbers nodules deeplung predicted wrong test fold fig. predicted malignant probability large ground truth label benign. otherwise ground truth label malignant. central slices hardly decide deeplung’s predictions wrong. maybe deeplung cannot weak irregular boundaries bottom right nodules possible reason deeplung predicts benign. analysis deeplung considered tool assist diagnosis doctors. combing deeplung doctor’s diagnosis effective improve diagnosis accuracy. figure visualization central slices nodule classiﬁcation results test fold choose nodules predicted right annotated wrong doctors ﬁrst rows. numbers nodules last rows show nodules model predicted wrong. number wrongly predicted malignant probabilities deeplung avoids doctors’ individual bias achieves better performance average performance doctors. tion design faster r-cnn u-net-like encoderdecoder structure detect suspicious nodules. input detected nodules nodule classiﬁcation network. deep dual path network designed extract features. further gradient boosting machine different features combined together achieve state-of-the-art performance surpasses experienced doctors. extensive experimental results public available largescale datasets luna lidc-idri datasets demonstrate superior performance deeplung. future develop advanced nodule detection method boost performance deeplung. further uniﬁed framework automated lung cancer diagnosis expected nodule detection classiﬁcation. integrating multi-modality data electronic medical report history deeplung another", "year": 2017}