{"title": "Convolutional neural networks that teach microscopes how to image", "tag": ["cs.CV", "cs.AI", "cs.LG", "physics.optics"], "abstract": "Deep learning algorithms offer a powerful means to automatically analyze the content of medical images. However, many biological samples of interest are primarily transparent to visible light and contain features that are difficult to resolve with a standard optical microscope. Here, we use a convolutional neural network (CNN) not only to classify images, but also to optimize the physical layout of the imaging device itself. We increase the classification accuracy of a microscope's recorded images by merging an optical model of image formation into the pipeline of a CNN. The resulting network simultaneously determines an ideal illumination arrangement to highlight important sample features during image acquisition, along with a set of convolutional weights to classify the detected images post-capture. We demonstrate our joint optimization technique with an experimental microscope configuration that automatically identifies malaria-infected cells with 5-10% higher accuracy than standard and alternative microscope lighting designs.", "text": "deep learning algorithms offer powerful means automatically analyze content medical images. however many biological samples interest primarily transparent visible light contain features difﬁcult resolve standard optical microscope. here convolutional neural network classify images also optimize physical layout imaging device itself. increase classiﬁcation accuracy microscope’s recorded images merging optical model image formation pipeline cnn. resulting network simultaneously determines ideal illumination arrangement highlight important sample features image acquisition along convolutional weights classify detected images post-capture. demonstrate joint optimization technique experimental microscope conﬁguration automatically identiﬁes malaria-infected cells higher accuracy standard alternative microscope lighting designs. artiﬁcial neural networks commonly used image classiﬁcation segmentation object detection image resolution enhancement convolutional neural networks particular continue offer signiﬁcant improvements supervised learning techniques. growing ﬁeld deep learning seen progress past several years learning networks trained pre-captured datasets contain standard images cifar- bbbc little work anns cnns jointly considered image data process actually acquired whether particular camera setup illumination geometry detector design might improve certain image post-processing goals. many scenarios optical microscopy particular various physical parameters used obtain image extremely important. example must select appropriate microscope objective lens entire area interest within ﬁeld-of-view also still resolves important features interest. primarily transparent samples often hardly visible standard bright-ﬁeld microscope. alternative techniques like phase-contrast differential ∗current address neurocure cluster excellence charité–universitätsmedizin berlin humboldt figure convolutional neural network jointly optimize physical layout microscope illumination well classiﬁer determine cells infected malaria parasite. classiﬁcation accuracy images optimal illumination technique notably exceeds standard bright-ﬁeld imaging setup alternative schemes like fourier ptychography improve spatial resolution better subsequent classiﬁcation must capture images thus less efﬁcient. scale interference contrast microscopy typically used improve sample visibility. likewise recent computational approaches also create sharper images using structured illumination however clear type microscope design illumination setting computational optics-based approach might yield best results particular cnn-driven task. here close images acquired post-processed cnns. include model optical image formation ﬁrst several layers neural network allows jointly optimize design microscope various weights used image classiﬁcation step thus forming speciﬁc type classiﬁcation microscope.\" experimental demonstration jointly determine optimal lighting pattern blood cell imaging well classiﬁer test infection malaria parasite simply displaying particular patterns array placed beneath microscope increase infection classiﬁcation accuracy hopeful presented framework help bring together growing ﬁeld deep learning design cameras microscopes imaging systems capture training data learning networks currently use. deep learning networks conventional biomedical image classiﬁcation commonplace much recent work relies cnns. however noted above studies area deep learning optimize acquisition process image data sets. early work shown simple neural networks offer effective design cameras ﬁrst works consider question context cnn-based learning presented recently chakrabarti designed optimal pixel-level color ﬁlter layout color image reconstruction outperformed standard bayer ﬁlter pattern. subsequent work also considered using cnns overcome effects camera sensor noise well optical scattering cnns paired non-conventional camera architectures additionally achieve light-ﬁeld imaging compressive image measurement alternative imaging setups also coupled supervised learning methods cell imaging classiﬁcation works ﬁrst consider performance figure physical improving image classiﬁcation accuracy. standard imaging setup variables interest labeled followed digital cnn. p-cnn pipeline. physical layers post-processing layers blue. discretized physical network used simulations experiments. sub-image illumination unique direction weighted summed form ﬁnal detected image enters classiﬁer. learned weights physical layer specify optimal illumination design classiﬁcation microscope. supervised learning general cnns particular connect exact procedure optical data acquisition. except chakrabarti’s work directly consider using optimize detection process optical device. work ﬁrst merge general model optical image formation ﬁrst layers cnn. presenting \"physical cnn\" model present simulations experimental results improved classiﬁcation cells microscopic images. focus particular task classifying blood cells infected plasmodium falciparum parasite clinically relevant deadly cause malaria. goal examined within context machine learning cnns past. unlike prior work demonstrate physical simultaneously predict optimal illuminate blood cell. used capture experimental images optimized illumination pattern produces better classiﬁcation scores tested alternatives hopefully integrated future malaria diagnostic tools. typical imaging scenario light ﬁrst travels source scene interest physically interacts objects within scene propagates lens sensor form image. here model physical processes early physical\" layers neural network followed series standard \"post-processing\" network layers. work design post-processing layers image classiﬁcation could also easily guided towards standard tasks network optimization physical-model weights associated experimental parameters used capture image directly inform optimized optical device design. standard image-based inputs take form pre-recorded incoherent intensity images. input image training images passes number network layers. early network layer simple operations typically applied repeated manner recent alexnet many others since). ﬁrst operation convolution second non-linear activation function third down-sampling operation write three steps layer output convolution kernel denotes convolution. common choice non-linear operation rectiﬁed linear unit common choice downsampling step max-pooling. here take step back ﬁrst consider light behaves forming image. let’s consider simpliﬁed imaging system fig. assume collects images classiﬁcation task. simple scenario let’s assume object interest thin allows model optical response complex vector furthermore we’ll assume object illuminated spatially coherent light source label illumination ﬁeld approximate resulting optical ﬁeld reﬂected and/or transmitted thin object element-wise multiplication complex vectors emerging object optical ﬁeld propagate imaging system microscope objective lens). portion ﬁeld pass lens eventually reach digital detector comprised array pixels detects discretizes intensity ﬁeld. common model linear process image formation convolution optical ﬁeld object plane camera-speciﬁc point-spread function detector measures squared magnitude resulting convolved ﬁeld. summarize discretization caused ﬁnite size pixel pixel sampling function entire image formation process takes following form here product illumination light object resulting image. square pixel array full ﬁll-factor approximately equivalent average pooling operation. comparing image formation nearly identical early layer. models equivalent layer’s non-linear activation function absolute value squaring downsampling operation average pooling. given similarity hypothesize natural ﬁrst layer whose inputs representations physical objects weights within subsequent layers dedicated computational operations particular classiﬁcation task weights within early \"physical model\" layer directly connect experimental parameters like illumination ﬁeld camera’s point-spread function downsampling function network optimization inform better imaging setup measurement process achieve particular cnn-related task. next section focus attention optimizing illumination ﬁeld improve image classiﬁcation framework generalizes optimizing optical parameters optical parameters interest here ﬁrst explain p-cnn model fig. detail discuss particular network used experiments let’s assume input p-cnn complex matrix describing sample interest thin sample approximation sample absorption represented modulus |oj| sample phase response typically directly proportional thickness represented argument coherent illumination ﬁeld modeled complex matrix unknown illumination weights noted ﬁeld emerging sample element-wise figure simulated microscope setup. example intensity images displayed unique image sets. image illuminated unique angle. example transparent objects created mnist dataset used generate images illumination patterns used classiﬁcation tests product transform detected image perform convolution complex point-spread function element-wise vector squaring down-sampling simulates p-cnn’s ﬁrst physical layer red). standard convolution-based classiﬁcation network blue) follow ﬁrst layer. network optimization learned weights specify optimal magnitude phase optical ﬁeld illuminate sample subsequent classiﬁcation. since patterned illumination provide better image contrast highlight features interest shift higher spatial frequencies camera’s ﬁnite frequency passband hypothesize images formed optimal physical illumination classiﬁed accurately p-cnn post-processing layers formed alternative illumination strategies. practice could physically shape optimal ﬁeld using pixel spatial light modulator instead choose work alternative imaging setup sketched fig. here discrete leds array deﬁne sample illumination. array illuminates sample coherent plane wave unique angle. since leds mutually incoherent another resulting image multiple leds emitting simultaneously incoherent led-illuminated sub-image\". leds within array emitting ﬁeld magnitude write detected image incoherent wleikl·r describes led-generated plane wave intensity traveling angle here speciﬁed transverse wavevector respect optical axis. plane wave illuminates object blurred imaging system form sub-image object ijl. weighted sub-images weight speciﬁes brightness forms detected image illumination particular pattern image enters digital classiﬁcation pipeline. refer discretized physical architecture summarized algorithm training dp-cnn simply requires {ijl}l uniquely illuminated images object interest input. optimizing weight vector particular classiﬁcation task values specify simultaneously illuminate future sample interest algorithm discretized physical input {ijl} uniquely illuminated images object object labels {yj}. randomly initialize weights {wl}l iteration output optimized weights model parameters array improved classiﬁcation. single optimally illuminated image enter post-processing classiﬁcation layers trained dp-cnn pipeline since layers dp-cnn already physically realized image recording. illuminating sample wide range angles able physically shift around sample spectrum capture wide range spatial frequencies thus diverse information would otherwise enter camera microscope. simulation experiment illuminate angles less greater maximum acceptance angle microscope objective lens form bright-ﬁeld dark-ﬁeld images sample. show next classiﬁcation accuracy dp-cnn-optimized images exceeds alternative illumination approaches. test whether dp-cnn leads improved classiﬁcation microscope design ﬁrst simulate realistic imaging scenario. many microscopic samples interest primarily transparent thus challenging capture clear images standard illumination. ﬁrst step simulation generate many different transparent samples\" would like classify. standard classiﬁcation dataset mnist handwritten digit image treat normalized mnist image height proﬁle thin optically clear object. conceptually equivalent assuming instead written digit pressed clear plastic sheet. thin object approximation express phase delay normal incident light passes transparent digit sheets πntgj/λ medium’s refractive index maximum height variation wavelength quasi-monochromatic illumination. also make realistic assumption sample transparent deﬁning small amount absorption constant optical ﬁeld would emerge sample plane wave illumination expressed complex function ajexp). possible directly sample responses associated labels training/testing inputs p-cnn fig. test dp-cnn fig. must ﬁrst simulate uniquely illuminated images object transparent digits described simulate different microscope images turning leds square array located beneath sample plane assume sample index refraction maximum thick size discretized pixels. microscope objective numerical aperture simulated imaging illuminate transparent digit sample figure simulation results. example phase maps transparent samples associated images different forms illumination sketched fig. images image capture images image captures followed subtraction allow negative weights. example optimized pattern weights array used generate optimized images array placed beneath sample uniform angular illumination degrees image detector contains pixels width exhibits gaussian readout noise. height proﬁle example transparent digits resulting images fig. split classiﬁed digit images training testing -layer dp-cnn fig. different amount random gaussian noise sample plane scaling parameter test robustness physical weights. independently train test system times different levels noise report mean performance table compare performance full dp-cnn pipeline several illuminate-and-classify strategies sketched fig. simulating alternative patterns sample illumination constant attempt learn illumination weights include physical layer optimized\" case dp-cnn training produces optimized pattern illuminate sample network testing. illuminating center produces low-contrast images classiﬁcation using pattern thus extremely poor average. turning off-axis produces image phase contrast signiﬁcantly boosts classiﬁcation accuracy illuminating leds simultaneously .%). three illumination schemes assume weight positive. also test strategies weights either positive negative. achieved practice capturing images ﬁrst positively weighted leds second negatively weighted leds digitally subtracting second image ﬁrst. test two-image strategy simulation randomly weighted leds average) differential phase-contrast conﬁguration right half array uniformly positive weights left half uniformly negative weights average) ﬁnally dp-cnn optimization pipeline average). example images clear optimal illumination strategy produces large amount contrast well relatively sharp image transparent digit leads highest classiﬁcation accuracy across tested noise levels. finally note post-processing layers dp-cnn yield classiﬁcation accuracy trained tested unmodiﬁed mnist image set. least example phase-only samples challenging classify absorptive samples example collection dp-cnn optimized digit classiﬁcation\" patterns fig. black left marks cutoff bright ﬁeld dark-ﬁeld leds noting positive weights negative blue ideal illumination strategies appear approximately involve subtracting brightly-lit images different opposing directions within bright-ﬁeld channel used imaging. makes intuitive sense since relevant information needed classify digit resides phase optimal illumination strategy maximize amount phase contrast within detected images. however opposing bright leds form symmetric pattern optimization process clearly converge global minimum simulation. next test dp-cnn pipeline practical image classiﬁcation experiment automatically determine blood cells infected falciparum parasite primary cause malaria. infection typically manifests small spot ring inside blood cell body. currently leading method diagnosing falciparum infection manual inspection stained blood smears clinical expert immersion microscope design classiﬁcation microscope automatically accurately detect infection illumination strategy outﬁt standard olympus microscope array positioned beneath sample different leds arranged concentric rings. image sample across wide ﬁeld-of-view using objective lens large format detector maximum angle illumination array approximately degrees high-angle illumination thus capture spatial frequencies large maximum frequency cutoff immersion objective lens using objective lens instead high magniﬁcation immersion lens image many cells within larger expense lower image resolution. hope overcome limited image resolution optimized illumination strategy allow simultaneously offer accurate classiﬁcation high detection throughput oil-free imaging setup. samples number different slides single-layer human blood smears. blood cells within slide infected falciparum majority cells infected. infected cells majority infected falciparum ring stage. minority infected cells trophozoites schizonts help test well dp-cnn classiﬁer generalize different stages infection. slide lightly stained using hema stain. sample ﬁrst capture multiple images individually illuminating uniquely positioned leds time. illuminate separately green blue channel take separate images capture color. create classiﬁcation data ﬁrst identiﬁed cells non-standard morphology smoothness then drew small bounding boxes around cell used fourier ptychography process images image reconstruction higher resolution reconstructions contain cell’s absorption phase delay approximately resolution approximately matches quality imaging oil-immersion objective lens example reconstructions fig. digitally refocused reconstruction best plane focus visually inspected cell determine whether uninfected contained features indicative falciparum infection. diagnosis cropped cell approximate pixel bounding images. used cubic resizing form pixel images necessary make cropped images figure experimental results falciparum-infected cells uninfected cells using different illumination patterns images image capture. images captures subtraction. reconstructions formed capturing processing unique images optimized pattern areas infection appear bright spots missing uninfected cells. size. data cube binary diagnosis label form example within initial dataset. diagnosed extracted total data cubes cells across different microscope slides randomly shufﬂed examples separated training testing sets. increase algorithm robustness applied data augmentation separately training testing sets. ﬁnal training contained examples ﬁnal test contained examples different transformations used data augmentation image rotation image blurring elastic image deformation addition small amount gaussian noise. transformations align following experimental uncertainties expect future experiments arbitrary slide placement slight microscope defocus distortions caused different smear procedures varying amounts sensor readout noise. similar simulation compare performance dp-cnn’s joint illumination optimization/classiﬁcation process several alternative illuminate-and-classify strategies. average accuracies standard deviations presented table light staining slide direct illumination using center often produces observable indication cell infection shown fig. top. however accurate diagnosis resolution microscope objective lens remains challenging. noted above oil-immersion objective lens typically required task thus surprising classiﬁcation accuracy remains relatively approximately using incoherent illumination increases image resolution signiﬁcantly decreases image contrast. appears maintaining high contrast extremely important accurate classiﬁcation infection classiﬁcation accuracy drops incoherent light. off-axis illumination generates higher image contrast improves accuracy quite level center illumination. also consider procedures capture subtract images. randomly selecting positive negative illumination weights produces contrast classiﬁcation remains poor differential phase-contrast imaging using opposing illumination leds image subtraction slightly better accuracy dp-cnn optimized illumination pattern approximately remains signiﬁcantly higher alternatives table also present classiﬁcation accuracies strategy based ensemble method independent trials ’majority’ column). here deﬁne cell infected classiﬁed infected independent trials. effectively combines classiﬁers increase accuracy average leads approximately accuracy optimized illumination scheme. false negative rate dp-cnn tests average approximately higher false positive rate partially accounted unequal number infected uninfected cell images training data. reducing false negative rate major focus future work. several dp-cnn optimized patterns shown fig. unlike simulation independent trial dp-cnn experimental data converges similar optimal weight pattern arbitrary sign offset. approximately optimized patterns show positive intensity weights along outer ring mostly negative weights within match multiplying weights accounting sign offset show average optimized pattern variance independent trials fig. example patterns independent train/test trials fig. weight energy within average pattern dedicated outer ring leds suggesting high spatial frequency information important accurately classify infection. ring-like structure conceptually matches condenser annulus design used phase contrast microscopes ring uniformly weighted. furthermore average weight energy negative. less light makes lens high illumination angles resulting optimized images thus noisier although classiﬁer must compete increased image noise mixture positive weights center negative weights outer ring visually highlight inner-cell infections bright spots fig. apparently allowing digital classiﬁer achieve higher accuracy versus alternative illumination schemes. finally compare performance dp-cnn alternative classiﬁcation methods expect exhibit higher accuracy. first attempt classify malaria parasite infection high-resolution fourier ptychographic reconstructions cell. data cube algorithm process individual images form high-resolution complex-valued reconstruction apply data augmentation magnitudes reconstructions create training/testing high-resolution labeled examples. process dp-cnn post-processing layers obtain slightly higher classiﬁcation accuracy -image dp-cnn average majority vote. slight improvement surprising given requires increase amount data must recorded cell. second obtained baseline classiﬁcation accuracy trained human expert involved sample preparation imaging experiments. randomly selecting labeled cells full dataset displayed images figure dp-cnn optimized illumination patterns. location leds bright/dark ﬁeld boarder marked dashed line. average weights variance illumination unit computed independent trials. example optimized patterns. cell expert low-resolution image center bright-ﬁeld off-axis dark-ﬁeld off-axis fp-reconstructed magnitude. based images expert made diagnosis matched assigned label accuracy diagnosis errors partially attributed resolution image artifacts present reconstruction. summary presented framework jointly optimize physical parameters microscope weights used classify images generates. demonstration improved accuracy malaria classiﬁcation determining optimal led-based microscope illumination pattern. experiment shows physical parameters microscope important particular image classiﬁcation task. necessarily come surprise given optimized microscope design capture relevant information standard system number respects experiments much proof-of-concept much future work needed robust malaria detection process. first must increase size training sets annotated samples large number patients. second involve several trained professionals label datasets stained unstained falciparum-infected cells different stages infection. make test secure reliable possible major focus elimination false determinations particular false negatives. also sorting technique ﬁrst separate infected uninfected cells imaging obtain better ground-truth classiﬁcation. finally need compare performance pipeline prior methods malaria classiﬁcation standard microscope images combination physical optimization process alternative learning pipelines yield higher overall classiﬁcation accuracy. general anticipate technology directly extended diagnosis falciparum infection patient level given larger number infected cells smear expect much higher patient-speciﬁc classiﬁcation accuracies opposed per-cell classiﬁcation accuracies reported here. outside particular goal classifying malaria infection number potential extensions framework. first optimized patterns require images following recent work spectral classiﬁcation future strategy adaptive approach classify uniquely images second large number alternative physical aspects microscope potentially optimize cnn. immediate extension could jointly optimize illumination phase plate place microscope back focal plane effectively customizes condenser annulus phase ring phase contrast setups particular cnn-based goal. microscope design options include optimizing spectral polarimetric degrees freedom improving axial resolution depth detection addressing various sensor characteristics enhancing abilities scattering material like tissue. many aspects physical layers p-cnn model. general hopeful initial foundation presented help others explore connections artiﬁcial neural networks physical devices used acquire data. thank xiaoze jaebum chung prof. changhuei yang capturing sharing images used experiment thank prof. rodriguez providing malaria-infected cells. r.h. acknowledges funding einstein foundation berlin. results obtained using tensorﬂow. simulations experiments used cross-entropy error metric also applied dropout ﬁnal readout layer. simulation results trained iterations batch size used adam method stochastic optimization step size experimental results trained iterations using batch size report results using adam optimization step size adam optimizer =e-. brief review experimental dp-cnn pipeline fig. layer tensor product input weight vector layer uses convolution kernel features relu activation pooling layer uses convolution kernel features relu activation pooling layer densely connected layer neurons relu activation layer densely connected readout layer. apply dropout probability layers", "year": 2017}