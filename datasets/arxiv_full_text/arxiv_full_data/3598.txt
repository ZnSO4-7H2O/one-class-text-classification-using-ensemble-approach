{"title": "Classification and Disease Localization in Histopathology Using Only  Global Labels: A Weakly-Supervised Approach", "tag": ["cs.CV", "cs.LG", "stat.ML"], "abstract": "Analysis of histopathology slides is a critical step for many diagnoses, and in particular in oncology where it defines the gold standard. In the case of digital histopathological analysis, highly trained pathologists must review vast whole-slide-images of extreme digital resolution ($100,000^2$ pixels) across multiple zoom levels in order to locate abnormal regions of cells, or in some cases single cells, out of millions. The application of deep learning to this problem is hampered not only by small sample sizes, as typical datasets contain only a few hundred samples, but also by the generation of ground-truth localized annotations for training interpretable classification and segmentation models. We propose a method for disease localization in the context of weakly supervised learning, where only image-level labels are available during training. Even without pixel-level annotations, we are able to demonstrate performance comparable with models trained with strong annotations on the Camelyon-16 lymph node metastases detection challenge. We accomplish this through the use of pre-trained deep convolutional networks, feature embedding, as well as learning via top instances and negative evidence, a multiple instance learning technique from the field of semantic segmentation and object detection.", "text": "analysis histopathology slides critical step many diagnoses particular oncology deﬁnes gold standard. case digital histopathological analysis highly trained pathologists must review vast wholeslide-images extreme digital resolution across multiple zoom levels order locate abnormal regions cells cases single cells millions. application deep learning problem hampered small sample sizes typical datasets contain hundred samples also generation ground-truth localized annotations training interpretable classiﬁcation segmentation models. propose method disease localization context weakly supervised learning image-level labels available training. even without pixel-level annotations able demonstrate performance comparable models trained strong annotations camelyon- lymph node metastases detection challenge. accomplish pre-trained deep convolutional networks feature embedding well learning instances negative evidence multiple instance learning technique ﬁeld semantic segmentation object detection. histopathological image analysis critical element diagnosis many areas medicine especially oncology deﬁnes gold standard metric. recent works sought leverage modern developments machine learning pathologists disease detection tasks majority techniques require localized annotation masks training data. annotations even costly obtain original diagnosis pathologists must spend time assemble pixel-by-pixel segmentation maps diseased tissue extreme resolution thus datasets annotations limited size. additionally localized annotations available facing problems disease subtybe classiﬁcation prognosis estimation drug response prediction. thus critical question design learning architecture achieves accurate classiﬁcation additional localized annotation? successful technique would able train algorithms assist pathologists analysis could also used identify previously unknown structures regions interest. indeed histopathology gold standard diagnostic oncology extremely costly requiring many hours focus pathologists make single diagnosis additionally correct diagnosis certain diseases requires pathologists identify cells millions tasks akin ﬁnding needle haystack. hard numbers diagnostic error rates histopathology difﬁcult obtain dependent upon disease tissue question well self-reporting pathologists diagnostic errors. however reported review santana ferreira false negatives cancer diagnosis lead catastrophic consequences patient also incredible ﬁnancial risk pathologist. tool pathologists focus attention effort must suspect regions help reduce false-negatives improve patient outcomes accurate diagnoses medical researchers looked computer-aided diagnosis decades lack computational resources data prevented wide-spread implementation usage tools since advent automated digital capture researchers sought approaches easing pathologist’s workload improve patient outcomes image processing algorithms rather predicting ﬁnal diagnosis many procedures focused instead segmentation either cell-counting detection suspect regions wsi. historical methods focused hand-crafted texture morphological features used conjunction unsupervised techniques k-means clustering dimensionality reduction techniques prior classiﬁcation k-nearest neighbor support vector machine. past decade fruitful developments deep learning lead explosion research automation image processing tasks. application advanced techniques image tasks successful many consumer applications adoption approaches within ﬁeld medical imaging gradual. however techniques demonstrate remarkable promise ﬁeld hia. speciﬁcally digital pathology whole-slide-imaging highly trained skilled pathologists review digitally captured microscopy images prepared stained tissue samples order make diagnoses. digital massive datasets consisting images captured multiple zoom levels. greatest magniﬁcation levels digital resolution upwards thousand pixels dimensions. however since localized annotations difﬁcult obtain datasets contain wsi-level diagnosis labels falling category weakly-supervised learning. dcnns ﬁrst proposed cires¸an authors able train model mitosis detection stained images. similar technique applied detection invasive ductal carcinoma cruz-roa approaches demonstrated usefulness learned features effective replacement hand-crafted image features. possible train deep architectures scratch classiﬁcation tile images however training dcnn architectures extremely resource intensive. reason many recent approaches applying dcnns make large pre-trained networks rich feature extractors tiles approaches found success aggregation rich representations pre-trained dcnns proven quite effective even without from-scratch training tiles. paper propose chowder approach interpretable prediction general localized diseases weak whole-image disease labels without additional expert-produced localized annotations i.e. per-pixel segmentation maps diseased areas within wsi. accomplish this modify existing architecture ﬁeld multiple instance learning object region detection diagnosis prediction. modifying pre-trained dcnn model introducing additional fully-connected layers context-aware classiﬁcation tile instances developing random tile sampling scheme efﬁcient training massive enforcing strict regualrizations able demonstrate performance equivalent best human pathologists notably approach propose makes pre-trained dcnn feature extractor entire procedure true end-to-end classiﬁcation technique therefore transferred pre-trained layers ﬁne-tuned context wsi. demonstrate using whole-slide labels performance comparable top- ranked methods trained strong pixel-level labels camelyon- challenge dataset also producing disease segmentation closely matches ground-truth annotations. also present results diagnosis prediction obtained cancer genome atlas strong annotations available diseases strongly localized within tissue sample. access pixel-level labels. shown imagenet access data drives innovation however hand-labeled segmentation maps costly produce often subject missed diseased areas cannot scale size datasets required truly effective deep learning. considerations uniquely suited weakly supervised learning setting. here deﬁne task identiﬁcation suspect regions training data contains image-wide labels diagnoses made expert pathologists. since often digitally processed small patches tiles aggregation tiles groups single label used within framework multiple instance learning binary classiﬁcation often makes standard multi-instance assumption classiﬁed positive least instance labelled positive. goal take bag-level labels learn instance-level rules classiﬁcation single instances. case learning rules provides ability infer localized regions abnormal cells within large-scale wsi. recent work classiﬁcation setting authors propose em-based method identify discriminative patches high resolution images automatically patch-level training. also introduced decision level fusion method robust max-pooling thought count-based multiple instance learning method two-level learning. approach shown effective case glioma classiﬁcation obtains best result slightly outperforms much simpler approaches presented much greater computational cost. case natural images weldon wildcat techniques durand durand respectively demonstrated state-of-the-art performance object detection localization image-wide labels. case weldon authors propose end-to-end trainable model based learning instances well negative evidence relaxing assumption. speciﬁcally case semantic segmentation vasconcelos argue target concept might exist subregion level proportion positive negative samples larger effect determination label assignment. argument also holds case pathologist diagnosis arises synthesis observations across multiple resolution levels well relative abundance diseased cells. sec. detail proposed approach makes number improvements framework durand adapting context large-scale hia. tissue detection. seen fig. large regions contain tissue therefore useful training inference. extract tiles content relevant task approach wang namely otsu’s method applied saturation channels image transformation color space produce masks combined produce ﬁnal tissue segmentation. subsequently tiles within foreground segmentation extracted training inference. color normalization. according ciompi stain normalization important step since result staining procedure vary greatly slides. utilize simple histogram equalization algorithm consisting left-shifting channels subsequently rescaling proposed nikitenko work place particular emphasis tile aggregation method rather color normalization make advanced color normalization algorithms khan tiling. tiling step necessary histopathology analysis. indeed large size computationally intractable process slide entirety. example highest resolution zoom level denoted scale ﬁxed grid non-overlapping tiles possess tiles pixels. computational burden associated processing possible tiles instead turn uniform random sampling space possible tiles. additionally large scale nature datasets computational instead propose tiles non-overlapping grid processed stored disk prior training. tissue structure exhibit strong periodicity sampling tiles along ﬁxed grid without overlapping provides reasonably representative sampling maximizing total sampled area. given target scale denote number possible tiles indexed number tiles sampled training inference denoted chosen according feature extraction. make resnet- architecture trained imagenet natural image dataset. empirical comparisons inception architectures found resnet architecture provides features well suited hia. additionally resnet architecture provided variety depths however found resnet- provides best balance computational burden forward inference richness representation hia. approach every tile values resnet- pre-output layer ﬂoating point values feature vector tile. since ﬁxed input resolution resnet- pixels resolution tiles extracted pixel resolution every scale given extracting tile-level features produces feature vectors attempts classiﬁcation known image-wide label. dimension local descriptors number features output pre-trained image dcnn number sampled tiles. approaches bag-of-visual-words vlad could chosen baseline aggregation method generate single image-wide descriptor size would require huge computational power given dimensionality input. instead common approaches aggregation local features speciﬁcally maxpool meanpool subsequently apply classiﬁer aggregated features. applying pooling methods axis tile indices obtains single feature descriptor whole image. pooling approaches used context including fisher vector encodings p−norm pooling however reported effect aggregations quite small don’t consider approaches constructing baseline approach. aggregation classiﬁer trained produce desired diagnosis labels given global aggregated descriptor. baseline method logistic regression ﬁnal prediction layer model. present description baseline approach fig. experimentation observe baseline approach previous section works well diffuse disease evidenced results table tcga-lung. here diffuse implies number disease-containing tiles pertinent diagnosis label roughly proportional number tiles containing healthy tissue. however applies approach different datasets camelyon- performance signiﬁcantly degrades. case camelyon- diseased regions slides highly localized restricted small area within wsi. presented imbalanced bags simple aggregation approaches global slide descriptors overwhelm features disease-containing tiles. instead propose adaptation improvement weldon method designed histopathology images analysis. approach rather creating global slide descriptor aggregating tile features instead approach used combines top-instances well negative evidence. visual description approach given fig. feature embedding. first one-dimensional embeddings resnet- features calcualted one-dimensional convolutional layers strided across tile index axis. tile features embedding according kernel calculated notably kernels dimensionality one-dimensional convolution essence shortcut enforcing fully-connected layer tied weights across tiles i.e. embedding every tile experiments found single embedding appropriate choice datasets number available slides small case choosing decrease training error increase generalization error. avoiding overtraining ensuring model generality remains major challenge application datasets. vector instances negative evidence. feature embedding local tile-level descriptors. instance descriptors sorted value. sorted embedding values bottom entries retained resulting tensor entries diagnosis classiﬁcation. easily accomplished minmax layer output one-dimensional convolution layer. purpose layer take instances region also negative evidences region best support absence class. training back-propagation runs selected tiles positive negative evidences. applied minmax serves powerful tile selection procedure. multi-layer perceptron classiﬁer. weldon architecture last layer consists applied output minmax layer. however approach improved classiﬁcation. investigate possibility richer interactions bottom instances instead using ﬁnal classiﬁer. implefirst pre-processing single tile scale methods datasets. chose ﬁxed zoom level µm/pixel corresponds slides scanned magniﬁcation slides scanned magniﬁcation. next since datasets often contain hundred images millions images imagenet dataset strong regularization required prevent over-ﬁtting. applied -regularization convolutional feature embedding layer dropout rate however values global optimal apply hyper-parameter optimization tune values. optimize model parameters adam minimize binary cross-entropy loss epochs mini-batch size learning rate reduce variance prevent over-ﬁtting trained ensemble chowder networks differ initial weights. average predictions made networks establishes ﬁnal prediction. although results presented table used larger ensemble obtain best possible model comparing method reported camelyon- leaderboards. also ensemble reporting results weldon. training epoch requires seconds available hardware total training time ensemble took twelve hours. resnet- features extracted using efﬁcient feed-forward calculations chowder network trained order take advantage larger system sizes compared on-board ram. allows store training tiles memory provide faster training compared reduced transfer overhead. public cancer genome atlas provides approximately tissue slides images cancers various organs. ﬁrst experiment selected lung cancer wsis downloaded march subsequently lung slides added tcga increasing count lung slides along slides themselves tcga also provides labels representing type cancer present wsi. however local segmentation annotations cancerous tissue regions provided. pre-processing step extracts tiles corresponding representations resnet-. task experiments predict type cancer contained adenocarcinoma squamous cell carcinoma. evaluate quality classiﬁcation according area curve receiver operating characteristic curve generated using output predictions. expected case diffuse disease advantage provided chowder slight compared meanpool baseline evidenced table additionally full aggregation techniques work quite well setting value seem strong effect performance chowder increases setting highly homogenous tissue content expect global aggregate descriptors able effectively separate classes carcinoma. second experiment camelyon- challenge dataset consists wsis taken sentinel lymph nodes either healthy exhibit metastases form. addition wsis themselves well labeling segmentation mask provided represents expert analysis location metastases within wsi. human labeling sentinel lymph node slides known quite tedious noted litjens weaver teams participating challenge access utilized ground-truth masks training diagnosis prediction tumor localization models. approach aside masks metastasis locations utilize diagnosis labels. furthermore many participating teams developed post-processing step extracting handcrafted features predicted metastasis maps improve segmentation. post-processing performed presented chowder results score computed directly output chowder model. camelyon- dataset evaluated different axes. first accuracy predicted label test evaluated according auc. second accuracy metastasis localization evaluated comparing model outputs ground-truth expert annotations metastasis location. segmentation accuracy measured according free metric curve metastasis detection sensitivity average number also positives. camelyon challenge evaluate froc metric average detection sensitivity average false positive rates competition split bias. also conduct experiments camelyon- using random train-test cross-validation splits respecting training size original competition split. note distinct difference competition split obtained random folds. discrepancy especially distinct meanpool baseline reported table therefore note distinct discrepancy data distribution competition test training splits. notably using meanpool baseline architecture found competition train-test split predicted however obtains using random splits. distribution mismatch competition split could produce misleading interpretations report -fold average results along results obtained competition split. classiﬁcation performance. table classiﬁcation performance proposed chowder method compared baseline aggregation techniques well weldon approach. case weldon ﬁnal used instead summing applied minmax layer. value retains meaning cases number high scoring tiles pass classiﬁcation layers. test range values weldon chowder. values chowder provides signiﬁcant advantage baseline aggregation techniques well weldon. also note optimal performance obtained without using large number discriminative tiles i.e. published results camelyon- winning approach wang acheived chowder able attain without using ground-truth disease segmentation maps. remarkable result wang required tile-level disease labels derived expert-provided annotations order train full -layer googlenet architecture tile-level tumor prediction. also note chowder’s performance task roughly equivalent best-performing human pathologist reported bejnordi better-than-average respsect human pathologist performance notably human-level performance achieved without human assistance training beyond diagnosis labels themselves. present curve result fig. localization performance. obtaining high performance terms whole slide classiﬁcation well good worth much without interpretable result used pathologists diagnosis. example meanpool baseline aggregation approach provides information inference could derive tumor locations locality information lost aggregation. maxpool least retains information tile locations provide maximum aggregate feature. chowder propose full outputs convolutional feature embedding layer. sorted thresholded according value tiles embedded value larger classiﬁed diseased lower values classiﬁed healthy. show example disease localization produced chowder fig. here table classiﬁcation results camelyon- tcga-lung datasets chowder weldon baseline approach. camelyon- present scores ﬁxed competition test split wsis cross-validated average folds training wsis. tcga-lung present scores cross-validated average folds. figure performance curves camelyon- dataset classiﬁcation segmentation tasks different tested approaches. left curves classiﬁcation task. right froc curves lesion detection task. chowder able accurately localize tumorous region even though trained using global slide-wide labels without local annotations. potential false detections occur outside tumor region strongest response occurs within tumor region itself follows border regions nicely. present localization results appendix comparing published camelyon- results approach wang achieved winning froc strong annotations. weak-leaning setting chowder achieves froc however note localization results preliminary conduct either full sampling tiles apply post-processing overlapping tiles obtain full-resolution localization maps. approaches certainly possible using tile-instanace feature embeddings obtained trained chowder architecture note innovations post-processing outside scope work. froc curve given fig. figure visualization metastasis detection test image camelyon- dataset using proposed approach. left full zoom level ground truth annotation metastases shown black border. tiles positive feature embeddings colored white according magnitude representing largest magnitude. right detail metastases zoom level overlaid classiﬁcation output proposed approach. here output tested tiles shown colored according value blue white blue representing negative values positive. tiles without color included randomly selecting tiles inference. shown using state-of-the-art techniques computer vision instance negative evidence approach construct effective technique diagnosis prediction disease location histopathology without need expensive localized annotations produced expert pathologists. removing requirement hope accelerate production computer-assistance tools pathologists greatly improve turn-around time pathology labs help surgeons oncologists make rapid effective patient care decisions. also opens tackle problems expert pathologists know precisely relevant tissue located within slide image instance prognosis estimation prediction drug response tasks. ability approach discover associated regions interest without prior localized annotations hence appears novel discovery approach ﬁeld pathology. moreover using suggested localization chowder considerably speed process obtaining ground-truth localized annotations. number improvements made chowder method especially production disease localization maps. presented values convolutional embedding layer means resolution produced disease localization ﬁxed sampled tiles. however could also sample overlapping tiles data fusion technique generate ﬁnal localization map. additionally variety annotations available chowder could extended case heterogenous annotation e.g. slides expert-produced localized annotations whole-slide annotations. babak ehteshami bejnordi mitko veta paul johannes diest diagnostic assessment deep learning algorithms detection lymph node metastases women breast cancer. journal american medical association francesco ciompi oscar guessing babak ehteshami bejnordi gabriel silva souza alexi baidoshvili geert litjens bram ginneken iris nagtegaal jeroen laak. importance stain normalization colorectal tissue classiﬁcation convolutional networks. arxiv preprint cires¸an alessandro giusti luca gambardella j¨urgen schmidhuber. mitosis detection breast cancer histology images deep neural networks. int. conf. medical image computing computer-assisted intervention angel cruz-roa ajay basavanhally fabio gonz´alez hannah gilmore michael feldman shirdar ganesan natalie shih john tomaszewski anant madabhushi. automatic detection invasive ductal carcinoma whole slide images wiht convolutional neural networks. spie medical imaging deng dong richard socher li-jia fei-fei. imagenet large-scale hierarchical image database. proc. ieee conf. computer vision pattern recognition june ugljesa djuric gelareh zadeh kenneth aldape phedias diamandis. precision histology deep learning poised revitalize histomorphology personalized cancer care. precision oncology june thibault durand nicolas thome matthieu cord. weldon weakly supervised learning deep convolutional neural networks. proc. ieee conf. computer vision pattern recognition june thibault durand taylor mordan nicolas thome matthieu cord. wildcat weakly supervised learning deep convnets image classiﬁcation pointwise localization segmentation. proc. ieee conf. computer vision pattern recognition july dimitris samaras tahsin kurc james davis joel saltz. patch-based convolutional neural network whole slide tissue image classiﬁcation. proc. ieee conf. computer vision pattern recognition june herv´e j´egou matthijs douze cordelia schmid patrick p´erez. aggregating local descriptors compact image representation. proc. ieee conf. computer vision pattern reconition june hanna k¨all´en jesper molin anders heyden claes lundstr¨om kalle ˚astr¨om. towards grading gleason score using generically trained deep convolutional neural networks. proc. ieee int. symp. biomedical imaging april adnan mujahid khan nasir rajpoot darren treanor derek magee. nonlinear mapping approach stain normalization digital histopathology images using image-speciﬁc color deconvolution. ieee trans. biomedical engineering iringo kovacs christina hulsbergen peter bult bram ginneken jeroen laak. deep learning tool increased accuracy efﬁciency histopathological diagnosis. scientiﬁc reports geert litjens thijs kooi babak ehteshami bejnordi arnaud arindra adiyoso setio francesco ciompi mohsen ghafoorian jeroen laak bram ginneken clara sanchez. survey deep learning medical image analysis. arxiv preprint david snead yee-wah tsang aisha meskiri peter kimani richard crossman nasir rajpoot elaine blessing klaus chen kishore gopalakrishnan paul matthews navid momtahan sarah read-jones shatrughan emma simmons bidisa sinha sari suortamo hesham daly cree. validation digital pathology imaging primary histopathological diagnosis. histopathology christian szegedy yangqing pierre sermanet scott reed dragomir anguelov dumitru erhan vincent vanhoucke andrew rabinovich. going deeper convolutions. proc. ieee conf. computer vision pattern recognition june qiwei feng peilin zhong maode eric i-chao chang. deep learning feature representation multiple instance learning medical image analysis. proc. ieee conf. acoustics speech signal processing zhipeng liang-bo wang yuqing fang zhang maode eric i-chao chang. large scale tissue histopathology image classiﬁcation segmentation visualization deep convolutional activation features. bioinformatics figure visualization metastasis detection test image camelyon- dataset using proposed approach. left full zoom level ground truth annotation metastases shown black border. tiles positive feature embeddings colored white according magnitude representing largest magnitude. right detail metastases zoom level overlaid classiﬁcation output proposed approach. here output tested tiles shown colored according value blue white blue representing negative values positive. tiles without color included randomly selecting tiles inference. figure visualization metastasis detection test image camelyon- dataset using proposed approach. left full zoom level ground truth annotation metastases shown black border. tiles positive feature embeddings colored white according magnitude representing largest magnitude. right detail metastases zoom level overlaid classiﬁcation output proposed approach. here output tested tiles shown colored according value blue white blue representing negative values positive. tiles without color included randomly selecting tiles inference.", "year": 2018}