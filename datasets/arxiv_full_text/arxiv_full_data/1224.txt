{"title": "Affinity CNN: Learning Pixel-Centric Pairwise Relations for  Figure/Ground Embedding", "tag": ["cs.CV", "cs.LG", "cs.NE"], "abstract": "Spectral embedding provides a framework for solving perceptual organization problems, including image segmentation and figure/ground organization. From an affinity matrix describing pairwise relationships between pixels, it clusters pixels into regions, and, using a complex-valued extension, orders pixels according to layer. We train a convolutional neural network (CNN) to directly predict the pairwise relationships that define this affinity matrix. Spectral embedding then resolves these predictions into a globally-consistent segmentation and figure/ground organization of the scene. Experiments demonstrate significant benefit to this direct coupling compared to prior works which use explicit intermediate stages, such as edge detection, on the pathway from image to affinities. Our results suggest spectral embedding as a powerful alternative to the conditional random field (CRF)-based globalization schemes typically coupled to deep neural networks.", "text": "figure system architecture. send image trained predict grouping ordering relations pixels neighbors displacements laid ﬁxed stencil pattern. assemble pixel-centric relations sparse complex afﬁnity matrix pixels indicating pixel’s afﬁnity others. shown pixel center log-polar sampling pattern; positive/negative relations neighbors marked red/cyan squares overlaid image. feed pairwise afﬁnity matrix angular embedding global integration producing eigenvector representation reveals ﬁgure-ground organization know pixels together also pixels front. inference algorithm produces globally consistent scene interpretation. training target appropriate inference procedure eliminates need hand-designed intermediate stages edge detection. strategy parallels recent work connecting cnns conditional random ﬁelds semantic segmentation crucial difference however handle generic class independent image partitioning problem. context spectral embedding speciﬁcally angular embedding natural inference algorithm. figure illustrates architecture. angular embedding extension spectral relaxation normalized cuts complex-valued afﬁnities provides mathematical framework solving joint groupspectral embedding provides framework solving perceptual organization problems including image segmentation ﬁgure/ground organization. afﬁnity matrix describing pairwise relationships pixels clusters pixels regions using complex-valued extension orders pixels according layer. train convolutional neural network directly predict pairwise relationships deﬁne afﬁnity matrix. spectral embedding resolves predictions globallyconsistent segmentation ﬁgure/ground organization scene. experiments demonstrate signiﬁcant beneﬁt direct coupling compared prior works explicit intermediate stages edge detection pathway image afﬁnities. results suggest spectral embedding powerful alternative conditional random ﬁeld -based globalization schemes typically coupled deep neural networks. systems perceptual organization scenes commonly architected around pipeline intermediate stages. example image segmentation follows edge detection ﬁgure/ground occlusion depth layering follows reasoning discrete contours regions systems also reliant motion cues trend holds even light rapid advancements designs centered convolutional neural networks rather directly focus image segmentation recent architectures target edge detection. turaga make connection afﬁnity learning segmentation restrict afﬁnities precisely local edge strengths. pure approaches depth single image focus directly constructing desired output however works address problem perceptual grouping without ﬁxed semantic classes. figure angular embedding given capturing pairwise relationships nodes angular embedding task nodes onto unit semicircle resulting absolute positions respect conﬁdence-weighted relative pairwise ordering relative ordering identiﬁed rotation complex plane. node arg) recovers global rank order embedding occlusion layer. assume given estimates relative order many pairs pixels task agrees best possible pairwise estimates. angular embedding addresses optimization problem minimizing error accounts possibly differing conﬁdences pairwise estimates replaced eiθ. figure shows mathematical convenience permits interpretation embedding complex plane desired ordering corresponding absolute angle. deﬁned consensus embedding location according neighbors number pixels column vector ones diag matrix vector argument main diagonal denotes matrix hadamard product. everywhere zero eigenproblem identical spectral relaxation normalized cuts second higher eigenvectors encode grouping nonzero entries ﬁrst ranking problems. previous works established framework basis segmentation ﬁgure/ground organization well object-part grouping segmentation follow spirit employ major changes achieve high-quality ﬁgure/ground results reformulate segmentation ﬁgure/ground layering terms energy model pairwise forces pixels. pixels either bind together differentially repel strength interaction modulated conﬁdence prediction. train directly predict data-dependent energy model replaces ad-hoc boundarycentric interactions employed replaces hand-designed features. together facilitate learning pairwise interactions across regular stencil pattern. choosing sparse stencil pattern including shortlong-range connections allows incorporate multiscale cues remaining computationally efﬁcient. section develops model segmentation ﬁgure/ground providing necessary background angular embedding. section details structure predicting pairwise interaction terms model. model fully learned could trained according different notions segmentation ﬁgure/ground. example consistent deﬁnitions ﬁgure/ground include true depth ordering object class-speciﬁc foreground/background separation boundary ownership occlusion focus latter deﬁne segmentation region partition ﬁgure/ground ordering regions occlusion layer. berkeley segmentation dataset provides ground-truth annotation form demonstrate segmentation results competitive state-ofthe-art bsds benchmark simultaneously generating high-quality ﬁgure/ground output. occlusion layering interpretation ﬁgure/ground likely portable across datasets; corresponds mid-level perceptual task. precisely case learned model. trained bsds generates quite reasonable output tested image sources including pascal dataset believe signiﬁcant advance fully automatic perceptual organization. section presents experimental results across datasets section concludes. figure complex afﬁnities grouping ﬁgure/ground. angular displacement corresponding relative ﬁgure/ground depth ordering along conﬁdence displacement specify pairwise local grouping relationships pixels. single complex number encodes conﬁdence magnitude displacement angle positive real axis. four basic interaction types span space possible pairwise pixel relationships. contiguous region pixels region. vector along positive real axis represents high conﬁdence zero relative displacement. ambiguous boundary pixels different regions whose interface admits cues discriminating displacement. shared boundary could surface marking depth discontinuity either front. origin complex plane represents zero conﬁdence correct relationship. figure transition boundary convexity tends indicate foreground moving likely transitions ground ﬁgure. high conﬁdence positive angular displacement. ground transition reverse case ground respect complex representation negative angle. complex-valued eigenvectors nontrivial angle encodes rank ordering subsequent eigenvectors still encode grouping decoding procedure read information. speciﬁcally given eigenvectors zm−} corresponding eigenvalues solving equation arg) recovers ﬁgure/ground ordering. treating eigenvectors embedding pixels distance embedding space reveals perceptual grouping. follow recover boundaries segmentation embedding taking gradient eigenvectors applying watershed transform. equivalent form agglomerative clustering embedding space merging constrained neighbors image domain. chosen angular embedding inference procedure remains deﬁne pairwise pixel relationships special case normalized cuts represents clustering afﬁnity conﬁdence zero separation figure generalized afﬁnity. combining base cases figure express generalized afﬁnity binding force acting along positive real axis ﬁgure ground displacement forces acting angles. absence strong boundary binding force dominates linking pixels together. presence strong discriminative boundary either ﬁgure ground force dominates triggering displacement. conditions uncertainty forces weak. left plot illustrates total force strength plot shows dominant force. right complex-valued varies smoothly across conﬁguration space exhibits four distinct modes smooth transitions occur region uncertainty origin. region containing pixel ﬁgural means ﬁgure respect according true segmentation ﬁgure/ground ordering. probability boundary separates conditional probabilities ﬁgure ground respectively. note three possible transitions none ground ﬁgure ﬁgure ground. selecting likely probabilities erroneously binding region transitioning ﬁgure transitioning ground respectively figure deep afﬁnity network. produces output feature spatial resolution matching input image whose channels encode pairwise afﬁnity estimates pixel neighbors across scales. internal architecture derives previous networks generating perpixel predictions using multiple receptive ﬁelds. stage labels denote spatial size ratio feature input image. blue labels denote number channels feature map. experiments sample pixel pairs multiscale stencil pattern. pixel consider immediate neighbors pixel grid across scales stencil pattern thus consists neighbors total. train predictors offsets describing pairwise afﬁnity pixel neighbors. derive predictor local average consists neighbors ﬁne-scale. choosing implement predictors regard problem mapping input image channel output domain. adapt prior designs predicting output quantities every pixel somewhat higher-dimensional prediction task. specifically reuse basic network design ﬁrst passes large-scale coarse receptive ﬁeld alexnet -like subnetwork. appends subnetwork’s output second scale subnetwork acting ﬁner receptive ﬁeld. figure provides complete layer diagram. modifying increase size penultimate feature well output dimensionality. modularity training time separately train networks layer architecture figure modiﬁed caffe training loss truth prediction applied output pixel-wise regard binding ﬁgure transition ground transition forces acting figure plots conﬁguration space terms areas space component force strong overlap behaves distinct modes smooth transition area weak afﬁnity near origin. learning predict sufﬁces determine components computational efﬁciency predict pairwise relationships pixel immediate neighbors across multiple spatial scales. deﬁnes multiscale sparse adjustment prior feeding angular embedding solver enforce hermitian symmetry assigning supervised training system proceeds images associated ground-truth collection here image deﬁned domain segmentation mapping pixel region rank ordering pixels according ﬁgure/ground layering. data deﬁnes ground-truth pairwise relationships figure afﬁnity learning segmentation ﬁgure/ground. ground-truth assembly given ground-truth segmentation local ﬁgure/ground labels form boundary ownership infer global ground-truth ﬁgure/ground order running angular embedding pairwise interactions deﬁned local ground-truth. afﬁnity training ground-truth segmentation serves train pairwise grouping probability globalized ground-truth ﬁgure/ground trains shown ground-truth training targets model predictions component stencil relationship pixel neighbor relative offset ground-truth binary also binary except pixel pairs region ignored. masked test time require correct close model formulation relies dense labeling pixel relationships. bsds ground-truth provides dense segmentation region deﬁnes local ﬁgure/ground relationships pixels immediately adjacent along region boundary would like train predictors long-range ﬁgure/ground relationships addition short-range. figure illustrates method overcoming limitation. given perfect short-range predictions input angular embedding generates extremely high-quality global ﬁgure/ground estimate. real setting want robustness many estimates pairwise relations many scales. ground-truth short-range connections sufﬁce perfect estimates. globalized ground-truth ﬁgure/ground training signal equation usual ground-truth segmentation serves equation figure shows results examples image test set. compared previous attempt angular embedding inference engine ﬁgure/ground results strikingly better. visually apparent system improves every single example terms ﬁgure/ground. analogous loss applied denotes neighbors according stencil pattern. using stochastic gradient descent random initialization momentum train batch size mini-batch iterations. learning rates layer tuned hand. utilize data augmentation form translation left-right mirroring examples. training system generic perceptual task segmentation ﬁgure/ground layering requires dataset fully annotated form. appears renewed interest creating large-scale datasets annotation none released. therefore berkeley segmentation dataset training. though consists images total annotated ground-truth ﬁgure/ground resplit subset images training testing. following subsections detail even scarcity training data system achieves substantial improvements ﬁgure/ground quality prior work. image segmentation ﬁgure/ground results. compare system ground-truth results maire figure spectral shows per-pixel ﬁgure/ground ordering according result angular embedding. colormap matches figure denoting ﬁgure blue denoting background. spectral boundaries show soft boundary strength encoded eigenvectors. boundaries generate hierarchical segmentation level display ﬁnal column per-pixel ﬁgure/ground averaged regions. note drastic improvement results reﬂects strong lower-region bias ﬁgure system learns image content extracts foreground objects. examples resplit ﬁgure/ground test subset bsds. comparable similar systems using spectral clustering segmentation alone standard boundary precision recall benchmark bsds spectral boundaries achieve f-measure identical spectral component boundary detector thus segmentation engine system previous best spectral-clustering based systems. system joint segmentation ﬁgure/ground organization system competitors. angular embedding solve problems unique system figure shows obvious huge jump ﬁgure/ground performance knowledge well-established benchmarking methodology dense ﬁgure/ground predictions. propose metrics coupling ﬁgure/ground classiﬁcation accuracy along boundaries boundary detection performance develop simpler alternative. given per-pixel ﬁgure/ground ordering assignment segmentation partitioning image regions easily order regions according ﬁgure/ground layering. simply assign region rank order equal mean ﬁgure/ground order member pixels. robustness minor misalignment ﬁgure/ground assignment boundaries regions segmentation median place mean. transfer procedure serves basis comparing different ﬁgure/ground orderings. transfer onto segmentation. particular given predicted ﬁgure/ground ordering ground-truth ﬁgure/ground ordering ground-truth segmentation transfer onto gives orderings regions compare according following metrics pairwise region accuracy pair neighboring regions ground-truth ﬁgure/ground assignment shows different layers test whether predicted relative ordering regions matches ground-truth relative ordering. measure accuracy classiﬁcation problem predicting region front. boundary ownership accuracy deﬁne front region owning pixels common boundary region pair measure per-pixel accuracy predicting boundary ownership. reweighting r-acc. r-acc region pairs straddling ground-truth ﬁgure/ground boundary count equally. b-acc importance weighted according length boundary. table figure/ground benchmark results. transferring ﬁgure/ground predictions onto either ground-truth segmentations quantify accuracy local relative relationships. r-acc pairwise region accuracy considering pairs neighboring regions fraction correctly ordered relative ﬁgure/ground? b-acc boundary ownership accuracy fraction boundary pixels correct ﬁgure ownership assigned? b-acc- b-acc- restrict measurement boundaries foreground regions system dramatically outperforms across metrics. boundary ownership foreground regions identical b-acc except consider boundaries belong foreground% regions ground-truth ﬁgure/ground ordering image. metrics emphasize importance correct predictions foreground objects ignoring distant objects. note need ground-truth segmentation. project ground-truth ﬁgure/ground onto segmentation compare predicted ﬁgure/ground projected onto segmentation. table reports complete comparison ﬁgure/ground predictions groundtruth ﬁgure/ground image test subset bsds consider projection onto ground-truth segmentation onto system’s segmentation output. latter system produces hierarchical segmentation region partition ﬁxed level hierarchy calibrated optimal boundary f-measure. figures provide visual comparison test images. figure demonstrates bsds-trained system captures generally-applicable notions segmentation ﬁgure/ground. pascal weizmann horse database generates ﬁgure/ground layering respects scene organization. weizmann examples though trained perceptual organization behaves like object detector. figure/ground predictions measured ground-truth segmentation. transfer per-pixel ﬁgure/ground predictions figure onto ground-truth segmentation taking median value region. boundaries separating regions different ground-truth ﬁgure/ground layer assignments check whether predicted owner matches owner according ground-truth. rightmost columns mark correct boundary ownership predictions green errors results maire’s system system. note correctly predict ownership object lower boundaries improve small objects table gives quantitative benchmarks. figure figure/ground predictions measured segmentation. figure transfer ground-truth ﬁgure/ground maire’s ﬁgure/ground predictions predictions onto common segmentation. however instead using ground-truth segmentation transfer onto segmentation generated system. ground-truth ﬁgure/ground transferred onto regions deﬁnes boundary ownership signal judge predictions. comparing figure boundary ownership predictions mostly consistent regardless segmentation applied. however shows case here predicted correct ownership lower boundary relies averaging large ground-truth background region. figure cross-domain generalization. system trained berkeley segmentation dataset generalizes datasets. here test images pascal dataset weizmann horse database pascal ﬁgure/ground reﬂects object attention scene layering. weizmann images system acts essentially horse detection segmentation algorithm despite object-speciﬁc training. generic understanding ﬁgure/ground sufﬁces automatically pick objects. demonstrate angular embedding acting predictions pairwise pixel relationships provides powerful framework segmentation ﬁgure/ground organization. work ﬁrst formulate robust interface components. results dramatic improvement prior attempts spectral methods ﬁgure/ground organization.", "year": 2015}